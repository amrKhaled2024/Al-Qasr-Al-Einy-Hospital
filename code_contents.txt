CODE FILES COLLECTION
Root Directory: /Applications/XAMPP/xamppfiles/htdocs/OOP_PROJECT/hospital-management-system
Generated on: 1767442439.3331695
================================================================================


================================================================================
FILE: debug_admin_login.php
================================================================================

<?php
// debug_admin_login.php
session_start();
error_reporting(E_ALL);
ini_set('display_errors', 1);

echo "<h2>Admin Login Debug</h2>";

// Include necessary files
require_once __DIR__ . '/core/Database.php';
require_once __DIR__ . '/core/Auth.php';
require_once __DIR__ . '/models/UserFactory.php';

echo "<h3>1. Testing Database Connection</h3>";
try {
    $db = \Core\Database::getInstance()->getConnection();
    echo "<p style='color: green;'>‚úÖ Database connected</p>";
    
    // Check all admin users
    $stmt = $db->prepare("SELECT * FROM users WHERE role = 'admin'");
    $stmt->execute();
    $admins = $stmt->fetchAll();
    
    if (empty($admins)) {
        echo "<p style='color: red;'>‚ùå No admin users found in database!</p>";
        
        // Create an admin user
        echo "<p>Creating admin user...</p>";
        $password = 'admin123';
        $hash = password_hash($password, PASSWORD_DEFAULT);
        
        $insert = $db->prepare("
            INSERT INTO users (name, email, password, role, status) 
            VALUES ('Admin User', 'admin@hospital.com', ?, 'admin', 'active')
        ");
        
        if ($insert->execute([$hash])) {
            echo "<p style='color: green;'>‚úÖ Admin user created!</p>";
            echo "<p>Email: admin@hospital.com</p>";
            echo "<p>Password: admin123</p>";
        }
    } else {
        echo "<p>Found " . count($admins) . " admin users:</p>";
        echo "<table border='1' cellpadding='5'>";
        echo "<tr><th>ID</th><th>Name</th><th>Email</th><th>Status</th><th>Password Hash</th></tr>";
        foreach ($admins as $admin) {
            echo "<tr>";
            echo "<td>{$admin['id']}</td>";
            echo "<td>{$admin['name']}</td>";
            echo "<td>{$admin['email']}</td>";
            echo "<td>{$admin['status']}</td>";
            echo "<td>" . substr($admin['password'], 0, 30) . "...</td>";
            echo "</tr>";
        }
        echo "</table>";
    }
    
} catch (Exception $e) {
    echo "<p style='color: red;'>‚ùå Database error: " . $e->getMessage() . "</p>";
}

echo "<h3>2. Testing Auth::login() Method Directly</h3>";
try {
    $auth = Core\Auth::getInstance();
    
    // Test admin login
    $adminEmail = 'admin@hospital.com';
    $adminPassword = 'admin123';
    
    echo "<p>Testing Auth::login('$adminEmail', '$adminPassword')</p>";
    
    $adminUser = $auth->login($adminEmail, $adminPassword);
    
    if ($adminUser) {
        echo "<p style='color: green;'>‚úÖ Auth::login() SUCCESS!</p>";
        echo "<p>User ID: " . $adminUser->getId() . "</p>";
        echo "<p>User Role: " . $adminUser->getRole() . "</p>";
        echo "<p>User Name: " . $adminUser->getName() . "</p>";
        
        // Check session
        echo "<h4>Session Data:</h4>";
        echo "<pre>";
        print_r($_SESSION);
        echo "</pre>";
    } else {
        echo "<p style='color: red;'>‚ùå Auth::login() FAILED for admin!</p>";
        
        // Let's debug why
        echo "<h4>Debugging the failure:</h4>";
        
        // Check if user exists
        $stmt = $db->prepare("SELECT * FROM users WHERE email = ?");
        $stmt->execute([$adminEmail]);
        $userData = $stmt->fetch();
        
        if ($userData) {
            echo "<p>‚úÖ User found in database</p>";
            echo "<p>Status: " . $userData['status'] . "</p>";
            
            // Test password verification
            $isValid = password_verify($adminPassword, $userData['password']);
            echo "<p>Password verification: " . ($isValid ? "‚úÖ VALID" : "‚ùå INVALID") . "</p>";
            
            if (!$isValid) {
                echo "<p>Let's fix the password...</p>";
                $newHash = password_hash($adminPassword, PASSWORD_DEFAULT);
                $update = $db->prepare("UPDATE users SET password = ? WHERE email = ?");
                $update->execute([$newHash, $adminEmail]);
                echo "<p>Password updated. New hash created.</p>";
                
                // Try login again
                $adminUser = $auth->login($adminEmail, $adminPassword);
                if ($adminUser) {
                    echo "<p style='color: green;'>‚úÖ Login works after password fix!</p>";
                }
            }
        } else {
            echo "<p>‚ùå User not found in database</p>";
        }
    }
    
} catch (Exception $e) {
    echo "<p style='color: red;'>‚ùå Auth error: " . $e->getMessage() . "</p>";
}

echo "<h3>3. Testing Patient Login (for comparison)</h3>";
try {
    // Check if patient exists
    $patientEmail = 'patient@hospital.com';
    $patientPassword = 'patient123';
    
    $stmt = $db->prepare("SELECT * FROM users WHERE email = ? AND role = 'patient'");
    $stmt->execute([$patientEmail]);
    $patient = $stmt->fetch();
    
    if ($patient) {
        echo "<p>Patient found: {$patient['name']}</p>";
        
        // Test patient login
        $patientUser = $auth->login($patientEmail, $patientPassword);
        
        if ($patientUser) {
            echo "<p style='color: green;'>‚úÖ Patient login works!</p>";
            echo "<p>This means Auth::login() works for patients but not admins.</p>";
            
            // Logout
            $auth->logout();
        } else {
            echo "<p style='color: red;'>‚ùå Patient login also fails!</p>";
        }
    } else {
        echo "<p>No patient user found with email: $patientEmail</p>";
    }
    
} catch (Exception $e) {
    echo "<p style='color: red;'>‚ùå Patient test error: " . $e->getMessage() . "</p>";
}

echo "<h3>4. Testing the Actual Login Flow</h3>";
echo '<form method="POST" action="public/index.php?page=login" target="_blank">
    <input type="hidden" name="email" value="admin@hospital.com">
    <input type="hidden" name="password" value="admin123">
    <input type="hidden" name="role" value="admin">
    <button type="submit" style="padding: 10px 20px; background: #1a6aa2; color: white; border: none; border-radius: 5px;">
        Test Admin Login Form
    </button>
</form>';

echo "<h3>5. Check Your AuthController</h3>";
echo "<p>The issue might be in AuthController.php. Let me show you what to check:</p>";
echo "<pre style='background: #f5f5f5; padding: 10px;'>";
echo "Check if AuthController is properly checking the role.\n";
echo "In AuthController::login(), look for this logic:\n\n";
echo "if (\$user) {
    \$actualRole = \$user->getRole();
    
    // This might be the problem - checking if selected role matches
    if (empty(\$selectedRole) || \$selectedRole === \$actualRole) {
        \$this->redirectToDashboard(\$actualRole);
    } else {
        // Shows error about wrong role
        \$auth->logout();
        \$this->view('auth/login', [
            'error' => \"Please select correct role: \" . ucfirst(\$actualRole)
        ]);
    }
}";
echo "</pre>";
?>

================================================================================
FILE: fix_admin_final.php
================================================================================

<?php
// fix_admin_final.php - Complete solution
session_start();
error_reporting(E_ALL);
ini_set('display_errors', 1);

echo "<h2>üöÄ Fixing Admin Login - Complete Solution</h2>";

// Define database constants if not already defined
if (!defined('DB_HOST')) define('DB_HOST', 'localhost');
if (!defined('DB_NAME')) define('DB_NAME', 'hospital_management');
if (!defined('DB_USER')) define('DB_USER', 'root');
if (!defined('DB_PASS')) define('DB_PASS', '');
if (!defined('DB_CHARSET')) define('DB_CHARSET', 'utf8mb4');
if (!defined('APP_URL')) define('APP_URL', 'http://localhost/OOP_PROJECT/hospital-management-system');

echo "<h3>Step 1: Testing Database Connection</h3>";

try {
    // Direct PDO connection first
    $pdo = new PDO(
        "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=" . DB_CHARSET,
        DB_USER,
        DB_PASS,
        [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC
        ]
    );
    
    echo "<p style='color: green;'>‚úÖ Direct database connection successful!</p>";
    
    // Create admin user if doesn't exist
    echo "<h3>Step 2: Checking/Creating Admin User</h3>";
    
    $adminEmail = 'admin@hospital.com';
    $adminPassword = 'admin123';
    
    // Check if admin exists
    $stmt = $pdo->prepare("SELECT * FROM users WHERE email = ?");
    $stmt->execute([$adminEmail]);
    $admin = $stmt->fetch();
    
    if (!$admin) {
        echo "<p>No admin user found. Creating one...</p>";
        
        $hash = password_hash($adminPassword, PASSWORD_DEFAULT);
        
        $insert = $pdo->prepare("
            INSERT INTO users (name, email, password, role, phone, status) 
            VALUES (?, ?, ?, 'admin', '+201000000000', 'active')
        ");
        
        if ($insert->execute(['Main Administrator', $adminEmail, $hash])) {
            echo "<p style='color: green;'>‚úÖ Admin user created successfully!</p>";
            echo "<p>Email: $adminEmail</p>";
            echo "<p>Password: $adminPassword</p>";
        }
    } else {
        echo "<p>Admin user found:</p>";
        echo "<pre>";
        print_r([
            'id' => $admin['id'],
            'name' => $admin['name'],
            'email' => $admin['email'],
            'role' => $admin['role'],
            'status' => $admin['status']
        ]);
        echo "</pre>";
        
        // Update password to ensure it's correct
        $hash = password_hash($adminPassword, PASSWORD_DEFAULT);
        $update = $pdo->prepare("UPDATE users SET password = ? WHERE email = ?");
        $update->execute([$hash, $adminEmail]);
        
        echo "<p style='color: green;'>‚úÖ Admin password reset to: $adminPassword</p>";
    }
    
    // Verify all users in database
    echo "<h3>Step 3: All Users in Database</h3>";
    
    $stmt = $pdo->query("SELECT id, name, email, role, status FROM users ORDER BY role, id");
    $users = $stmt->fetchAll();
    
    if (empty($users)) {
        echo "<p>No users found in database</p>";
    } else {
        echo "<table border='1' cellpadding='8' style='border-collapse: collapse; width: 100%;'>";
        echo "<tr style='background-color: #f2f2f2;'>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
              </tr>";
        
        foreach ($users as $user) {
            $rowColor = $user['role'] == 'admin' ? '#e8f4fc' : 
                       ($user['role'] == 'doctor' ? '#f0f8ff' : 
                       ($user['role'] == 'patient' ? '#f9f9f9' : '#ffffff'));
            
            echo "<tr style='background-color: $rowColor;'>
                    <td>{$user['id']}</td>
                    <td>{$user['name']}</td>
                    <td>{$user['email']}</td>
                    <td>{$user['role']}</td>
                    <td>{$user['status']}</td>
                  </tr>";
        }
        echo "</table>";
    }
    
    // Test password verification
    echo "<h3>Step 4: Testing Password Verification</h3>";
    
    $stmt = $pdo->prepare("SELECT password FROM users WHERE email = ?");
    $stmt->execute([$adminEmail]);
    $adminData = $stmt->fetch();
    
    if ($adminData) {
        $isValid = password_verify($adminPassword, $adminData['password']);
        echo "<p>Password verification for '$adminEmail': ";
        echo $isValid ? "<span style='color: green;'>‚úÖ SUCCESS</span>" : 
                        "<span style='color: red;'>‚ùå FAILED</span>";
        echo "</p>";
        
        if (!$isValid) {
            echo "<p>Generating new hash...</p>";
            $newHash = password_hash($adminPassword, PASSWORD_DEFAULT);
            echo "<p>New hash: " . substr($newHash, 0, 30) . "...</p>";
        }
    }
    
    // Create test users for all roles
    echo "<h3>Step 5: Creating Test Users for All Roles</h3>";
    
    $testUsers = [
        ['name' => 'Test Doctor', 'email' => 'doctor@hospital.com', 'password' => 'doctor123', 'role' => 'doctor'],
        ['name' => 'Test Patient', 'email' => 'patient@hospital.com', 'password' => 'patient123', 'role' => 'patient'],
        ['name' => 'Test Receptionist', 'email' => 'reception@hospital.com', 'password' => 'reception123', 'role' => 'receptionist']
    ];
    
    foreach ($testUsers as $testUser) {
        $stmt = $pdo->prepare("SELECT id FROM users WHERE email = ?");
        $stmt->execute([$testUser['email']]);
        
        if (!$stmt->fetch()) {
            $hash = password_hash($testUser['password'], PASSWORD_DEFAULT);
            $insert = $pdo->prepare("
                INSERT INTO users (name, email, password, role, status) 
                VALUES (?, ?, ?, ?, 'active')
            ");
            
            if ($insert->execute([$testUser['name'], $testUser['email'], $hash, $testUser['role']])) {
                echo "<p>‚úÖ Created {$testUser['role']}: {$testUser['email']} / {$testUser['password']}</p>";
            }
        } else {
            echo "<p>‚è© {$testUser['role']} {$testUser['email']} already exists</p>";
        }
    }
    
    echo "<h3>Step 6: Testing the Actual Login</h3>";
    
    echo '<div style="background: #f9f9f9; padding: 20px; border-radius: 10px; margin: 20px 0;">';
    echo '<h4>Test Credentials:</h4>';
    echo '<table border="1" cellpadding="10" style="border-collapse: collapse;">';
    echo '<tr style="background-color: #e8f4fc;">
            <th>Role</th>
            <th>Email</th>
            <th>Password</th>
            <th>Test Link</th>
          </tr>';
    
    $allUsers = [
        ['admin', 'admin@hospital.com', 'admin123'],
        ['doctor', 'doctor@hospital.com', 'doctor123'],
        ['patient', 'patient@hospital.com', 'patient123'],
        ['receptionist', 'reception@hospital.com', 'reception123']
    ];
    
    foreach ($allUsers as $user) {
        list($role, $email, $password) = $user;
        
        // Test password
        $stmt = $pdo->prepare("SELECT password, status FROM users WHERE email = ?");
        $stmt->execute([$email]);
        $userData = $stmt->fetch();
        
        $passwordValid = $userData ? password_verify($password, $userData['password']) : false;
        $statusOk = $userData && $userData['status'] == 'active';
        
        echo "<tr>";
        echo "<td>$role</td>";
        echo "<td>$email</td>";
        echo "<td>$password " . 
             ($passwordValid ? "<span style='color: green;'>‚úÖ</span>" : "<span style='color: red;'>‚ùå</span>") .
             "</td>";
        echo '<td>';
        if ($passwordValid && $statusOk) {
            echo '<form method="POST" action="public/index.php?page=login" target="_blank" style="display: inline;">
                    <input type="hidden" name="email" value="' . $email . '">
                    <input type="hidden" name="password" value="' . $password . '">
                    <input type="hidden" name="role" value="' . $role . '">
                    <button type="submit" style="padding: 5px 10px; background: #1a6aa2; color: white; border: none; border-radius: 3px; cursor: pointer;">
                        Test Login
                    </button>
                  </form>';
        } else {
            echo '<span style="color: red;">Cannot test - check credentials</span>';
        }
        echo '</td>';
        echo "</tr>";
    }
    
    echo '</table>';
    echo '</div>';
    
    echo '<h3>Step 7: Quick Manual Test</h3>';
    echo '<p>Try logging in manually:</p>';
    echo '<ol>';
    echo '<li>Go to: <a href="' . APP_URL . '/public/index.php?page=login" target="_blank">Login Page</a></li>';
    echo '<li>Use Email: <strong>admin@hospital.com</strong></li>';
    echo '<li>Use Password: <strong>admin123</strong></li>';
    echo '<li>Select Role: <strong>Admin</strong></li>';
    echo '<li>Click Login</li>';
    echo '</ol>';
    
    echo '<p style="color: blue; font-weight: bold;">If it still doesn\'t work, the issue is in your AuthController.php. Let me help you fix it...</p>';
    
} catch (PDOException $e) {
    echo "<p style='color: red;'>‚ùå Database Error: " . $e->getMessage() . "</p>";
    echo "<p>Common issues:</p>";
    echo "<ol>";
    echo "<li>Database doesn't exist: Run this SQL first:</li>";
    echo "</ol>";
    
    echo "<pre style='background: #333; color: #fff; padding: 10px;'>";
    echo "CREATE DATABASE IF NOT EXISTS hospital_management;
USE hospital_management;

CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('admin', 'receptionist', 'doctor', 'patient') NOT NULL,
    phone VARCHAR(20),
    specialization VARCHAR(100),
    department_id INT,
    status ENUM('active', 'inactive', 'on_leave') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);";
    echo "</pre>";
}
?>

================================================================================
FILE: index.html
================================================================================

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="refresh" content="0; url=public/index.php?page=login">
    <title>Kasr Al Ainy Hospital</title>
</head>
<body>
    <p>Redirecting to the Hospital Management System...</p>
    <p>If you are not redirected, <a href="public/index.php?page=login">click here to login</a>.</p>
</body>
</html>

================================================================================
FILE: code_contents.txt
================================================================================

CODE FILES COLLECTION
Root Directory: /Applications/XAMPP/xamppfiles/htdocs/OOP_PROJECT/hospital-management-system
Generated on: 1767442439.3331695
================================================================================


================================================================================
FILE: debug_admin_login.php
================================================================================

<?php
// debug_admin_login.php
session_start();
error_reporting(E_ALL);
ini_set('display_errors', 1);

echo "<h2>Admin Login Debug</h2>";

// Include necessary files
require_once __DIR__ . '/core/Database.php';
require_once __DIR__ . '/core/Auth.php';
require_once __DIR__ . '/models/UserFactory.php';

echo "<h3>1. Testing Database Connection</h3>";
try {
    $db = \Core\Database::getInstance()->getConnection();
    echo "<p style='color: green;'>‚úÖ Database connected</p>";
    
    // Check all admin users
    $stmt = $db->prepare("SELECT * FROM users WHERE role = 'admin'");
    $stmt->execute();
    $admins = $stmt->fetchAll();
    
    if (empty($admins)) {
        echo "<p style='color: red;'>‚ùå No admin users found in database!</p>";
        
        // Create an admin user
        echo "<p>Creating admin user...</p>";
        $password = 'admin123';
        $hash = password_hash($password, PASSWORD_DEFAULT);
        
        $insert = $db->prepare("
            INSERT INTO users (name, email, password, role, status) 
            VALUES ('Admin User', 'admin@hospital.com', ?, 'admin', 'active')
        ");
        
        if ($insert->execute([$hash])) {
            echo "<p style='color: green;'>‚úÖ Admin user created!</p>";
            echo "<p>Email: admin@hospital.com</p>";
            echo "<p>Password: admin123</p>";
        }
    } else {
        echo "<p>Found " . count($admins) . " admin users:</p>";
        echo "<table border='1' cellpadding='5'>";
        echo "<tr><th>ID</th><th>Name</th><th>Email</th><th>Status</th><th>Password Hash</th></tr>";
        foreach ($admins as $admin) {
            echo "<tr>";
            echo "<td>{$admin['id']}</td>";
            echo "<td>{$admin['name']}</td>";
            echo "<td>{$admin['email']}</td>";
            echo "<td>{$admin['status']}</td>";
            echo "<td>" . substr($admin['password'], 0, 30) . "...</td>";
            echo "</tr>";
        }
        echo "</table>";
    }
    
} catch (Exception $e) {
    echo "<p style='color: red;'>‚ùå Database error: " . $e->getMessage() . "</p>";
}

echo "<h3>2. Testing Auth::login() Method Directly</h3>";
try {
    $auth = Core\Auth::getInstance();
    
    // Test admin login
    $adminEmail = 'admin@hospital.com';
    $adminPassword = 'admin123';
    
    echo "<p>Testing Auth::login('$adminEmail', '$adminPassword')</p>";
    
    $adminUser = $auth->login($adminEmail, $adminPassword);
    
    if ($adminUser) {
        echo "<p style='color: green;'>‚úÖ Auth::login() SUCCESS!</p>";
        echo "<p>User ID: " . $adminUser->getId() . "</p>";
        echo "<p>User Role: " . $adminUser->getRole() . "</p>";
        echo "<p>User Name: " . $adminUser->getName() . "</p>";
        
        // Check session
        echo "<h4>Session Data:</h4>";
        echo "<pre>";
        print_r($_SESSION);
        echo "</pre>";
    } else {
        echo "<p style='color: red;'>‚ùå Auth::login() FAILED for admin!</p>";
        
        // Let's debug why
        echo "<h4>Debugging the failure:</h4>";
        
        // Check if user exists
        $stmt = $db->prepare("SELECT * FROM users WHERE email = ?");
        $stmt->execute([$adminEmail]);
        $userData = $stmt->fetch();
        
        if ($userData) {
            echo "<p>‚úÖ User found in database</p>";
            echo "<p>Status: " . $userData['status'] . "</p>";
            
            // Test password verification
            $isValid = password_verify($adminPassword, $userData['password']);
            echo "<p>Password verification: " . ($isValid ? "‚úÖ VALID" : "‚ùå INVALID") . "</p>";
            
            if (!$isValid) {
                echo "<p>Let's fix the password...</p>";
                $newHash = password_hash($adminPassword, PASSWORD_DEFAULT);
                $update = $db->prepare("UPDATE users SET password = ? WHERE email = ?");
                $update->execute([$newHash, $adminEmail]);
                echo "<p>Password updated. New hash created.</p>";
                
                // Try login again
                $adminUser = $auth->login($adminEmail, $adminPassword);
                if ($adminUser) {
                    echo "<p style='color: green;'>‚úÖ Login works after password fix!</p>";
                }
            }
        } else {
            echo "<p>‚ùå User not found in database</p>";
        }
    }
    
} catch (Exception $e) {
    echo "<p style='color: red;'>‚ùå Auth error: " . $e->getMessage() . "</p>";
}

echo "<h3>3. Testing Patient Login (for comparison)</h3>";
try {
    // Check if patient exists
    $patientEmail = 'patient@hospital.com';
    $patientPassword = 'patient123';
    
    $stmt = $db->prepare("SELECT * FROM users WHERE email = ? AND role = 'patient'");
    $stmt->execute([$patientEmail]);
    $patient = $stmt->fetch();
    
    if ($patient) {
        echo "<p>Patient found: {$patient['name']}</p>";
        
        // Test patient login
        $patientUser = $auth->login($patientEmail, $patientPassword);
        
        if ($patientUser) {
            echo "<p style='color: green;'>‚úÖ Patient login works!</p>";
            echo "<p>This means Auth::login() works for patients but not admins.</p>";
            
            // Logout
            $auth->logout();
        } else {
            echo "<p style='color: red;'>‚ùå Patient login also fails!</p>";
        }
    } else {
        echo "<p>No patient user found with email: $patientEmail</p>";
    }
    
} catch (Exception $e) {
    echo "<p style='color: red;'>‚ùå Patient test error: " . $e->getMessage() . "</p>";
}

echo "<h3>4. Testing the Actual Login Flow</h3>";
echo '<form method="POST" action="public/index.php?page=login" target="_blank">
    <input type="hidden" name="email" value="admin@hospital.com">
    <input type="hidden" name="password" value="admin123">
    <input type="hidden" name="role" value="admin">
    <button type="submit" style="padding: 10px 20px; background: #1a6aa2; color: white; border: none; border-radius: 5px;">
        Test Admin Login Form
    </button>
</form>';

echo "<h3>5. Check Your AuthController</h3>";
echo "<p>The issue might be in AuthController.php. Let me show you what to check:</p>";
echo "<pre style='background: #f5f5f5; padding: 10px;'>";
echo "Check if AuthController is properly checking the role.\n";
echo "In AuthController::login(), look for this logic:\n\n";
echo "if (\$user) {
    \$actualRole = \$user->getRole();
    
    // This might be the problem - checking if selected role matches
    if (empty(\$selectedRole) || \$selectedRole === \$actualRole) {
        \$this->redirectToDashboard(\$actualRole);
    } else {
        // Shows error about wrong role
        \$auth->logout();
        \$this->view('auth/login', [
            'error' => \"Please select correct role: \" . ucfirst(\$actualRole)
        ]);
    }
}";
echo "</pre>";
?>

================================================================================
FILE: fix_admin_final.php
================================================================================

<?php
// fix_admin_final.php - Complete solution
session_start();
error_reporting(E_ALL);
ini_set('display_errors', 1);

echo "<h2>üöÄ Fixing Admin Login - Complete Solution</h2>";

// Define database constants if not already defined
if (!defined('DB_HOST')) define('DB_HOST', 'localhost');
if (!defined('DB_NAME')) define('DB_NAME', 'hospital_management');
if (!defined('DB_USER')) define('DB_USER', 'root');
if (!defined('DB_PASS')) define('DB_PASS', '');
if (!defined('DB_CHARSET')) define('DB_CHARSET', 'utf8mb4');
if (!defined('APP_URL')) define('APP_URL', 'http://localhost/OOP_PROJECT/hospital-management-system');

echo "<h3>Step 1: Testing Database Connection</h3>";

try {
    // Direct PDO connection first
    $pdo = new PDO(
        "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=" . DB_CHARSET,
        DB_USER,
        DB_PASS,
        [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC
        ]
    );
    
    echo "<p style='color: green;'>‚úÖ Direct database connection successful!</p>";
    
    // Create admin user if doesn't exist
    echo "<h3>Step 2: Checking/Creating Admin User</h3>";
    
    $adminEmail = 'admin@hospital.com';
    $adminPassword = 'admin123';
    
    // Check if admin exists
    $stmt = $pdo->prepare("SELECT * FROM users WHERE email = ?");
    $stmt->execute([$adminEmail]);
    $admin = $stmt->fetch();
    
    if (!$admin) {
        echo "<p>No admin user found. Creating one...</p>";
        
        $hash = password_hash($adminPassword, PASSWORD_DEFAULT);
        
        $insert = $pdo->prepare("
            INSERT INTO users (name, email, password, role, phone, status) 
            VALUES (?, ?, ?, 'admin', '+201000000000', 'active')
        ");
        
        if ($insert->execute(['Main Administrator', $adminEmail, $hash])) {
            echo "<p style='color: green;'>‚úÖ Admin user created successfully!</p>";
            echo "<p>Email: $adminEmail</p>";
            echo "<p>Password: $adminPassword</p>";
        }
    } else {
        echo "<p>Admin user found:</p>";
        echo "<pre>";
        print_r([
            'id' => $admin['id'],
            'name' => $admin['name'],
            'email' => $admin['email'],
            'role' => $admin['role'],
            'status' => $admin['status']
        ]);
        echo "</pre>";
        
        // Update password to ensure it's correct
        $hash = password_hash($adminPassword, PASSWORD_DEFAULT);
        $update = $pdo->prepare("UPDATE users SET password = ? WHERE email = ?");
        $update->execute([$hash, $adminEmail]);
        
        echo "<p style='color: green;'>‚úÖ Admin password reset to: $adminPassword</p>";
    }
    
    // Verify all users in database
    echo "<h3>Step 3: All Users in Database</h3>";
    
    $stmt = $pdo->query("SELECT id, name, email, role, status FROM users ORDER BY role, id");
    $users = $stmt->fetchAll();
    
    if (empty($users)) {
        echo "<p>No users found in database</p>";
    } else {
        echo "<table border='1' cellpadding='8' style='border-collapse: collapse; width: 100%;'>";
        echo "<tr style='background-color: #f2f2f2;'>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
              </tr>";
        
        foreach ($users as $user) {
            $rowColor = $user['role'] == 'admin' ? '#e8f4fc' : 
                       ($user['role'] == 'doctor' ? '#f0f8ff' : 
                       ($user['role'] == 'patient' ? '#f9f9f9' : '#ffffff'));
            
            echo "<tr style='background-color: $rowColor;'>
                    <td>{$user['id']}</td>
                    <td>{$user['name']}</td>
                    <td>{$user['email']}</td>
                    <td>{$user['role']}</td>
                    <td>{$user['status']}</td>
                  </tr>";
        }
        echo "</table>";
    }
    
    // Test password verification
    echo "<h3>Step 4: Testing Password Verification</h3>";
    
    $stmt = $pdo->prepare("SELECT password FROM users WHERE email = ?");
    $stmt->execute([$adminEmail]);
    $adminData = $stmt->fetch();
    
    if ($adminData) {
        $isValid = password_verify($adminPassword, $adminData['password']);
        echo "<p>Password verification for '$adminEmail': ";
        echo $isValid ? "<span style='color: green;'>‚úÖ SUCCESS</span>" : 
                        "<span style='color: red;'>‚ùå FAILED</span>";
        echo "</p>";
        
        if (!$isValid) {
            echo "<p>Generating new hash...</p>";
            $newHash = password_hash($adminPassword, PASSWORD_DEFAULT);
            echo "<p>New hash: " . substr($newHash, 0, 30) . "...</p>";
        }
    }
    
    // Create test users for all roles
    echo "<h3>Step 5: Creating Test Users for All Roles</h3>";
    
    $testUsers = [
        ['name' => 'Test Doctor', 'email' => 'doctor@hospital.com', 'password' => 'doctor123', 'role' => 'doctor'],
        ['name' => 'Test Patient', 'email' => 'patient@hospital.com', 'password' => 'patient123', 'role' => 'patient'],
        ['name' => 'Test Receptionist', 'email' => 'reception@hospital.com', 'password' => 'reception123', 'role' => 'receptionist']
    ];
    
    foreach ($testUsers as $testUser) {
        $stmt = $pdo->prepare("SELECT id FROM users WHERE email = ?");
        $stmt->execute([$testUser['email']]);
        
        if (!$stmt->fetch()) {
            $hash = password_hash($testUser['password'], PASSWORD_DEFAULT);
            $insert = $pdo->prepare("
                INSERT INTO users (name, email, password, role, status) 
                VALUES (?, ?, ?, ?, 'active')
            ");
            
            if ($insert->execute([$testUser['name'], $testUser['email'], $hash, $testUser['role']])) {
                echo "<p>‚úÖ Created {$testUser['role']}: {$testUser['email']} / {$testUser['password']}</p>";
            }
        } else {
            echo "<p>‚è© {$testUser['role']} {$testUser['email']} already exists</p>";
        }
    }
    
    echo "<h3>Step 6: Testing the Actual Login</h3>";
    
    echo '<div style="background: #f9f9f9; padding: 20px; border-radius: 10px; margin: 20px 0;">';
    echo '<h4>Test Credentials:</h4>';
    echo '<table border="1" cellpadding="10" style="border-collapse: collapse;">';
    echo '<tr style="background-color: #e8f4fc;">
            <th>Role</th>
            <th>Email</th>
            <th>Password</th>
            <th>Test Link</th>
          </tr>';
    
    $allUsers = [
        ['admin', 'admin@hospital.com', 'admin123'],
        ['doctor', 'doctor@hospital.com', 'doctor123'],
        ['patient', 'patient@hospital.com', 'patient123'],
        ['receptionist', 'reception@hospital.com', 'reception123']
    ];
    
    foreach ($allUsers as $user) {
        list($role, $email, $password) = $user;
        
        // Test password
        $stmt = $pdo->prepare("SELECT password, status FROM users WHERE email = ?");
        $stmt->execute([$email]);
        $userData = $stmt->fetch();
        
        $passwordValid = $userData ? password_verify($password, $userData['password']) : false;
        $statusOk = $userData && $userData['status'] == 'active';
        
        echo "<tr>";
        echo "<td>$role</td>";
        echo "<td>$email</td>";
        echo "<td>$password " . 
             ($passwordValid ? "<span style='color: green;'>‚úÖ</span>" : "<span style='color: red;'>‚ùå</span>") .
             "</td>";
        echo '<td>';
        if ($passwordValid && $statusOk) {
            echo '<form method="POST" action="public/index.php?page=login" target="_blank" style="display: inline;">
                    <input type="hidden" name="email" value="' . $email . '">
                    <input type="hidden" name="password" value="' . $password . '">
                    <input type="hidden" name="role" value="' . $role . '">
                    <button type="submit" style="padding: 5px 10px; background: #1a6aa2; color: white; border: none; border-radius: 3px; cursor: pointer;">
                        Test Login
                    </button>
                  </form>';
        } else {
            echo '<span style="color: red;">Cannot test - check credentials</span>';
        }
        echo '</td>';
        echo "</tr>";
    }
    
    echo '</table>';
    echo '</div>';
    
    echo '<h3>Step 7: Quick Manual Test</h3>';
    echo '<p>Try logging in manually:</p>';
    echo '<ol>';
    echo '<li>Go to: <a href="' . APP_URL . '/public/index.php?page=login" target="_blank">Login Page</a></li>';
    echo '<li>Use Email: <strong>admin@hospital.com</strong></li>';
    echo '<li>Use Password: <strong>admin123</strong></li>';
    echo '<li>Select Role: <strong>Admin</strong></li>';
    echo '<li>Click Login</li>';
    echo '</ol>';
    
    echo '<p style="color: blue; font-weight: bold;">If it still doesn\'t work, the issue is in your AuthController.php. Let me help you fix it...</p>';
    
} catch (PDOException $e) {
    echo "<p style='color: red;'>‚ùå Database Error: " . $e->getMessage() . "</p>";
    echo "<p>Common issues:</p>";
    echo "<ol>";
    echo "<li>Database doesn't exist: Run this SQL first:</li>";
    echo "</ol>";
    
    echo "<pre style='background: #333; color: #fff; padding: 10px;'>";
    echo "CREATE DATABASE IF NOT EXISTS hospital_management;
USE hospital_management;

CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('admin', 'receptionist', 'doctor', 'patient') NOT NULL,
    phone VARCHAR(20),
    specialization VARCHAR(100),
    department_id INT,
    status ENUM('active', 'inactive', 'on_leave') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);";
    echo "</pre>";
}
?>

================================================================================
FILE: fix_all_passwords.php
================================================================================

<?php
// fix_all_passwords.php
session_start();
error_reporting(E_ALL);
ini_set('display_errors', 1);

echo "<h2>üîß Fixing All User Passwords</h2>";

// Define database constants
if (!defined('DB_HOST')) define('DB_HOST', 'localhost');
if (!defined('DB_NAME')) define('DB_NAME', 'hospital_management');
if (!defined('DB_USER')) define('DB_USER', 'root');
if (!defined('DB_PASS')) define('DB_PASS', '');
if (!defined('DB_CHARSET')) define('DB_CHARSET', 'utf8mb4');

try {
    $pdo = new PDO(
        "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=" . DB_CHARSET,
        DB_USER,
        DB_PASS,
        [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC
        ]
    );
    
    echo "<p style='color: green;'>‚úÖ Database connected</p>";
    
    // Fix passwords for all users
    $usersToFix = [
        ['doctor@hospital.com', 'doctor123'],
        ['patient@hospital.com', 'patient123'],
        ['reception@hospital.com', 'reception123'],
        ['sarah@hospital.com', 'doctor123'],
        ['omar@hospital.com', 'doctor123'],
        ['fatima@hospital.com', 'doctor123']
    ];
    
    echo "<h3>Fixing User Passwords:</h3>";
    
    foreach ($usersToFix as $user) {
        list($email, $password) = $user;
        
        // Check if user exists
        $stmt = $pdo->prepare("SELECT id, name FROM users WHERE email = ?");
        $stmt->execute([$email]);
        $userData = $stmt->fetch();
        
        if ($userData) {
            $hash = password_hash($password, PASSWORD_DEFAULT);
            
            $update = $pdo->prepare("UPDATE users SET password = ? WHERE email = ?");
            $update->execute([$hash, $email]);
            
            // Verify
            $verify = password_verify($password, $hash);
            
            echo "<p>{$userData['name']} ({$email}): ";
            echo $verify ? "<span style='color: green;'>‚úÖ Fixed - Password: $password</span>" :
                          "<span style='color: red;'>‚ùå Failed</span>";
            echo "</p>";
        } else {
            echo "<p style='color: orange;'>‚ö†Ô∏è User not found: $email</p>";
        }
    }
    
    // Show all users with their roles
    echo "<h3>All Users with Fixed Passwords:</h3>";
    
    $stmt = $pdo->query("SELECT id, name, email, role, status FROM users ORDER BY role, id");
    $users = $stmt->fetchAll();
    
    echo "<table border='1' cellpadding='8' style='border-collapse: collapse; width: 100%;'>";
    echo "<tr style='background-color: #f2f2f2;'>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th>Test Password</th>
          </tr>";
    
    $passwords = [
        'admin@hospital.com' => 'admin123',
        'doctor@hospital.com' => 'doctor123',
        'patient@hospital.com' => 'patient123',
        'reception@hospital.com' => 'reception123',
        'sarah@hospital.com' => 'doctor123',
        'omar@hospital.com' => 'doctor123',
        'fatima@hospital.com' => 'doctor123'
    ];
    
    foreach ($users as $user) {
        $password = $passwords[$user['email']] ?? 'unknown';
        
        $rowColor = $user['role'] == 'admin' ? '#e8f4fc' : 
                   ($user['role'] == 'doctor' ? '#f0f8ff' : 
                   ($user['role'] == 'patient' ? '#f9f9f9' : '#ffffff'));
        
        echo "<tr style='background-color: $rowColor;'>
                <td>{$user['id']}</td>
                <td>{$user['name']}</td>
                <td>{$user['email']}</td>
                <td>{$user['role']}</td>
                <td>{$user['status']}</td>
                <td>$password</td>
              </tr>";
    }
    echo "</table>";
    
    echo "<h3>Test Login Links:</h3>";
    echo '<table border="1" cellpadding="10" style="border-collapse: collapse; margin: 20px 0;">';
    echo '<tr style="background-color: #e8f4fc;">
            <th>Role</th>
            <th>Email</th>
            <th>Password</th>
            <th>Test</th>
          </tr>';
    
    $testUsers = [
        ['Admin', 'admin@hospital.com', 'admin123'],
        ['Doctor', 'doctor@hospital.com', 'doctor123'],
        ['Patient', 'patient@hospital.com', 'patient123'],
        ['Receptionist', 'reception@hospital.com', 'reception123']
    ];
    
    foreach ($testUsers as $testUser) {
        list($role, $email, $password) = $testUser;
        
        echo "<tr>";
        echo "<td><strong>$role</strong></td>";
        echo "<td>$email</td>";
        echo "<td>$password</td>";
        echo '<td>';
        echo '<form method="POST" action="public/index.php?page=login" target="_blank" style="display: inline;">
                <input type="hidden" name="email" value="' . $email . '">
                <input type="hidden" name="password" value="' . $password . '">
                <input type="hidden" name="role" value="' . strtolower($role) . '">
                <button type="submit" style="padding: 5px 10px; background: #1a6aa2; color: white; border: none; border-radius: 3px; cursor: pointer;">
                    Test Login
                </button>
              </form>';
        echo '</td>';
        echo "</tr>";
    }
    
    echo '</table>';
    
    echo '<h3>Next Steps:</h3>';
    echo '<ol>';
    echo '<li>Replace your <strong>controllers/AuthController.php</strong> with the fixed version above</li>';
    echo '<li>Clear browser cache or use incognito mode</li>';
    echo '<li>Try logging in with admin credentials</li>';
    echo '</ol>';
    
} catch (PDOException $e) {
    echo "<p style='color: red;'>‚ùå Database Error: " . $e->getMessage() . "</p>";
}
?>

================================================================================
FILE: debug_auth.php
================================================================================

<?php
// Test password hash
$password = 'admin123';
$hash = password_hash($password, PASSWORD_DEFAULT);
echo "Password: $password<br>";
echo "Hash: $hash<br>";
echo "Verify: " . (password_verify($password, $hash) ? 'YES' : 'NO');

// Test database connection
try {
    $pdo = new PDO('mysql:host=localhost;dbname=hospital_management', 'root', '');
    echo "<br>Database connection: OK";
} catch (PDOException $e) {
    echo "<br>Database connection failed: " . $e->getMessage();
}
?>

================================================================================
FILE: apply_route_fix.php
================================================================================

<?php
// apply_route_fix.php
session_start();

echo "<h2>Applying Route Fix</h2>";

$indexFile = __DIR__ . '/public/index.php';

if (!file_exists($indexFile)) {
    die("<p style='color: red;'>‚ùå index.php not found at: $indexFile</p>");
}

// Read the current file
$content = file_get_contents($indexFile);

// Check if routes array exists
if (strpos($content, '$routes = [') === false) {
    die("<p style='color: red;'>‚ùå Could not find routes array in index.php</p>");
}

// Define the admin routes to add
$adminRoutes = [
    "'admin-dashboard' => ['AdminController', 'dashboard'],",
    "'admin-doctors' => ['AdminController', 'doctors'],",
    "'admin-add-doctor' => ['AdminController', 'addDoctor'],",
    "'admin-edit-doctor' => ['AdminController', 'editDoctor'],",
    "'admin-delete-doctor' => ['AdminController', 'deleteDoctor'],",
    "'admin-users' => ['AdminController', 'users'],",
    "'admin-add-user' => ['AdminController', 'addUser'],",
    "'admin-edit-user' => ['AdminController', 'editUser'],",
    "'admin-delete-user' => ['AdminController', 'deleteUser'],",
    "'admin-departments' => ['AdminController', 'departments'],",
    "'admin-add-department' => ['AdminController', 'addDepartment'],",
    "'admin-edit-department' => ['AdminController', 'editDepartment'],",
    "'admin-delete-department' => ['AdminController', 'deleteDepartment'],",
    "'admin-appointments' => ['AdminController', 'appointments'],",
    "'admin-add-appointment' => ['AdminController', 'addAppointment'],",
    "'admin-edit-appointment' => ['AdminController', 'editAppointment'],",
    "'admin-delete-appointment' => ['AdminController', 'deleteAppointment'],"
];

// Create the routes block
$routesBlock = "    // Admin routes\n";
foreach ($adminRoutes as $route) {
    $routesBlock .= "    " . $route . "\n";
}

// Check if admin routes already exist
if (strpos($content, "'admin-add-doctor'") !== false) {
    echo "<p style='color: orange;'>‚ö†Ô∏è Admin routes already exist in index.php</p>";
    
    // Just ensure all routes are there
    $missingRoutes = [];
    foreach ($adminRoutes as $route) {
        $routeName = explode("'", $route)[1];
        if (strpos($content, "'$routeName'") === false) {
            $missingRoutes[] = $route;
        }
    }
    
    if (empty($missingRoutes)) {
        echo "<p style='color: green;'>‚úÖ All admin routes are already present</p>";
    } else {
        echo "<p style='color: orange;'>‚ö†Ô∏è Missing " . count($missingRoutes) . " routes</p>";
        
        // Add missing routes before the closing bracket of the routes array
        $pos = strrpos($content, '];');
        if ($pos !== false) {
            $newContent = substr($content, 0, $pos);
            $newContent .= "\n    // Added missing admin routes\n";
            foreach ($missingRoutes as $route) {
                $newContent .= "    " . $route . "\n";
            }
            $newContent .= substr($content, $pos);
            
            file_put_contents($indexFile, $newContent);
            echo "<p style='color: green;'>‚úÖ Added missing routes to index.php</p>";
        }
    }
} else {
    // Insert admin routes before the closing bracket of routes array
    $pos = strrpos($content, '];');
    if ($pos !== false) {
        $newContent = substr($content, 0, $pos);
        $newContent .= "\n" . $routesBlock;
        $newContent .= substr($content, $pos);
        
        // Backup original file
        $backupFile = __DIR__ . '/public/index.php.backup_' . date('Ymd_His');
        copy($indexFile, $backupFile);
        
        // Write new content
        file_put_contents($indexFile, $newContent);
        
        echo "<p style='color: green;'>‚úÖ Added admin routes to index.php</p>";
        echo "<p>Backup saved to: " . basename($backupFile) . "</p>";
    } else {
        echo "<p style='color: red;'>‚ùå Could not find end of routes array</p>";
    }
}

// Show the updated routes section
echo "<h3>Updated Routes Section:</h3>";
$updatedContent = file_get_contents($indexFile);
if (preg_match('/\$routes\s*=\s*\[(.*?)\];/s', $updatedContent, $matches)) {
    echo "<pre>" . htmlspecialchars($matches[0]) . "</pre>";
}

echo '<p><a href="debug_routing.php">Go back to debug</a></p>';
echo '<p><a href="public/index.php?page=admin-add-doctor">Test admin-add-doctor route</a></p>';
?>

================================================================================
FILE: fix_admin_password.php
================================================================================

<?php
// reset_admin_passwords.php
// Place this in your project root and run it

session_start();

// Include database connection
require_once __DIR__ . '/core/Database.php';

echo "<h2>Resetting Admin Passwords</h2>";

try {
    $db = \Core\Database::getInstance()->getConnection();
    
    // Delete existing admins first
    echo "<p>Clearing existing admin users...</p>";
    $db->query("DELETE FROM users WHERE role = 'admin'");
    
    // Create 5 admin users with KNOWN passwords
    $admins = [
        ['name' => 'Super Admin', 'email' => 'superadmin@hospital.com', 'password' => 'admin123'],
        ['name' => 'System Admin', 'email' => 'sysadmin@hospital.com', 'password' => 'admin456'],
        ['name' => 'Hospital Director', 'email' => 'director@hospital.com', 'password' => 'hospital123'],
        ['name' => 'IT Manager', 'email' => 'itmanager@hospital.com', 'password' => 'itadmin123'],
        ['name' => 'Finance Admin', 'email' => 'finance@hospital.com', 'password' => 'finance123']
    ];
    
    foreach ($admins as $admin) {
        $hash = password_hash($admin['password'], PASSWORD_DEFAULT);
        
        $stmt = $db->prepare("
            INSERT INTO users (name, email, password, role, phone, status) 
            VALUES (?, ?, ?, 'admin', '+201000000001', 'active')
        ");
        
        $result = $stmt->execute([
            $admin['name'],
            $admin['email'],
            $hash
        ]);
        
        echo "<p>";
        if ($result) {
            echo "‚úÖ Created admin: {$admin['email']} with password: {$admin['password']}";
        } else {
            echo "‚ùå Failed to create: {$admin['email']}";
        }
        echo "</p>";
    }
    
    // Verify the passwords work
    echo "<h3>Verifying Passwords:</h3>";
    foreach ($admins as $admin) {
        $stmt = $db->prepare("SELECT password FROM users WHERE email = ?");
        $stmt->execute([$admin['email']]);
        $user = $stmt->fetch();
        
        if ($user) {
            $isValid = password_verify($admin['password'], $user['password']);
            echo "<p>{$admin['email']}: " . ($isValid ? "‚úÖ Password VERIFIED" : "‚ùå Password INVALID") . "</p>";
        }
    }
    
    // Show all admins
    echo "<h3>All Admin Users in Database:</h3>";
    $stmt = $db->prepare("SELECT id, name, email, status FROM users WHERE role = 'admin'");
    $stmt->execute();
    $allAdmins = $stmt->fetchAll();
    
    echo "<table border='1' cellpadding='5'>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Status</th>
        </tr>";
    
    foreach ($allAdmins as $admin) {
        echo "<tr>
            <td>{$admin['id']}</td>
            <td>{$admin['name']}</td>
            <td>{$admin['email']}</td>
            <td>{$admin['status']}</td>
        </tr>";
    }
    echo "</table>";
    
    echo "<h3>Test Login Credentials:</h3>";
    echo "<ul>";
    foreach ($admins as $admin) {
        echo "<li><strong>Email:</strong> {$admin['email']} | <strong>Password:</strong> {$admin['password']}</li>";
    }
    echo "</ul>";
    
    echo '<p><a href="public/index.php?page=login">Go to Login Page</a></p>';
    
} catch (Exception $e) {
    echo "<p style='color: red;'>Error: " . $e->getMessage() . "</p>";
}
?>

================================================================================
FILE: README.md
================================================================================

# Kasr Al Ainy Hospital Management System

A complete full-stack hospital management system implementing OOP principles and design patterns.

## Features

- **Three User Roles**: Admin, Receptionist, Doctor, Patient
- **Design Patterns**: Singleton, Factory, Observer, Strategy, Decorator
- **MVC Architecture**: Clean separation of concerns
- **Responsive UI**: Modern hospital-themed interface
- **Secure Authentication**: Role-based access control
- **Real-time Notifications**: Observer pattern for appointment updates

## Installation

1. Clone the repository
2. Import database schema: `hospital_management.sql`
3. Configure database in `config/database.php`
4. Run `composer install`
5. Access via web server

## Default Credentials

- Admin: admin@hospital.com / admin123
- Doctor: doctor@hospital.com / doctor123
- Receptionist: reception@hospital.com / reception123

## Design Patterns Used

1. **Singleton**: HospitalSystem class
2. **Factory**: UserFactory for creating different user types
3. **Observer**: Appointment notifications to patients
4. **Strategy**: Authentication strategies
5. **Decorator**: User permission extensions

## UML Diagrams

See `docs/` directory for:
- Class Diagram
- Sequence Diagrams
- Use Case Diagrams
- ER Diagram

## Testing

Run unit tests:
```bash
php tests/UnitTests.php

================================================================================
FILE: debug_routing.php
================================================================================

<?php
// debug_routing.php
session_start();
error_reporting(E_ALL);
ini_set('display_errors', 1);

echo "<h2>üîß Debug Routing Issues</h2>";

// Check if we can access the route directly
echo "<h3>1. Testing Direct Route Access</h3>";

$testUrls = [
    'public/index.php?page=admin-add-doctor',
    'public/index.php?page=admin-dashboard',
    'public/index.php?page=admin-doctors'
];

foreach ($testUrls as $url) {
    echo "<p><a href='$url' target='_blank'>Test: $url</a></p>";
}

// Check current directory
echo "<h3>2. Current Directory Structure</h3>";
echo "<p>Current directory: " . __DIR__ . "</p>";

// Check if files exist
echo "<h3>3. Required Files Check</h3>";
$files = [
    'public/index.php' => file_exists(__DIR__ . '/public/index.php'),
    'controllers/AdminController.php' => file_exists(__DIR__ . '/controllers/AdminController.php'),
    'views/admin/add-doctor.php' => file_exists(__DIR__ . '/views/admin/add-doctor.php'),
    'core/Auth.php' => file_exists(__DIR__ . '/core/Auth.php'),
    'core/Controller.php' => file_exists(__DIR__ . '/core/Controller.php'),
    'core/Database.php' => file_exists(__DIR__ . '/core/Database.php'),
];

foreach ($files as $file => $exists) {
    $color = $exists ? 'green' : 'red';
    $icon = $exists ? '‚úÖ' : '‚ùå';
    echo "<p style='color: $color;'>$icon $file " . ($exists ? "exists" : "does NOT exist") . "</p>";
}

// Check .htaccess
echo "<h3>4. .htaccess Check</h3>";
$htaccess = file_exists(__DIR__ . '/public/.htaccess');
echo "<p>" . ($htaccess ? "‚úÖ" : "‚ùå") . " public/.htaccess " . ($htaccess ? "exists" : "does NOT exist") . "</p>";

if ($htaccess) {
    echo "<pre>" . htmlspecialchars(file_get_contents(__DIR__ . '/public/.htaccess')) . "</pre>";
}

// Check Apache configuration
echo "<h3>5. Server Information</h3>";
echo "<p>Server Software: " . ($_SERVER['SERVER_SOFTWARE'] ?? 'N/A') . "</p>";
echo "<p>Document Root: " . ($_SERVER['DOCUMENT_ROOT'] ?? 'N/A') . "</p>";
echo "<p>Request URI: " . ($_SERVER['REQUEST_URI'] ?? 'N/A') . "</p>";

// Test form submission
echo "<h3>6. Test Form Submission</h3>";
echo '<form action="public/index.php" method="POST" target="_blank">
    <input type="hidden" name="page" value="admin-add-doctor">
    <input type="hidden" name="test" value="1">
    <input type="hidden" name="name" value="Test Doctor">
    <input type="hidden" name="email" value="test@hospital.com">
    <button type="submit" class="btn btn-primary">Test POST to admin-add-doctor</button>
</form>';

// Check what routes are actually defined
echo "<h3>7. Check Defined Routes</h3>";
echo "<p>Let's look at public/index.php routes...</p>";

if (file_exists(__DIR__ . '/public/index.php')) {
    $indexContent = file_get_contents(__DIR__ . '/public/index.php');
    
    // Extract routes array
    if (preg_match('/\$routes\s*=\s*\[(.*?)\];/s', $indexContent, $matches)) {
        echo "<pre>" . htmlspecialchars($matches[0]) . "</pre>";
        
        // Check if admin-add-doctor is in routes
        if (strpos($matches[0], "'admin-add-doctor'") !== false) {
            echo "<p style='color: green;'>‚úÖ Route 'admin-add-doctor' found in routes array</p>";
        } else {
            echo "<p style='color: red;'>‚ùå Route 'admin-add-doctor' NOT found in routes array!</p>";
        }
    } else {
        echo "<p style='color: red;'>‚ùå Could not find routes array in index.php</p>";
    }
}

// Quick fix button
echo "<h3>8. Quick Fix</h3>";
echo '<button onclick="applyQuickFix()" class="btn btn-success">Apply Quick Fix to Routes</button>';

?>

<script>
function applyQuickFix() {
    if (confirm('This will add the missing admin routes to your index.php. Continue?')) {
        window.location.href = 'apply_route_fix.php';
    }
}
</script>

================================================================================
FILE: fix_includes.sh
================================================================================

#!/bin/bash

cd /Applications/XAMPP/xamppfiles/htdocs/OOP_PROJECT/hospital-management-system/views

echo "Fixing include paths in PHP files..."

# Create backup directory
mkdir -p ../backups/views

# Process each PHP file
for file in $(find . -name "*.php" -type f); do
    echo "Processing: $file"
    
    # Create backup
    cp "$file" "../backups/views/$(basename $file).backup"
    
    # Fix header includes
    sed -i '' "s|include 'views/layouts/header.php';|include __DIR__ . '/../layouts/header.php';|g" "$file"
    sed -i '' "s|include \"views/layouts/header.php\";|include __DIR__ . '/../layouts/header.php';|g" "$file"
    sed -i '' "s|include 'layouts/header.php';|include __DIR__ . '/../layouts/header.php';|g" "$file"
    sed -i '' "s|include \"layouts/header.php\";|include __DIR__ . '/../layouts/header.php';|g" "$file"
    
    # Fix footer includes
    sed -i '' "s|include 'views/layouts/footer.php';|include __DIR__ . '/../layouts/footer.php';|g" "$file"
    sed -i '' "s|include \"views/layouts/footer.php\";|include __DIR__ . '/../layouts/footer.php';|g" "$file"
    sed -i '' "s|include 'layouts/footer.php';|include __DIR__ . '/../layouts/footer.php';|g" "$file"
    sed -i '' "s|include \"layouts/footer.php\";|include __DIR__ . '/../layouts/footer.php';|g" "$file"
    
    # Also fix any variations
    sed -i '' "s|^include_once 'views/layouts|include_once __DIR__ . '/../layouts|g" "$file"
    sed -i '' "s|^require 'views/layouts|require __DIR__ . '/../layouts|g" "$file"
    sed -i '' "s|^require_once 'views/layouts|require_once __DIR__ . '/../layouts|g" "$file"
done

echo "Done! Backups saved to: ../backups/views/"

================================================================================
FILE: composer.json
================================================================================

{
    "name": "kasr-al-ainy/hospital-management",
    "description": "Hospital Management System for Kasr Al Ainy Hospital",
    "type": "project",
    "require": {
        "php": ">=7.4"
    },
    "autoload": {
        "psr-4": {
            "Core\\": "core/",
            "Models\\": "models/",
            "Controllers\\": "controllers/",
            "Config\\": "config/"
        }
    },
    "authors": [
        {
            "name": "Kasr Al Ainy Hospital",
            "email": "info@kasalainyhospital.com"
        }
    ],
    "minimum-stability": "stable"
}

================================================================================
FILE: core/Controller.php
================================================================================

<?php
// core/Controller.php - Ensure isPost() method exists
namespace Core;

class Controller {
    protected function view($view, $data = []) {
        extract($data);
        $viewPath = __DIR__ . "/../views/$view.php";
        
        if (file_exists($viewPath)) {
            require_once $viewPath;
        } else {
            die("View not found: $view");
        }
    }
    
    protected function redirect($url) {
        // If it's already a full URL, use it directly
        if (strpos($url, 'http://') === 0 || strpos($url, 'https://') === 0) {
            header("Location: " . $url);
        } 
        // If it starts with ?, it's a relative URL to current page
        else if (strpos($url, '?') === 0) {
            $baseUrl = $_SERVER['PHP_SELF'];
            header("Location: " . $baseUrl . $url);
        }
        // If it's just a page name
        else {
            $baseUrl = dirname($_SERVER['PHP_SELF']);
            header("Location: " . $baseUrl . "/index.php?page=" . $url);
        }
        exit();
    }
    
    // This method should be called from controllers, not from Auth class
    protected function isPost() {
        return $_SERVER['REQUEST_METHOD'] === 'POST';
    }
    
    // Add helper method to check GET requests
    protected function isGet() {
        return $_SERVER['REQUEST_METHOD'] === 'GET';
    }
}
?>

================================================================================
FILE: core/Auth.php
================================================================================

<?php
// core/Auth.php - FIXED VERSION
namespace Core;

use Models\UserFactory;
use \PDO;

class Auth {
    private static $instance = null;
    
    private function __construct() {
        if (session_status() === PHP_SESSION_NONE) {
            session_start();
        }
    }
    
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    public function login($email, $password) {
        $db = Database::getInstance()->getConnection();
        
        // Debug logging
        error_log("Auth::login() called with email: $email");
        
        $stmt = $db->prepare("SELECT * FROM users WHERE email = ? AND status = 'active'");
        $stmt->execute([$email]);
        $userData = $stmt->fetch(PDO::FETCH_ASSOC);
        
        // Debug: Check if user was found
        if ($userData) {
            error_log("User found in database: ID={$userData['id']}, Email={$userData['email']}, Role={$userData['role']}");
        } else {
            error_log("No active user found with email: $email");
        }
        
        if ($userData) {
            // Verify password
            $passwordMatch = password_verify($password, $userData['password']);
            error_log("Password verification result: " . ($passwordMatch ? "MATCH" : "NO MATCH"));
            
            if ($passwordMatch) {
                try {
                    $user = UserFactory::createFromDatabase($userData);
                    
                    $_SESSION['user_id'] = $user->getId();
                    $_SESSION['user_role'] = $user->getRole();
                    $_SESSION['user_name'] = $user->getName();
                    $_SESSION['user_email'] = $user->getEmail();
                    
                    // Debug: Log successful login
                    error_log("Login successful! User ID: " . $user->getId() . ", Role: " . $user->getRole());
                    
                    return $user;
                } catch (\Exception $e) {
                    error_log("Error creating user object: " . $e->getMessage());
                    return false;
                }
            } else {
                error_log("Password doesn't match for email: $email");
                error_log("Input password: $password");
                error_log("Stored hash: " . $userData['password']);
            }
        }
        
        return false;
    }
    
    public function logout() {
        $_SESSION = [];
        
        if (ini_get("session.use_cookies")) {
            $params = session_get_cookie_params();
            setcookie(session_name(), '', time() - 42000,
                $params["path"], $params["domain"],
                $params["secure"], $params["httponly"]
            );
        }
        
        session_destroy();
    }
    
    public function check() {
        return isset($_SESSION['user_id']) && !empty($_SESSION['user_id']);
    }
    
    public function user() {
        if (!$this->check()) {
            return null;
        }
        
        $db = Database::getInstance()->getConnection();
        $stmt = $db->prepare("SELECT * FROM users WHERE id = ?");
        $stmt->execute([$_SESSION['user_id']]);
        $userData = $stmt->fetch(PDO::FETCH_ASSOC);
        
        if ($userData) {
            return UserFactory::createFromDatabase($userData);
        }
        
        return null;
    }
    
    public function requireAuth() {
        if (!$this->check()) {
            $this->redirectToLogin();
        }
    }
    
    public function requireRole($role) {
        $this->requireAuth();
        
        if (!isset($_SESSION['user_role']) || $_SESSION['user_role'] !== $role) {
            $this->redirectToLogin();
        }
    }
    
    private function redirectToLogin() {
        header("Location: " . APP_URL . "/public/index.php?page=login");
        exit();
    }
}
?>

================================================================================
FILE: core/HospitalSystem.php
================================================================================

<?php
namespace Core;

class HospitalSystem {
    private static $instance = null;
    private $auth;
    
    private function __construct() {
        $this->auth = Auth::getInstance();
    }
    
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    public function authenticateUser($email, $password) {
        return $this->auth->login($email, $password);
    }
    
    public function authorizeUser($requiredRole) {
        $user = $this->auth->user();
        return $user && $user->getRole() === $requiredRole;
    }
    
    public function getCurrentUser() {
        return $this->auth->user();
    }
    
    public function logout() {
        $this->auth->logout();
    }
    
    // Prevent cloning
    private function __clone() {}
    
    // Prevent unserialization
    public function __wakeup() {
        throw new \Exception("Cannot unserialize singleton");
    }
}
?>

================================================================================
FILE: core/App.php
================================================================================

<?php
namespace Core;

class App {
    private $controller = 'Auth';
    private $method = 'index';
    private $params = [];
    
    public function __construct() {
        $url = $this->parseUrl();
        
        // Set controller
        if (isset($url[0]) && file_exists('../app/controllers/' . ucfirst($url[0]) . 'Controller.php')) {
            $this->controller = ucfirst($url[0]);
            unset($url[0]);
        }
        
        require_once '../app/controllers/' . $this->controller . 'Controller.php';
        $controllerClass = "Controllers\\{$this->controller}Controller";
        $this->controller = new $controllerClass;
        
        // Set method
        if (isset($url[1])) {
            if (method_exists($this->controller, $url[1])) {
                $this->method = $url[1];
                unset($url[1]);
            }
        }
        
        // Set params
        $this->params = $url ? array_values($url) : [];
        
        // Call method with params
        call_user_func_array([$this->controller, $this->method], $this->params);
    }
    
    private function parseUrl() {
        if (isset($_GET['url'])) {
            return explode('/', filter_var(rtrim($_GET['url'], '/'), FILTER_SANITIZE_URL));
        }
        return [];
    }
}
?>

================================================================================
FILE: core/Database.php
================================================================================

<?php
// core/Database.php - UPDATED VERSION
namespace Core;

use \PDO;
use \PDOException;

class Database {
    private static $instance = null;
    private $connection;
    
    private function __construct() {
        try {
            // Define default constants if they don't exist
            if (!defined('DB_HOST')) define('DB_HOST', 'localhost');
            if (!defined('DB_NAME')) define('DB_NAME', 'hospital_management');
            if (!defined('DB_USER')) define('DB_USER', 'root');
            if (!defined('DB_PASS')) define('DB_PASS', '');
            if (!defined('DB_CHARSET')) define('DB_CHARSET', 'utf8mb4');
            
            $this->connection = new PDO(
                "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=" . DB_CHARSET,
                DB_USER,
                DB_PASS,
                [
                    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                    PDO::ATTR_EMULATE_PREPARES => false
                ]
            );
        } catch (PDOException $e) {
            die("Database connection failed: " . $e->getMessage());
        }
    }
    
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    public function getConnection() {
        return $this->connection;
    }
    
    public function query($sql, $params = []) {
        try {
            $stmt = $this->connection->prepare($sql);
            $stmt->execute($params);
            return $stmt->fetchAll();
        } catch (PDOException $e) {
            error_log("Database error: " . $e->getMessage());
            return false;
        }
    }
    
    public function execute($sql, $params = []) {
        try {
            $stmt = $this->connection->prepare($sql);
            return $stmt->execute($params);
        } catch (PDOException $e) {
            error_log("Database error: " . $e->getMessage());
            return false;
        }
    }
    
    public function insert($sql, $params = []) {
        try {
            $stmt = $this->connection->prepare($sql);
            $stmt->execute($params);
            return $this->connection->lastInsertId();
        } catch (PDOException $e) {
            error_log("Database error: " . $e->getMessage());
            return false;
        }
    }
}
?>

================================================================================
FILE: core/Model.php
================================================================================

<?php
namespace Core;

class Model {
    protected $db;
    
    public function __construct() {
        $this->db = Database::getInstance();
    }
}
?>

================================================================================
FILE: core/Observer.php
================================================================================

<?php
namespace Core;

interface Observer {
    public function update($subject, $event);
}
?>

================================================================================
FILE: core/Subject.php
================================================================================

<?php
namespace Core;

interface Subject {
    public function attach(Observer $observer);
    public function detach(Observer $observer);
    public function notify($event = '');
}
?>

================================================================================
FILE: config/database.php
================================================================================

<?php
namespace Config;

class DatabaseConfig {
    const HOST = 'localhost';
    const USERNAME = 'root';
    const PASSWORD = ''; 
    const DATABASE = 'hospital_management';
    const CHARSET = 'utf8mb4';
    const PORT = 3306;
}
?>

================================================================================
FILE: config/config.php
================================================================================

<?php
// Application configuration
define('APP_NAME', 'Kasr Al Ainy Hospital');
define('APP_URL', '/OOP_PROJECT/hospital-management-system');
define('APP_PATH', dirname(dirname(__FILE__)));
define('TIMEZONE', 'Africa/Cairo');

// Database configuration (simplified)
define('DB_HOST', 'localhost');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_NAME', 'hospital_management');
define('DB_CHARSET', 'utf8mb4');

// Error reporting
error_reporting(E_ALL);
ini_set('display_errors', 1);

// Set timezone
date_default_timezone_set(TIMEZONE);

// Start session if not already started
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Include database class
require_once __DIR__ . '/../core/Database.php';
?>

================================================================================
FILE: config/hospital_management.sql
================================================================================

-- Create database
CREATE DATABASE IF NOT EXISTS hospital_management;
USE hospital_management;

-- Users table
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('admin', 'receptionist', 'doctor', 'patient') NOT NULL,
    phone VARCHAR(20),
    specialization VARCHAR(100),
    department_id INT,
    status ENUM('active', 'inactive', 'on_leave') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Departments table
CREATE TABLE IF NOT EXISTS departments (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Appointments table
CREATE TABLE IF NOT EXISTS appointments (
    id INT AUTO_INCREMENT PRIMARY KEY,
    patient_id INT NOT NULL,
    doctor_id INT NOT NULL,
    date DATE NOT NULL,
    time TIME NOT NULL,
    reason TEXT,
    status ENUM('pending', 'confirmed', 'completed', 'cancelled') DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (patient_id) REFERENCES users(id),
    FOREIGN KEY (doctor_id) REFERENCES users(id)
);

-- Notifications table
CREATE TABLE IF NOT EXISTS notifications (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    type VARCHAR(50),
    message TEXT,
    is_read BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- Insert default admin (password: admin123)
INSERT INTO users (name, email, password, role) 
VALUES ('Admin User', 'admin@hospital.com', '$2y$10$8pzW5HkR8sF9wYq7Xv6ZWeLbJg8KdN2Q3RtS4Uv5WxYzA1BcDeFgH', 'admin');

-- Insert sample doctor (password: doctor123)
INSERT INTO users (name, email, password, role, specialization) 
VALUES ('Dr. Ahmed Ali', 'doctor@hospital.com', '$2y$10$8pzW5HkR8sF9wYq7Xv6ZWeLbJg8KdN2Q3RtS4Uv5WxYzA1BcDeFgH', 'doctor', 'Cardiology');

-- Insert sample receptionist (password: reception123)
INSERT INTO users (name, email, password, role) 
VALUES ('Receptionist User', 'reception@hospital.com', '$2y$10$8pzW5HkR8sF9wYq7Xv6ZWeLbJg8KdN2Q3RtS4Uv5WxYzA1BcDeFgH', 'receptionist');

-- Insert sample patient (password: patient123)
INSERT INTO users (name, email, password, role, phone) 
VALUES ('Patient User', 'patient@hospital.com', '$2y$10$8pzW5HkR8sF9wYq7Xv6ZWeLbJg8KdN2Q3RtS4Uv5WxYzA1BcDeFgH', 'patient', '+201234567890');

-- Insert departments
INSERT INTO departments (name, description) VALUES
('Cardiology', 'Heart and cardiovascular system'),
('Neurology', 'Brain and nervous system'),
('Orthopedics', 'Bones and musculoskeletal system');

-- Insert sample appointment
INSERT INTO appointments (patient_id, doctor_id, date, time, reason, status) 
VALUES (4, 2, '2024-01-15', '10:00:00', 'Regular checkup', 'confirmed');

================================================================================
FILE: tests/UnitTests.php
================================================================================


================================================================================
FILE: models/Appointment.php
================================================================================

<?php
namespace Models;

use Core\Database;
use Core\Subject;

class Appointment implements Subject {
    private $id;
    private $patientId;
    private $doctorId;
    private $date;
    private $time;
    private $reason;
    private $status;
    private $observers = [];
    
    public function __construct($data = []) {
        $this->id = $data['id'] ?? null;
        $this->patientId = $data['patient_id'] ?? null;
        $this->doctorId = $data['doctor_id'] ?? null;
        $this->date = $data['date'] ?? null;
        $this->time = $data['time'] ?? null;
        $this->reason = $data['reason'] ?? '';
        $this->status = $data['status'] ?? 'pending';
    }
    
    // Observer pattern methods
    public function attach($observer) {
        $this->observers[] = $observer;
    }
    
    public function detach($observer) {
        $key = array_search($observer, $this->observers, true);
        if ($key !== false) {
            unset($this->observers[$key]);
        }
    }
    
    public function notify($event = '') {
        foreach ($this->observers as $observer) {
            $observer->update($this, $event);
        }
    }
    
    // Getters
    public function getId() { return $this->id; }
    public function getPatientId() { return $this->patientId; }
    public function getDoctorId() { return $this->doctorId; }
    public function getDate() { return $this->date; }
    public function getTime() { return $this->time; }
    public function getReason() { return $this->reason; }
    public function getStatus() { return $this->status; }
    
    // Business methods
    public function updateStatus($newStatus) {
        $oldStatus = $this->status;
        $this->status = $newStatus;
        
        // Save to database
        $db = Database::getInstance();
        $conn = $db->getConnection();
        
        $query = "UPDATE appointments SET status = ? WHERE id = ?";
        $stmt = $conn->prepare($query);
        $result = $stmt->execute([$newStatus, $this->id]);
        
        if ($result) {
            // Notify observers about status change
            $this->notify("Appointment status changed from $oldStatus to $newStatus");
            return true;
        }
        
        return false;
    }
    
// Update the save() method in Appointment.php
    public function save() {
        $db = Database::getInstance();
        $conn = $db->getConnection();
        
        if ($this->id) {
            // Update existing appointment
            $query = "UPDATE appointments SET 
                    patient_id = ?, doctor_id = ?, date = ?, time = ?, 
                    reason = ?, status = ? WHERE id = ?";
            
            $stmt = $conn->prepare($query);
            $result = $stmt->execute([
                $this->patientId, $this->doctorId, $this->date, $this->time,
                $this->reason, $this->status, $this->id
            ]);
            
            return $result;
        } else {
            // Insert new appointment
            $query = "INSERT INTO appointments 
                    (patient_id, doctor_id, date, time, reason, status) 
                    VALUES (?, ?, ?, ?, ?, ?)";
            
            $stmt = $conn->prepare($query);
            $result = $stmt->execute([
                $this->patientId, $this->doctorId, $this->date, $this->time,
                $this->reason, $this->status
            ]);
            
            if ($result) {
                $this->id = $conn->lastInsertId();
                $this->notify("New appointment created");
                return $this->id; // Return the new ID
            }
            
            return false;
        }
    }
    
    public static function find($id) {
        $db = Database::getInstance();
        $result = $db->query("SELECT * FROM appointments WHERE id = ?", [$id]);
        
        if ($result && count($result) > 0) {
            return new self($result[0]);
        }
        return null;
    }
    
    public static function getAll() {
        $db = Database::getInstance();
        $results = $db->query("
            SELECT a.*, 
                   p.name as patient_name,
                   d.name as doctor_name
            FROM appointments a
            JOIN users p ON a.patient_id = p.id
            JOIN users d ON a.doctor_id = d.id
            ORDER BY a.date DESC, a.time DESC
        ");
        
        $appointments = [];
        foreach ($results as $row) {
            $appointments[] = $row;
        }
        return $appointments;
    }
    
    public static function getByDoctor($doctorId) {
        $db = Database::getInstance();
        $results = $db->query("
            SELECT a.*, p.name as patient_name
            FROM appointments a
            JOIN users p ON a.patient_id = p.id
            WHERE a.doctor_id = ?
            ORDER BY a.date, a.time
        ", [$doctorId]);
        
        return $results;
    }
    
    public static function getByPatient($patientId) {
        $db = Database::getInstance();
        $results = $db->query("
            SELECT a.*, d.name as doctor_name
            FROM appointments a
            JOIN users d ON a.doctor_id = d.id
            WHERE a.patient_id = ?
            ORDER BY a.date DESC, a.time DESC
        ", [$patientId]);
        
        return $results;
    }
}
?>

================================================================================
FILE: models/Doctor.php
================================================================================

<?php
namespace Models;

class Doctor extends User {
    private $specialization;
    private $departmentId;
    private $permissions = [
        'view_appointments' => true,
        'update_appointment_status' => true,
        'add_medical_notes' => true,
        'view_patient_history' => true
    ];
    
    public static function getBySpecialization($specialization) {
        $db = \Core\Database::getInstance();
        $results = $db->query("
            SELECT * FROM users 
            WHERE role = 'doctor' 
            AND specialization = ?
            AND status = 'active'
            ORDER BY name
        ", [$specialization]);
        
        return $results;
    }
    public function __construct($data = []) {
        parent::__construct($data);
        $this->role = 'doctor';
        $this->specialization = $data['specialization'] ?? '';
        $this->departmentId = $data['department_id'] ?? null;
    }
    
    public function getDashboardUrl() {
        return '/doctor/dashboard';
    }
    
    public function canPerform($action) {
        return $this->permissions[$action] ?? false;
    }
    
    public function getSpecialization() {
        return $this->specialization;
    }
    
    public function getDepartmentId() {
        return $this->departmentId;
    }
}
?>

================================================================================
FILE: models/User.php
================================================================================

<?php
namespace Models;

use Core\Database;

abstract class User {
    protected $id;
    protected $name;
    protected $email;
    protected $password;
    protected $phone;
    protected $role;
    protected $status;
    
    public function __construct($data = []) {
        $this->id = $data['id'] ?? null;
        $this->name = $data['name'] ?? '';
        $this->email = $data['email'] ?? '';
        $this->password = $data['password'] ?? '';
        $this->phone = $data['phone'] ?? '';
        $this->role = $data['role'] ?? '';
        $this->status = $data['status'] ?? 'active';
    }
    
    // Abstract methods
    abstract public function getDashboardUrl();
    abstract public function canPerform($action);
    
    // Getters
    public function getId() { return $this->id; }
    public function getName() { return $this->name; }
    public function getEmail() { return $this->email; }
    public function getRole() { return $this->role; }
    public function getStatus() { return $this->status; }
    public function getPhone() { return $this->phone; }
    
    // Setters
    public function setName($name) { $this->name = $name; }
    public function setEmail($email) { $this->email = $email; }
    public function setPhone($phone) { $this->phone = $phone; }
    
    public function validatePassword($password) {
        return password_verify($password, $this->password);
    }
    
    public function save() {
        $db = Database::getInstance();
        
        if ($this->id) {
            // Update
            $query = "UPDATE users SET name = ?, email = ?, phone = ?, status = ? WHERE id = ?";
            $result = $db->execute($query, [
                $this->name, $this->email, $this->phone, $this->status, $this->id
            ]);
            return $result !== false;
        } else {
            // Insert
            $query = "INSERT INTO users (name, email, password, phone, role, status) VALUES (?, ?, ?, ?, ?, ?)";
            $newId = $db->insert($query, [
                $this->name, 
                $this->email, 
                $this->password, 
                $this->phone, 
                $this->role, 
                $this->status
            ]);
            
            if ($newId) {
                $this->id = $newId;
                return true;
            }
            return false;
        }
    }
    
    public function toArray() {
        return [
            'id' => $this->id,
            'name' => $this->name,
            'email' => $this->email,
            'phone' => $this->phone,
            'role' => $this->role,
            'status' => $this->status
        ];
    }
}
?>

================================================================================
FILE: models/UserFactory.php
================================================================================

<?php
namespace Models;

class UserFactory {
    public static function createUser($role, $data = []) {
        // Ensure all required fields have default values
        $defaultData = array_merge([
            'id' => null,
            'name' => '',
            'email' => '',
            'password' => '',
            'phone' => '',
            'status' => 'active'
        ], $data);
        
        switch ($role) {
            case 'admin':
                return new Admin($defaultData);
            case 'receptionist':
                return new Receptionist($defaultData);
            case 'doctor':
                return new Doctor($defaultData);
            case 'patient':
                return new Patient($defaultData);
            default:
                throw new \Exception("Invalid user role: $role");
        }
    }
    
    public static function createFromDatabase($row) {
        if (!isset($row['role']) || empty($row['role'])) {
            throw new \Exception("User role not specified in database row");
        }
        
        $role = $row['role'];
        return self::createUser($role, $row);
    }
    
    public static function getAllRoles() {
        return ['admin', 'receptionist', 'doctor', 'patient'];
    }
}
?>

================================================================================
FILE: models/Patient.php
================================================================================

<?php
namespace Models;

use Core\Observer;

class Patient extends User implements Observer {
    public function __construct($data = []) {
        parent::__construct($data);
        $this->role = 'patient';
    }
    
    public function getDashboardUrl() {
        return '/patient/dashboard';
    }
    
    public function canPerform($action) {
        $patientPermissions = [
            'view_appointments' => true,
            'book_appointment' => true,
            'update_profile' => true
        ];
        return $patientPermissions[$action] ?? false;
    }
    
    // Observer pattern implementation
    public function update($subject, $event) {
        // In a real app, you would send email/SMS notification
        error_log("Patient {$this->id} notified: $event");
        
        // Store notification in database
        $db = \Core\Database::getInstance();
        $db->execute(
            "INSERT INTO notifications (user_id, type, message) VALUES (?, ?, ?)",
            [$this->id, 'appointment_update', $event]
        );
    }
}
?>

================================================================================
FILE: models/Admin.php
================================================================================

<?php
namespace Models;

class Admin extends User {
    private $permissions = [
        'manage_users' => true,
        'manage_doctors' => true,
        'view_reports' => true,
        'system_config' => true
    ];
    
    public function __construct($data = []) {
        parent::__construct($data);
        $this->role = 'admin';
    }
    
    public function getDashboardUrl() {
        return '/admin/dashboard';
    }
    
    public function canPerform($action) {
        return $this->permissions[$action] ?? false;
    }
    
    // Admin-specific methods
    public function addUser($userData) {
        // Implementation to add user to database
        $user = UserFactory::createUser($userData['role'], $userData);
        return $user->save();
    }
    
    public function updateUser($userId, $userData) {
        // Update user in database
    }
    
    public function deleteUser($userId) {
        // Delete user from database
    }
    
    public function addDoctor($doctorData) {
        $doctorData['role'] = 'doctor';
        return $this->addUser($doctorData);
    }
}
?>

================================================================================
FILE: models/Notification.php
================================================================================

<?php
namespace Models;

use Core\Database;

class Notification {
    private $id;
    private $userId;
    private $type;
    private $message;
    private $isRead;
    private $createdAt;
    
    public function __construct($data = []) {
        $this->id = $data['id'] ?? null;
        $this->userId = $data['user_id'] ?? null;
        $this->type = $data['type'] ?? '';
        $this->message = $data['message'] ?? '';
        $this->isRead = $data['is_read'] ?? false;
        $this->createdAt = $data['created_at'] ?? null;
    }
    
    public function save() {
        $db = Database::getInstance();
        
        if ($this->id) {
            $query = "UPDATE notifications SET is_read = ? WHERE id = ?";
            return $db->execute($query, [$this->isRead, $this->id]);
        } else {
            $query = "INSERT INTO notifications (user_id, type, message) VALUES (?, ?, ?)";
            return $db->execute($query, [$this->userId, $this->type, $this->message]);
        }
    }
    
    public static function getByUser($userId, $unreadOnly = false) {
        $db = Database::getInstance();
        $sql = "SELECT * FROM notifications WHERE user_id = ?";
        
        if ($unreadOnly) {
            $sql .= " AND is_read = 0";
        }
        
        $sql .= " ORDER BY created_at DESC";
        
        return $db->query($sql, [$userId]);
    }
    
    public static function markAsRead($notificationId) {
        $db = Database::getInstance();
        return $db->execute("UPDATE notifications SET is_read = 1 WHERE id = ?", [$notificationId]);
    }
}
?>

================================================================================
FILE: models/Receptionist.php
================================================================================

<?php
namespace Models;

class Receptionist extends User {
    private $permissions = [
        'add_patient' => true,
        'book_appointment' => true,
        'update_appointment' => true,
        'cancel_appointment' => true,
        'view_appointments' => true
    ];
    
    public function __construct($data = []) {
        parent::__construct($data);
        $this->role = 'receptionist';
    }
    
    public function getDashboardUrl() {
        return '/receptionist/dashboard';
    }
    
    public function canPerform($action) {
        return $this->permissions[$action] ?? false;
    }
    
    // Receptionist-specific methods
    public function addPatient($patientData) {
        $patientData['role'] = 'patient';
        $patient = new Patient($patientData);
        return $patient->save();
    }
    
    public function bookAppointment($appointmentData) {
        $appointment = new Appointment($appointmentData);
        return $appointment->save();
    }
}
?>

================================================================================
FILE: public/index.php
================================================================================

<?php
// Start session
session_start();

// Load configuration
require_once __DIR__ . '/../config/config.php';

// Simple autoloader
spl_autoload_register(function($className) {
    $baseDir = __DIR__ . '/../';
    $className = str_replace('\\', '/', $className);
    
    $paths = [
        $baseDir . $className . '.php',
        $baseDir . 'core/' . $className . '.php',
        $baseDir . 'models/' . $className . '.php',
        $baseDir . 'controllers/' . $className . '.php'
    ];
    
    foreach ($paths as $path) {
        if (file_exists($path)) {
            require_once $path;
            return;
        }
    }
});

// Get requested page
$page = $_GET['page'] ?? 'home';

// Simple router
$routes = [
    'home' => ['HomeController', 'index'],
    'cancel-appointment' => ['AppointmentController', 'cancel'],
    'update-appointment-status' => ['AppointmentController', 'updateStatus'],
    
    // Auth Routes
    'login' => ['AuthController', 'login'],
    'register' => ['AuthController', 'register'],
    'logout' => ['AuthController', 'logout'],
    
    // Admin routes
    'admin-dashboard' => ['AdminController', 'dashboard'],
    'admin-doctors' => ['AdminController', 'doctors'],
    'admin-add-doctor' => ['AdminController', 'addDoctor'],
    'admin-edit-doctor' => ['AdminController', 'editDoctor'],
    'admin-delete-doctor' => ['AdminController', 'deleteDoctor'],
    'admin-users' => ['AdminController', 'users'],
    'admin-add-user' => ['AdminController', 'addUser'],
    'admin-edit-user' => ['AdminController', 'editUser'],
    'admin-delete-user' => ['AdminController', 'deleteUser'],
    'admin-departments' => ['AdminController', 'departments'],
    'admin-add-department' => ['AdminController', 'addDepartment'],
    'admin-edit-department' => ['AdminController', 'editDepartment'],
    'admin-delete-department' => ['AdminController', 'deleteDepartment'],
    'admin-appointments' => ['AdminController', 'appointments'],
    'admin-add-appointment' => ['AdminController', 'addAppointment'],
    'admin-edit-appointment' => ['AdminController', 'editAppointment'],
    'admin-delete-appointment' => ['AdminController', 'deleteAppointment'],
    
    // Doctor routes
    'doctor-dashboard' => ['DoctorController', 'dashboard'],
    'doctor-appointments' => ['DoctorController', 'appointments'],
    'doctor-schedule' => ['DoctorController', 'schedule'],
    'doctor-patients' => ['DoctorController', 'patients'],
    'doctor-profile' => ['DoctorController', 'profile'],
    'update-appointment-status' => ['DoctorController', 'updateAppointmentStatus'],

    // Receptionist routes
    'receptionist-dashboard' => ['ReceptionistController', 'dashboard'],
    'receptionist-patients' => ['ReceptionistController', 'patients'],
    'receptionist-appointments' => ['ReceptionistController', 'appointments'],
    'receptionist-doctors' => ['ReceptionistController', 'doctors'],
    'receptionist-edit-appointment' => ['ReceptionistController', 'editAppointment'],
    'receptionist-cancel-appointment' => ['ReceptionistController', 'cancelAppointment'],
    'receptionist-book-for-patient' => ['ReceptionistController', 'bookForPatient'],
    
    // Patient routes
    'patient-dashboard' => ['PatientController', 'dashboard'],
    'patient-appointments' => ['PatientController', 'appointments'],
    'patient-book' => ['PatientController', 'book'],
    'patient-profile' => ['PatientController', 'profile']
];

// Route the request
if (isset($routes[$page])) {
    if (is_callable($routes[$page])) {
        // Call the function directly
        $routes[$page]();
    } else {
        $controllerName = 'Controllers\\' . $routes[$page][0];
        $actionName = $routes[$page][1];
        
        if (class_exists($controllerName)) {
            $controller = new $controllerName();
            
            if (method_exists($controller, $actionName)) {
                $controller->$actionName();
            } else {
                showError("Action '$actionName' not found");
            }
        } else {
            showError("Controller '$controllerName' not found");
        }
    }
} else {
    showError("Page '$page' not found");
}

function showError($message) {
    $errorHtml = <<<HTML
    <!DOCTYPE html>
    <html>
    <head>
        <title>Error - Kasr Al Ainy Hospital</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #f5f7fa;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                margin: 0;
            }
            .error-container {
                background-color: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                text-align: center;
                max-width: 400px;
            }
            .error-title {
                color: #e74c3c;
                font-size: 24px;
                margin-bottom: 20px;
            }
            .error-message {
                color: #333;
                margin-bottom: 20px;
            }
            .btn {
                display: inline-block;
                padding: 10px 20px;
                background-color: #1a6aa2;
                color: white;
                text-decoration: none;
                border-radius: 5px;
            }
            .btn:hover {
                background-color: #0d4d7a;
            }
        </style>
    </head>
    <body>
        <div class="error-container">
            <div class="error-title">Error</div>
            <div class="error-message">$message</div>
            <a href="?page=home" class="btn">Go to Home</a>
        </div>
    </body>
    </html>
    HTML;
    
    echo $errorHtml;
    exit();
}
?>

================================================================================
FILE: public/test.php
================================================================================


<?php
echo "Apache is working!<br>";
echo "PHP Version: " . phpversion() . "<br>";
echo "Current path: " . __DIR__;
?>

================================================================================
FILE: public/css/admin.css
================================================================================

/* Admin specific styles */
.admin-actions {
    display: flex;
    gap: 5px;
}

.admin-actions .btn {
    padding: 5px 10px;
    font-size: 0.85rem;
}

.badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
}

.badge-success {
    background-color: var(--success-color);
    color: white;
}

.badge-warning {
    background-color: var(--warning-color);
    color: white;
}

.badge-danger {
    background-color: var(--danger-color);
    color: white;
}

.badge-info {
    background-color: var(--primary-color);
    color: white;
}

.filter-container {
    background-color: white;
    padding: 20px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 20px;
}

.quick-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
}

.quick-stat {
    background-color: white;
    padding: 15px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    text-align: center;
}

.quick-stat h3 {
    margin-bottom: 5px;
    font-size: 1.8rem;
}

.quick-stat p {
    color: var(--text-light);
    font-size: 0.9rem;
    margin-bottom: 0;
}

.action-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.empty-state {
    text-align: center;
    padding: 40px 20px;
    background-color: #f8f9fa;
    border-radius: var(--border-radius);
    margin: 20px 0;
}

.empty-state i {
    font-size: 3rem;
    color: var(--gray-medium);
    margin-bottom: 15px;
}

.empty-state h3 {
    color: var(--gray-dark);
    margin-bottom: 10px;
}

/* Table styles */
.table-container {
    overflow-x: auto;
}

.table-container table {
    min-width: 800px;
}

.table-container th {
    background-color: var(--primary-light);
    color: var(--primary-dark);
    font-weight: 600;
    padding: 12px 15px;
}

.table-container td {
    padding: 10px 15px;
    vertical-align: middle;
}

.table-container tr:hover {
    background-color: #f8f9fa;
}

/* Form styles */
.form-container {
    max-width: 800px;
    margin: 0 auto;
}

.required:after {
    content: " *";
    color: var(--danger-color);
}

.form-help {
    font-size: 0.85rem;
    color: var(--text-light);
    margin-top: 5px;
}

/* Responsive */
@media (max-width: 768px) {
    .form-row {
        flex-direction: column;
        gap: 0;
    }
    
    .table-container table {
        min-width: 100%;
    }
    
    .quick-stats {
        grid-template-columns: 1fr;
    }
}

================================================================================
FILE: public/css/style.css
================================================================================

:root {
    --primary-color: #1a6aa2;
    --primary-dark: #0d4d7a;
    --primary-light: #e8f4fc;
    --secondary-color: #2d9d78;
    --secondary-dark: #1e7d5e;
    --danger-color: #e74c3c;
    --warning-color: #f39c12;
    --success-color: #27ae60;
    --gray-light: #f5f7fa;
    --gray-medium: #e1e5eb;
    --gray-dark: #6c757d;
    --text-color: #333;
    --text-light: #777;
    --white: #ffffff;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
    --border-radius: 10px;
    --border-radius-sm: 6px;
    --transition: all 0.3s ease;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    /* font-family: 'Roboto', sans-serif; */
    font-family: 'Tajawal', sans-serif;
    color: var(--text-color);
    background-color: var(--gray-light);
    line-height: 1.6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    /* font-family: 'Poppins', sans-serif; */
    font-weight: 600;
    margin-bottom: 1rem;
}

a {
    text-decoration: none;
    color: inherit;
}

.container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    /* margin-top: 20px; */
    padding: 0px 20px;
}
main .container{
    margin-top: 30px;
    margin-bottom: 30px;
}
.btn {
    display: inline-block;
    padding: 12px 24px;
    border-radius: var(--border-radius-sm);
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: var(--transition);
    font-size: 1rem;
}

.btn-primary {
    background-color: var(--primary-color);
    color: var(--white);
}

.btn-primary:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.btn-secondary {
    background-color: var(--secondary-color);
    color: var(--white);
}

.btn-secondary:hover {
    background-color: var(--secondary-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.btn-outline {
    background-color: transparent;
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
}

.btn-outline:hover {
    background-color: var(--primary-light);
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.btn-danger {
    background-color: var(--danger-color);
    color: var(--white);
}

.btn-danger:hover {
    opacity: 0.9;
}

.btn-success {
    background-color: var(--success-color);
    color: var(--white);
}

.btn-warning {
    background-color: var(--warning-color);
    color: var(--white);
}

.btn-sm {
    padding: 8px 16px;
    font-size: 0.9rem;
}

/* Header Styles */
header {
    background-color: var(--white);
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 100;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo-icon {
    background-color: var(--primary-color);
    color: var(--white);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.logo-text h1 {
    font-size: 1.6rem;
    margin-bottom: 2px;
    color: var(--primary-dark);
}

.logo-text p {
    font-size: 0.85rem;
    color: var(--text-light);
}

nav ul {
    display: flex;
    list-style: none;
    gap: 25px;
}

nav a {
    font-weight: 500;
    position: relative;
    padding: 5px 0;
    transition: var(--transition);
}

nav a:hover {
    color: var(--primary-color);
}

nav a.active {
    color: var(--primary-color);
}

nav a.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: var(--primary-color);
}

.user-info {
    display: flex;
    align-items: center;
    gap: 10px;
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: var(--primary-color);
}
.logout{
    color: red !important;
}
/* Home Page Styles */
.home-hero {
    background: linear-gradient(rgba(13, 77, 122, 0.85), rgba(13, 77, 122, 0.9)), url('../assets/images/qasr_back_img.jpg');
    background-size: cover;
    background-position: center;
    color: var(--white);
    padding: 100px 0;
    text-align: center;
}

.hero-content {
    max-width: 800px;
    margin: 0 auto;
}

.hero-content h1 {
    font-size: 3.5rem;
    margin-bottom: 20px;
    font-weight: 700;
    color: var(--white);
}

.hero-content p {
    font-size: 1.2rem;
    margin-bottom: 30px;
    opacity: 0.9;
}

.hero-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-top: 40px;
}

.section {
    padding: 80px 0;
}

.section-title {
    text-align: center;
    margin-bottom: 50px;
}

.section-title h2 {
    font-size: 2.5rem;
    color: var(--primary-dark);
    margin-bottom: 15px;
}

.section-title p {
    color: var(--text-light);
    max-width: 600px;
    margin: 0 auto;
}

/* Features Section */
.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 30px;
}

.feature-card {
    background-color: var(--white);
    border-radius: var(--border-radius);
    padding: 40px 30px;
    text-align: center;
    transition: var(--transition);
    box-shadow: var(--shadow);
    border: 1px solid transparent;
}

.feature-card:hover {
    transform: translateY(-10px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-light);
}

.feature-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background-color: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 25px;
    font-size: 2rem;
    color: var(--primary-color);
}

.feature-card h3 {
    font-size: 1.5rem;
    margin-bottom: 15px;
}

/* Roles Section */
.roles-section {
    background-color: var(--primary-light);
}

.roles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
}

.role-card {
    background-color: var(--white);
    border-radius: var(--border-radius);
    padding: 40px 30px;
    text-align: center;
    transition: var(--transition);
    box-shadow: var(--shadow);
}

.role-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.role-icon {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 25px;
    font-size: 1.8rem;
    color: var(--white);
}

.role-icon.admin {
    background-color: var(--warning-color);
}

.role-icon.doctor {
    background-color: var(--primary-color);
}

.role-icon.patient {
    background-color: var(--secondary-color);
}

.role-card h3 {
    font-size: 1.5rem;
    margin-bottom: 15px;
}

.role-card ul {
    list-style: none;
    text-align: left;
    margin-top: 20px;
}

.role-card ul li {
    margin-bottom: 10px;
    padding-left: 25px;
    position: relative;
}

.role-card ul li:before {
    content: "‚úì";
    position: absolute;
    left: 0;
    color: var(--success-color);
    font-weight: bold;
}

/* CTA Section */
.cta-section {
    background-color: var(--primary-color);
    color: var(--white);
    text-align: center;
}

.cta-section h2 {
    color: var(--white);
    font-size: 2.5rem;
    margin-bottom: 20px;
}

.cta-section p {
    font-size: 1.2rem;
    opacity: 0.9;
    max-width: 700px;
    margin: 0 auto 40px;
}

/* Main Content */
main {
    flex: 1;
}

.page {
    display: none;
    animation: fadeIn 0.5s ease;
}

.page.active {
    display: block;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 15px;
}

/* Dashboard Cards */
.stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.stat-card {
    background-color: var(--white);
    border-radius: var(--border-radius);
    padding: 25px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
    transition: var(--transition);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.stat-icon {
    min-width: 60px;
    max-width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: var(--white);
}

.stat-icon.doctors {
    background-color: var(--primary-color);
}

.stat-icon.patients {
    background-color: var(--secondary-color);
}

.stat-icon.appointments {
    background-color: var(--warning-color);
}

.stat-icon.departments {
    background-color: var(--success-color);
}
.stat-info{
    text-align: center;
}

.stat-info h3 {
    font-size: 2rem;
    margin-bottom: 5px;
}

.stat-info p {
    color: var(--text-light);
    font-size: 0.95rem;
}

/* Tables */
.table-container {
    background-color: var(--white);
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

thead {
    background-color: var(--primary-light);
}

th {
    padding: 18px 15px;
    text-align: left;
    font-weight: 600;
    color: var(--primary-dark);
    border-bottom: 1px solid var(--gray-medium);
}

td {
    padding: 15px;
    border-bottom: 1px solid var(--gray-medium);
}

tbody tr:last-child td {
    border-bottom: none;
}

tbody tr:hover {
    background-color: var(--gray-light);
}

.status {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 30px;
    font-size: 0.85rem;
    font-weight: 500;
}

.status.pending {
    background-color: #fff3cd;
    color: #856404;
}

.status.confirmed {
    background-color: #d4edda;
    color: #155724;
}

.status.completed {
    background-color: #d1ecf1;
    color: #0c5460;
}

.status.cancelled {
    background-color: #f8d7da;
    color: #721c24;
}

/* Forms */
.form-container {
    max-width: 600px;
    background-color: var(--white);
    border-radius: var(--border-radius);
    padding: 30px;
    box-shadow: var(--shadow);
    margin: 0 auto;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
}

.form-control {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid var(--gray-medium);
    border-radius: var(--border-radius-sm);
    font-family: 'Roboto', sans-serif;
    font-size: 1rem;
    transition: var(--transition);
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(26, 106, 162, 0.1);
}

.form-row {
    display: flex;
    gap: 20px;
}

.form-row .form-group {
    flex: 1;
}

.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    margin-top: 30px;
}

/* Cards for doctors and departments */
.cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.card {
    background-color: var(--white);
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: var(--transition);
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.card-header {
    padding: 20px;
    background-color: var(--primary-light);
    border-bottom: 1px solid var(--gray-medium);
}

.card-body {
    padding: 20px;
}

.doctor-photo {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 15px;
    border: 3px solid var(--white);
    box-shadow: var(--shadow);
}

.doctor-info h3 {
    margin-bottom: 5px;
}

.doctor-specialty {
    color: var(--primary-color);
    font-weight: 500;
    margin-bottom: 10px;
}

.doctor-availability {
    color: var(--success-color);
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 5px;
}

/* Footer */
footer {
    background-color: var(--primary-dark);
    color: var(--white);
    padding: 40px 0 20px;
    margin-top: auto;
}

.footer-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 30px;
    margin-bottom: 30px;
}

.footer-section h3 {
    color: var(--white);
    margin-bottom: 20px;
    font-size: 1.3rem;
}

.footer-section p {
    margin-bottom: 15px;
    opacity: 0.9;
}

.footer-section ul {
    list-style: none;
}

.footer-section ul li {
    margin-bottom: 10px;
    opacity: 0.9;
}

.footer-section ul li i {
    margin-right: 10px;
    color: var(--primary-light);
}

.copyright {
    text-align: center;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    opacity: 0.8;
    font-size: 0.9rem;
}

/* Modal */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    display: none;
}

.modal-overlay.active {
    display: flex;
}

.modal {
    background-color: var(--white);
    border-radius: var(--border-radius);
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-lg);
    animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid var(--gray-medium);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-body {
    padding: 20px;
}

.close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--gray-dark);
}

/* Authentication Pages */
.auth-container {
    background: linear-gradient(rgba(13, 77, 122, 0.85), rgba(13, 77, 122, 0.9)), url('../assets/images/qasr_back_img.jpg');
    background-size: cover;
    background-position: center;
    /* margin: 40px 0px; */
    min-height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.auth-card {
    margin: 30px 0px;
    width: 100%;
    max-width: 500px;
    background-color: var(--white);
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
}

.auth-header {
    background-color: var(--primary-color);
    color: var(--white);
    padding: 30px;
    text-align: center;
}

.auth-header h2 {
    margin-bottom: 0;
}

.auth-body {
    padding: 30px;
}

.role-selector {
    display: flex;
    margin-bottom: 20px;
    border: 1px solid var(--gray-medium);
    border-radius: var(--border-radius-sm);
    overflow: hidden;
}

.role-option {
    flex: 1;
    padding: 12px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
    border-right: 1px solid var(--gray-medium);
}

.role-option:last-child {
    border-right: none;
}

.role-option:hover {
    background-color: var(--gray-light);
}

.role-option.active {
    background-color: var(--primary-color);
    color: var(--white);
}

.error-message {
    background-color: #f8d7da;
    color: #721c24;
    padding: 12px;
    border-radius: var(--border-radius-sm);
    margin-bottom: 20px;
    display: none;
}

.error-message.active {
    display: block;
}

.success-message {
    background-color: #d4edda;
    color: #155724;
    padding: 12px;
    border-radius: var(--border-radius-sm);
    margin-bottom: 20px;
    display: none;
}

.success-message.active {
    display: block;
}

.forgot-password {
    text-align: center;
    margin-top: 20px;
}

.form-check {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
}

.form-check input {
    width: auto;
}

.form-check label {
    margin-bottom: 0;
    font-size: 0.95rem;
}

.form-check a {
    color: var(--primary-color);
    text-decoration: underline;
}

.auth-switch {
    text-align: center;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--gray-medium);
}

/* Add to public/css/style.css */
.progress-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    position: relative;
}

.progress-steps:before {
    content: '';
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    height: 2px;
    background-color: var(--gray-medium);
    z-index: 1;
}

.progress-step {
    position: relative;
    z-index: 2;
    text-align: center;
    flex: 1;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--gray-medium);
    color: var(--white);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 10px;
    font-weight: bold;
}

.progress-step.active .step-number {
    background-color: var(--primary-color);
}

.progress-step.completed .step-number {
    background-color: var(--success-color);
}

.step-label {
    font-size: 0.9rem;
    color: var(--text-light);
}

.progress-step.active .step-label {
    color: var(--primary-color);
    font-weight: 500;
}

.progress-step.completed .step-label {
    color: var(--success-color);
}

/* Add to style.css */
.role-selector {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 10px;
}

.role-option {
    padding: 15px 10px;
    text-align: center;
    border: 2px solid var(--gray-medium);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    background-color: white;
}

.role-option:hover {
    border-color: var(--primary-color);
    background-color: var(--primary-light);
    transform: translateY(-2px);
}

.role-option.active {
    border-color: var(--primary-color);
    background-color: var(--primary-color);
    color: white;
    box-shadow: 0 4px 8px rgba(26, 106, 162, 0.2);
}

.role-option i {
    font-size: 1.5rem;
    margin-bottom: 8px;
    display: block;
}

.demo-credentials {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid var(--primary-color);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.demo-credentials h4 {
    margin-top: 0;
    color: var(--primary-dark);
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Responsive */
@media (max-width: 992px) {
    .header-content {
        flex-direction: column;
        gap: 20px;
    }

    nav ul {
        flex-wrap: wrap;
        justify-content: center;
    }

    .hero-content h1 {
        font-size: 2.8rem;
    }
}

@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        align-items: flex-start;
    }

    .form-row {
        flex-direction: column;
        gap: 0;
    }

    .stats-cards {
        grid-template-columns: 1fr;
    }

    .hero-content h1 {
        font-size: 2.2rem;
    }

    .hero-content p {
        font-size: 1rem;
    }

    .hero-buttons {
        flex-direction: column;
        align-items: center;
    }

    .section-title h2 {
        font-size: 2rem;
    }
    .logo-text{
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
}

@media (max-width: 576px) {
    .header-content .logo-text{
        display: none;
    }

    .header-content {
        flex-direction: row;
    }
    .logo-text h1{
        font-size: 1rem !important;
    }
    .container {
        padding: 0 15px;
    }

    .modal {
        width: 95%;
    }

    .home-hero {
        padding: 60px 0;
    }

    .section {
        padding: 50px 0;
    }

    nav ul {
        gap: 15px;
    }
}

================================================================================
FILE: public/js/main.js
================================================================================

// Main JavaScript file for the hospital management system
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    initTooltips();
    
    // Initialize date pickers
    initDatePickers();
    
    // Initialize form validation
    initFormValidation();
    
    // Initialize notification system
    initNotifications();
});

function initTooltips() {
    // Add tooltips to buttons with data-tooltip attribute
    const tooltipElements = document.querySelectorAll('[data-tooltip]');
    tooltipElements.forEach(element => {
        element.addEventListener('mouseenter', function(e) {
            const tooltipText = this.getAttribute('data-tooltip');
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = tooltipText;
            tooltip.style.position = 'absolute';
            tooltip.style.background = 'rgba(0,0,0,0.8)';
            tooltip.style.color = 'white';
            tooltip.style.padding = '5px 10px';
            tooltip.style.borderRadius = '4px';
            tooltip.style.fontSize = '0.85rem';
            tooltip.style.zIndex = '1000';
            
            document.body.appendChild(tooltip);
            
            const rect = this.getBoundingClientRect();
            tooltip.style.top = (rect.top - tooltip.offsetHeight - 5) + 'px';
            tooltip.style.left = (rect.left + (rect.width - tooltip.offsetWidth) / 2) + 'px';
            
            this._tooltip = tooltip;
        });
        
        element.addEventListener('mouseleave', function() {
            if (this._tooltip) {
                this._tooltip.remove();
                this._tooltip = null;
            }
        });
    });
}

function initDatePickers() {
    // Set min date for appointment booking
    const dateInputs = document.querySelectorAll('input[type="date"]');
    const today = new Date().toISOString().split('T')[0];
    
    dateInputs.forEach(input => {
        if (!input.value) {
            input.value = today;
        }
        input.min = today;
    });
}

function initFormValidation() {
    // Password confirmation validation
    const passwordForms = document.querySelectorAll('form[id$="form"]');
    passwordForms.forEach(form => {
        const passwordField = form.querySelector('input[name="password"]');
        const confirmField = form.querySelector('input[name="confirm_password"]');
        
        if (passwordField && confirmField) {
            form.addEventListener('submit', function(e) {
                if (passwordField.value !== confirmField.value) {
                    e.preventDefault();
                    alert('Passwords do not match!');
                    confirmField.focus();
                    return false;
                }
                
                if (passwordField.value.length < 6) {
                    e.preventDefault();
                    alert('Password must be at least 6 characters long!');
                    passwordField.focus();
                    return false;
                }
            });
        }
    });
}

function initNotifications() {
    // Check for new notifications every 30 seconds
    if (document.querySelector('.notifications-container')) {
        setInterval(checkNewNotifications, 30000);
    }
}

function checkNewNotifications() {
    // In a real app, this would make an AJAX request
    console.log('Checking for new notifications...');
}

// Modal functions
function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

// Close modal when clicking outside
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('modal-overlay')) {
        closeModal(e.target.id);
    }
});

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modals = document.querySelectorAll('.modal-overlay[style*="display: flex"]');
        modals.forEach(modal => {
            closeModal(modal.id);
        });
    }
});

// Form submission feedback
document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', function(e) {
        const submitBtn = this.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            submitBtn.disabled = true;
        }
    });
});

// Auto-hide alerts after 5 seconds
setTimeout(function() {
    const alerts = document.querySelectorAll('.alert, .error-message, .success-message');
    alerts.forEach(alert => {
        if (alert.classList.contains('active')) {
            setTimeout(() => {
                alert.style.opacity = '0';
                alert.style.transition = 'opacity 0.5s';
                setTimeout(() => alert.remove(), 500);
            }, 5000);
        }
    });
}, 1000);

// Tab functionality for role selection
function activateRoleTab(role) {
    document.querySelectorAll('.role-option').forEach(tab => {
        tab.classList.remove('active');
    });
    
    const activeTab = document.querySelector(`.role-option[data-role="${role}"]`);
    if (activeTab) {
        activeTab.classList.add('active');
    }
}

// Dynamic form field toggling based on role
function toggleFormFields(role) {
    const doctorFields = document.querySelectorAll('.doctor-field');
    const patientFields = document.querySelectorAll('.patient-field');
    const adminFields = document.querySelectorAll('.admin-field');
    
    // Hide all special fields
    [doctorFields, patientFields, adminFields].forEach(fields => {
        fields.forEach(field => {
            field.style.display = 'none';
        });
    });
    
    // Show fields based on role
    switch(role) {
        case 'doctor':
            doctorFields.forEach(field => field.style.display = 'block');
            break;
        case 'patient':
            patientFields.forEach(field => field.style.display = 'block');
            break;
        case 'admin':
            adminFields.forEach(field => field.style.display = 'block');
            break;
    }
}

// Export data functions
function exportTableToCSV(tableId, filename) {
    const table = document.getElementById(tableId);
    if (!table) return;
    
    let csv = [];
    const rows = table.querySelectorAll('tr');
    
    for (let row of rows) {
        const cells = row.querySelectorAll('th, td');
        const rowData = [];
        
        for (let cell of cells) {
            // Skip action columns
            if (cell.querySelector('button, a, select')) continue;
            rowData.push(cell.innerText.replace(/,/g, ';'));
        }
        
        if (rowData.length > 0) {
            csv.push(rowData.join(','));
        }
    }
    
    const csvContent = csv.join('\n');
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    
    a.href = url;
    a.download = filename || 'export.csv';
    a.click();
    
    window.URL.revokeObjectURL(url);
}

// Print functionality
function printPage(elementId) {
    const element = elementId ? document.getElementById(elementId) : document.body;
    const originalContents = document.body.innerHTML;
    
    if (elementId) {
        document.body.innerHTML = element.innerHTML;
    }
    
    window.print();
    
    if (elementId) {
        document.body.innerHTML = originalContents;
    }
}

// Search functionality for tables
function filterTable(tableId, searchId) {
    const searchInput = document.getElementById(searchId);
    const table = document.getElementById(tableId);
    
    if (!searchInput || !table) return;
    
    searchInput.addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        const rows = table.querySelectorAll('tbody tr');
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(filter) ? '' : 'none';
        });
    });
}

// Initialize date picker ranges
function initDateRangePickers() {
    const startDateInputs = document.querySelectorAll('input[data-date-start]');
    const endDateInputs = document.querySelectorAll('input[data-date-end]');
    
    startDateInputs.forEach(startInput => {
        const endInputId = startInput.getAttribute('data-date-end');
        const endInput = document.getElementById(endInputId);
        
        if (endInput) {
            startInput.addEventListener('change', function() {
                endInput.min = this.value;
                if (endInput.value && endInput.value < this.value) {
                    endInput.value = this.value;
                }
            });
        }
    });
}

// Toggle password visibility
function togglePasswordVisibility(inputId) {
    const input = document.getElementById(inputId);
    if (input) {
        input.type = input.type === 'password' ? 'text' : 'password';
    }
}

// Character counter for textareas
function initCharacterCounters() {
    const textareas = document.querySelectorAll('textarea[data-maxlength]');
    
    textareas.forEach(textarea => {
        const maxLength = parseInt(textarea.getAttribute('data-maxlength'));
        const counterId = textarea.id + '-counter';
        
        // Create counter element
        const counter = document.createElement('div');
        counter.id = counterId;
        counter.className = 'character-counter';
        counter.style.fontSize = '0.8rem';
        counter.style.color = 'var(--text-light)';
        counter.style.textAlign = 'right';
        counter.style.marginTop = '5px';
        
        textarea.parentNode.appendChild(counter);
        
        function updateCounter() {
            const length = textarea.value.length;
            counter.textContent = `${length}/${maxLength} characters`;
            
            if (length > maxLength) {
                counter.style.color = 'var(--danger-color)';
            } else if (length > maxLength * 0.8) {
                counter.style.color = 'var(--warning-color)';
            } else {
                counter.style.color = 'var(--text-light)';
            }
        }
        
        textarea.addEventListener('input', updateCounter);
        updateCounter(); // Initial call
    });
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initCharacterCounters();
    initDateRangePickers();
    
    // Initialize search for tables with search inputs
    const searchInputs = document.querySelectorAll('input[data-search-table]');
    searchInputs.forEach(input => {
        const tableId = input.getAttribute('data-search-table');
        filterTable(tableId, input.id);
    });
});

================================================================================
FILE: controllers/AdminController.php
================================================================================

<?php
// controllers/AdminController.php - COMPLETE CRUD VERSION
namespace Controllers;

use Core\Controller;
use Core\Auth;
use Models\UserFactory;

class AdminController extends Controller {
    
    public function __construct() {
        $auth = Auth::getInstance();
        $auth->requireRole('admin');
    }
    
    // ============================
    // DASHBOARD
    // ============================
    public function dashboard() {
        $db = \Core\Database::getInstance();
        
        // Get statistics
        $stats = [
            'doctors' => $db->query("SELECT COUNT(*) as count FROM users WHERE role = 'doctor' AND status = 'active'")[0]['count'] ?? 0,
            'patients' => $db->query("SELECT COUNT(*) as count FROM users WHERE role = 'patient' AND status = 'active'")[0]['count'] ?? 0,
            'appointments' => $db->query("SELECT COUNT(*) as count FROM appointments WHERE date = CURDATE()")[0]['count'] ?? 0,
            'departments' => $db->query("SELECT COUNT(*) as count FROM departments")[0]['count'] ?? 0,
            'receptionists' => $db->query("SELECT COUNT(*) as count FROM users WHERE role = 'receptionist' AND status = 'active'")[0]['count'] ?? 0,
            'pending_appointments' => $db->query("SELECT COUNT(*) as count FROM appointments WHERE status = 'pending'")[0]['count'] ?? 0
        ];
        
        // Get recent appointments
        $recentAppointments = $db->query("
            SELECT a.*, 
                   p.name as patient_name,
                   d.name as doctor_name
            FROM appointments a
            JOIN users p ON a.patient_id = p.id
            JOIN users d ON a.doctor_id = d.id
            ORDER BY a.created_at DESC
            LIMIT 10
        ") ?? [];
        
        $this->view('admin/dashboard', [
            'stats' => $stats,
            'appointments' => $recentAppointments,
            'currentPage' => 'dashboard'
        ]);
    }
    
    // ============================
    // DOCTORS CRUD
    // ============================
    public function doctors() {
        $db = \Core\Database::getInstance();
        
        $doctors = $db->query("
            SELECT u.*, d.name as department_name 
            FROM users u 
            LEFT JOIN departments d ON u.department_id = d.id 
            WHERE u.role = 'doctor'
            ORDER BY u.name
        ") ?? [];
        
        $departments = $db->query("SELECT * FROM departments ORDER BY name") ?? [];
        
        $this->view('admin/doctors', [
            'doctors' => $doctors,
            'departments' => $departments,
            'currentPage' => 'doctors'
        ]);
    }
    
    public function addDoctor() {
        $db = \Core\Database::getInstance();
        
        // Get departments for the form
        $departments = $db->query("SELECT * FROM departments ORDER BY name") ?? [];
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            // Collect form data
            $data = [
                'name' => trim($_POST['name'] ?? ''),
                'email' => trim($_POST['email'] ?? ''),
                'password' => password_hash($_POST['password'] ?? 'doctor123', PASSWORD_DEFAULT),
                'phone' => trim($_POST['phone'] ?? ''),
                'specialization' => trim($_POST['specialization'] ?? ''),
                'department_id' => $_POST['department_id'] ?? null,
                'role' => 'doctor',
                'status' => $_POST['status'] ?? 'active'
            ];
            
            // Validate required fields
            if (empty($data['name']) || empty($data['email']) || empty($data['specialization'])) {
                $_SESSION['error_message'] = 'Name, email, and specialization are required.';
                $this->view('admin/add-doctor', [
                    'departments' => $departments,
                    'formData' => $_POST,
                    'currentPage' => 'doctors'
                ]);
                return;
            }
            
            // Check if email already exists
            $existing = $db->query("SELECT id FROM users WHERE email = ?", [$data['email']]);
            if ($existing) {
                $_SESSION['error_message'] = 'Email already exists.';
                $this->view('admin/add-doctor', [
                    'departments' => $departments,
                    'formData' => $_POST,
                    'currentPage' => 'doctors'
                ]);
                return;
            }
            
            // Insert into database
            $result = $db->execute(
                "INSERT INTO users (name, email, password, phone, specialization, department_id, role, status) 
                VALUES (?, ?, ?, ?, ?, ?, 'doctor', ?)",
                [
                    $data['name'], 
                    $data['email'], 
                    $data['password'], 
                    $data['phone'], 
                    $data['specialization'], 
                    $data['department_id'], 
                    $data['status']
                ]
            );
            
            if ($result) {
                $_SESSION['success_message'] = 'Doctor added successfully!';
                header("Location: " . APP_URL . "/public/index.php?page=admin-doctors");
                exit();
            } else {
                $_SESSION['error_message'] = 'Failed to add doctor. Please try again.';
                $this->view('admin/add-doctor', [
                    'departments' => $departments,
                    'formData' => $_POST,
                    'currentPage' => 'doctors'
                ]);
            }
        } else {
            // Show the form
            $this->view('admin/add-doctor', [
                'departments' => $departments,
                'currentPage' => 'doctors'
            ]);
        }
    }
    
    public function editDoctor() {
        $db = \Core\Database::getInstance();
        $id = $_GET['id'] ?? 0;
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $id = $_POST['id'] ?? $id;
            
            $data = [
                'name' => trim($_POST['name'] ?? ''),
                'email' => trim($_POST['email'] ?? ''),
                'phone' => trim($_POST['phone'] ?? ''),
                'specialization' => trim($_POST['specialization'] ?? ''),
                'department_id' => $_POST['department_id'] ?? null,
                'status' => $_POST['status'] ?? 'active'
            ];
            
            // Check if email belongs to another user
            $existing = $db->query("SELECT id FROM users WHERE email = ? AND id != ?", [$data['email'], $id]);
            if ($existing) {
                $_SESSION['error_message'] = 'Email already belongs to another user.';
                $this->redirect('?page=admin-edit-doctor&id=' . $id);
                return;
            }
            
            // Update query
            $query = "UPDATE users SET 
                     name = ?, email = ?, phone = ?, 
                     specialization = ?, department_id = ?, status = ? 
                     WHERE id = ? AND role = 'doctor'";
            
            $result = $db->execute($query, [
                $data['name'], $data['email'], $data['phone'],
                $data['specialization'], $data['department_id'], $data['status'], $id
            ]);
            
            // Update password if provided
            if (!empty($_POST['password'])) {
                $hashedPassword = password_hash($_POST['password'], PASSWORD_DEFAULT);
                $db->execute("UPDATE users SET password = ? WHERE id = ?", [$hashedPassword, $id]);
            }
            
            if ($result) {
                $_SESSION['success_message'] = 'Doctor updated successfully!';
            } else {
                $_SESSION['error_message'] = 'Failed to update doctor.';
            }
            
            $this->redirect('?page=admin-doctors');
        } else {
            // Show edit form
            $doctor = $db->query("SELECT * FROM users WHERE id = ? AND role = 'doctor'", [$id])[0] ?? null;
            
            if (!$doctor) {
                $_SESSION['error_message'] = 'Doctor not found.';
                $this->redirect('?page=admin-doctors');
                return;
            }
            
            $departments = $db->query("SELECT * FROM departments ORDER BY name") ?? [];
            
            $this->view('admin/edit-doctor', [
                'doctor' => $doctor,
                'departments' => $departments,
                'currentPage' => 'doctors'
            ]);
        }
    }
    
    public function deleteDoctor() {
        $db = \Core\Database::getInstance();
        $id = $_GET['id'] ?? 0;
        
        // Check if doctor has appointments
        $appointments = $db->query("SELECT COUNT(*) as count FROM appointments WHERE doctor_id = ?", [$id])[0]['count'] ?? 0;
        
        if ($appointments > 0) {
            $_SESSION['error_message'] = 'Cannot delete doctor with existing appointments.';
        } else {
            $result = $db->execute("DELETE FROM users WHERE id = ? AND role = 'doctor'", [$id]);
            
            if ($result) {
                $_SESSION['success_message'] = 'Doctor deleted successfully!';
            } else {
                $_SESSION['error_message'] = 'Failed to delete doctor.';
            }
        }
        
        $this->redirect('?page=admin-doctors');
    }
    
    // ============================
    // USERS CRUD (All Users)
    // ============================
    public function users() {
        $db = \Core\Database::getInstance();
        
        // Get filter parameters
        $role = $_GET['role'] ?? '';
        $status = $_GET['status'] ?? '';
        $search = $_GET['search'] ?? '';
        
        $query = "SELECT * FROM users WHERE 1=1";
        $params = [];
        
        if (!empty($role)) {
            $query .= " AND role = ?";
            $params[] = $role;
        }
        
        if (!empty($status)) {
            $query .= " AND status = ?";
            $params[] = $status;
        }
        
        if (!empty($search)) {
            $query .= " AND (name LIKE ? OR email LIKE ? OR phone LIKE ?)";
            $searchTerm = "%$search%";
            $params[] = $searchTerm;
            $params[] = $searchTerm;
            $params[] = $searchTerm;
        }
        
        $query .= " ORDER BY role, name";
        
        $users = $db->query($query, $params) ?? [];
        
        $this->view('admin/users', [
            'users' => $users,
            'currentPage' => 'users',
            'filters' => [
                'role' => $role,
                'status' => $status,
                'search' => $search
            ]
        ]);
    }
    
    public function addUser() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $db = \Core\Database::getInstance();
            
            $data = [
                'name' => trim($_POST['name'] ?? ''),
                'email' => trim($_POST['email'] ?? ''),
                'password' => password_hash($_POST['password'] ?? 'password123', PASSWORD_DEFAULT),
                'phone' => trim($_POST['phone'] ?? ''),
                'role' => $_POST['role'] ?? 'patient',
                'status' => $_POST['status'] ?? 'active',
                'specialization' => trim($_POST['specialization'] ?? ''),
                'department_id' => $_POST['department_id'] ?? null
            ];
            
            // Validate required fields
            if (empty($data['name']) || empty($data['email'])) {
                $_SESSION['error_message'] = 'Name and email are required.';
                $this->redirect('?page=admin-add-user');
                return;
            }
            
            // Check if email exists
            $existing = $db->query("SELECT id FROM users WHERE email = ?", [$data['email']]);
            if ($existing) {
                $_SESSION['error_message'] = 'Email already exists.';
                $this->redirect('?page=admin-add-user');
                return;
            }
            
            // Prepare query based on role
            if ($data['role'] === 'doctor') {
                $query = "INSERT INTO users (name, email, password, phone, role, status, specialization, department_id) 
                         VALUES (?, ?, ?, ?, ?, ?, ?, ?)";
                $params = [
                    $data['name'], $data['email'], $data['password'], $data['phone'],
                    $data['role'], $data['status'], $data['specialization'], $data['department_id']
                ];
            } else {
                $query = "INSERT INTO users (name, email, password, phone, role, status) 
                         VALUES (?, ?, ?, ?, ?, ?)";
                $params = [
                    $data['name'], $data['email'], $data['password'], $data['phone'],
                    $data['role'], $data['status']
                ];
            }
            
            $result = $db->execute($query, $params);
            
            if ($result) {
                $_SESSION['success_message'] = ucfirst($data['role']) . ' added successfully!';
                $this->redirect('?page=admin-users');
            } else {
                $_SESSION['error_message'] = 'Failed to add user.';
                $this->redirect('?page=admin-add-user');
            }
        } else {
            // Show add form
            $db = \Core\Database::getInstance();
            $departments = $db->query("SELECT * FROM departments ORDER BY name") ?? [];
            
            $this->view('admin/add-user', [
                'departments' => $departments,
                'currentPage' => 'users'
            ]);
        }
    }
    
    public function editUser() {
        $db = \Core\Database::getInstance();
        $id = $_GET['id'] ?? 0;
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $id = $_POST['id'] ?? $id;
            
            $data = [
                'name' => trim($_POST['name'] ?? ''),
                'email' => trim($_POST['email'] ?? ''),
                'phone' => trim($_POST['phone'] ?? ''),
                'status' => $_POST['status'] ?? 'active',
                'specialization' => trim($_POST['specialization'] ?? ''),
                'department_id' => $_POST['department_id'] ?? null
            ];
            
            // Check email
            $existing = $db->query("SELECT id FROM users WHERE email = ? AND id != ?", [$data['email'], $id]);
            if ($existing) {
                $_SESSION['error_message'] = 'Email already belongs to another user.';
                $this->redirect('?page=admin-edit-user&id=' . $id);
                return;
            }
            
            // Get user role to determine fields
            $user = $db->query("SELECT role FROM users WHERE id = ?", [$id])[0] ?? [];
            
            if ($user['role'] === 'doctor') {
                $query = "UPDATE users SET 
                         name = ?, email = ?, phone = ?, 
                         status = ?, specialization = ?, department_id = ? 
                         WHERE id = ?";
                $params = [
                    $data['name'], $data['email'], $data['phone'],
                    $data['status'], $data['specialization'], $data['department_id'], $id
                ];
            } else {
                $query = "UPDATE users SET 
                         name = ?, email = ?, phone = ?, status = ? 
                         WHERE id = ?";
                $params = [
                    $data['name'], $data['email'], $data['phone'], $data['status'], $id
                ];
            }
            
            $result = $db->execute($query, $params);
            
            // Update password if provided
            if (!empty($_POST['password'])) {
                $hashedPassword = password_hash($_POST['password'], PASSWORD_DEFAULT);
                $db->execute("UPDATE users SET password = ? WHERE id = ?", [$hashedPassword, $id]);
            }
            
            if ($result) {
                $_SESSION['success_message'] = 'User updated successfully!';
            } else {
                $_SESSION['error_message'] = 'Failed to update user.';
            }
            
            $this->redirect('?page=admin-users');
        } else {
            // Show edit form
            $user = $db->query("SELECT * FROM users WHERE id = ?", [$id])[0] ?? null;
            
            if (!$user) {
                $_SESSION['error_message'] = 'User not found.';
                $this->redirect('?page=admin-users');
                return;
            }
            
            $departments = $db->query("SELECT * FROM departments ORDER BY name") ?? [];
            
            $this->view('admin/edit-user', [
                'user' => $user,
                'departments' => $departments,
                'currentPage' => 'users'
            ]);
        }
    }
    
    public function deleteUser() {
        $db = \Core\Database::getInstance();
        $id = $_GET['id'] ?? 0;
        
        // Prevent deleting yourself
        if ($id == $_SESSION['user_id']) {
            $_SESSION['error_message'] = 'You cannot delete your own account.';
            $this->redirect('?page=admin-users');
            return;
        }
        
        // Get user role for validation
        $user = $db->query("SELECT role FROM users WHERE id = ?", [$id])[0] ?? [];
        
        if (!$user) {
            $_SESSION['error_message'] = 'User not found.';
            $this->redirect('?page=admin-users');
            return;
        }
        
        // Check appointments based on role
        if ($user['role'] === 'doctor') {
            $appointments = $db->query("SELECT COUNT(*) as count FROM appointments WHERE doctor_id = ?", [$id])[0]['count'] ?? 0;
            if ($appointments > 0) {
                $_SESSION['error_message'] = 'Cannot delete doctor with existing appointments.';
                $this->redirect('?page=admin-users');
                return;
            }
        } elseif ($user['role'] === 'patient') {
            $appointments = $db->query("SELECT COUNT(*) as count FROM appointments WHERE patient_id = ?", [$id])[0]['count'] ?? 0;
            if ($appointments > 0) {
                $_SESSION['error_message'] = 'Cannot delete patient with existing appointments.';
                $this->redirect('?page=admin-users');
                return;
            }
        }
        
        $result = $db->execute("DELETE FROM users WHERE id = ?", [$id]);
        
        if ($result) {
            $_SESSION['success_message'] = 'User deleted successfully!';
        } else {
            $_SESSION['error_message'] = 'Failed to delete user.';
        }
        
        $this->redirect('?page=admin-users');
    }
    
    // ============================
    // DEPARTMENTS CRUD
    // ============================
    public function departments() {
        $db = \Core\Database::getInstance();
        
        $departments = $db->query("
            SELECT d.*, 
                   COUNT(u.id) as doctor_count
            FROM departments d
            LEFT JOIN users u ON d.id = u.department_id AND u.role = 'doctor'
            GROUP BY d.id
            ORDER BY d.name
        ") ?? [];
        
        $this->view('admin/departments', [
            'departments' => $departments,
            'currentPage' => 'departments'
        ]);
    }
    
    public function addDepartment() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $db = \Core\Database::getInstance();
            
            $name = trim($_POST['name'] ?? '');
            $description = trim($_POST['description'] ?? '');
            
            if (empty($name)) {
                $_SESSION['error_message'] = 'Department name is required.';
                $this->redirect('?page=admin-add-department');
                return;
            }
            
            $result = $db->execute(
                "INSERT INTO departments (name, description) VALUES (?, ?)",
                [$name, $description]
            );
            
            if ($result) {
                $_SESSION['success_message'] = 'Department added successfully!';
                $this->redirect('?page=admin-departments');
            } else {
                $_SESSION['error_message'] = 'Failed to add department.';
                $this->redirect('?page=admin-add-department');
            }
        } else {
            $this->view('admin/add-department', [
                'currentPage' => 'departments'
            ]);
        }
    }
    
    public function editDepartment() {
        $db = \Core\Database::getInstance();
        $id = $_GET['id'] ?? 0;
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $id = $_POST['id'] ?? $id;
            $name = trim($_POST['name'] ?? '');
            $description = trim($_POST['description'] ?? '');
            
            if (empty($name)) {
                $_SESSION['error_message'] = 'Department name is required.';
                $this->redirect('?page=admin-edit-department&id=' . $id);
                return;
            }
            
            $result = $db->execute(
                "UPDATE departments SET name = ?, description = ? WHERE id = ?",
                [$name, $description, $id]
            );
            
            if ($result) {
                $_SESSION['success_message'] = 'Department updated successfully!';
                $this->redirect('?page=admin-departments');
            } else {
                $_SESSION['error_message'] = 'Failed to update department.';
                $this->redirect('?page=admin-edit-department&id=' . $id);
            }
        } else {
            $department = $db->query("SELECT * FROM departments WHERE id = ?", [$id])[0] ?? null;
            
            if (!$department) {
                $_SESSION['error_message'] = 'Department not found.';
                $this->redirect('?page=admin-departments');
                return;
            }
            
            $this->view('admin/edit-department', [
                'department' => $department,
                'currentPage' => 'departments'
            ]);
        }
    }
    
    public function deleteDepartment() {
        $db = \Core\Database::getInstance();
        $id = $_GET['id'] ?? 0;
        
        // Check if department has doctors
        $doctors = $db->query("SELECT COUNT(*) as count FROM users WHERE department_id = ? AND role = 'doctor'", [$id])[0]['count'] ?? 0;
        
        if ($doctors > 0) {
            $_SESSION['error_message'] = 'Cannot delete department with assigned doctors.';
        } else {
            $result = $db->execute("DELETE FROM departments WHERE id = ?", [$id]);
            
            if ($result) {
                $_SESSION['success_message'] = 'Department deleted successfully!';
            } else {
                $_SESSION['error_message'] = 'Failed to delete department.';
            }
        }
        
        $this->redirect('?page=admin-departments');
    }
    
    // ============================
    // APPOINTMENTS CRUD
    // ============================
    public function appointments() {
        $db = \Core\Database::getInstance();
        
        // Get filter parameters
        $status = $_GET['status'] ?? '';
        $date = $_GET['date'] ?? '';
        $search = $_GET['search'] ?? '';
        
        $query = "
            SELECT a.*, 
                p.name as patient_name,
                p.email as patient_email,
                p.phone as patient_phone,
                d.name as doctor_name,
                d.specialization as doctor_specialization
            FROM appointments a
            JOIN users p ON a.patient_id = p.id
            JOIN users d ON a.doctor_id = d.id
            WHERE 1=1
        ";
        
        $params = [];
        
        if (!empty($status)) {
            $query .= " AND a.status = ?";
            $params[] = $status;
        }
        
        if (!empty($date)) {
            $query .= " AND a.date = ?";
            $params[] = $date;
        }
        
        if (!empty($search)) {
            $query .= " AND (p.name LIKE ? OR d.name LIKE ? OR a.reason LIKE ?)";
            $searchTerm = "%$search%";
            $params[] = $searchTerm;
            $params[] = $searchTerm;
            $params[] = $searchTerm;
        }
        
        $query .= " ORDER BY a.date DESC, a.time DESC";
        
        $appointments = $db->query($query, $params) ?? [];
        
        // üî• FIXED: Get appointment statistics correctly üî•
        $statsQuery = "SELECT 
            COUNT(*) as total,
            SUM(CASE WHEN status = 'pending' THEN 1 ELSE 0 END) as pending,
            SUM(CASE WHEN status = 'confirmed' THEN 1 ELSE 0 END) as confirmed,
            SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completed,
            SUM(CASE WHEN status = 'cancelled' THEN 1 ELSE 0 END) as cancelled
        FROM appointments";
        
        // Apply same filters to stats
        $statsParams = [];
        $statsWhere = '';
        
        if (!empty($status)) {
            $statsWhere .= " WHERE status = ?";
            $statsParams[] = $status;
        }
        
        if (!empty($date)) {
            $statsWhere .= (!empty($statsWhere) ? " AND" : " WHERE") . " date = ?";
            $statsParams[] = $date;
        }
        
        if (!empty($search)) {
            // For search, we need to join with users tables
            $statsQuery = "SELECT 
                COUNT(*) as total,
                SUM(CASE WHEN a.status = 'pending' THEN 1 ELSE 0 END) as pending,
                SUM(CASE WHEN a.status = 'confirmed' THEN 1 ELSE 0 END) as confirmed,
                SUM(CASE WHEN a.status = 'completed' THEN 1 ELSE 0 END) as completed,
                SUM(CASE WHEN a.status = 'cancelled' THEN 1 ELSE 0 END) as cancelled
            FROM appointments a
            JOIN users p ON a.patient_id = p.id
            JOIN users d ON a.doctor_id = d.id
            WHERE (p.name LIKE ? OR d.name LIKE ? OR a.reason LIKE ?)";
            
            $searchTerm = "%$search%";
            $statsParams = [$searchTerm, $searchTerm, $searchTerm];
            
            if (!empty($status)) {
                $statsQuery .= " AND a.status = ?";
                $statsParams[] = $status;
            }
            
            if (!empty($date)) {
                $statsQuery .= " AND a.date = ?";
                $statsParams[] = $date;
            }
        } else {
            // No search, use simple query with where clause
            $statsQuery .= $statsWhere;
        }
        
        $statsResult = $db->query($statsQuery, $statsParams);
        
        // Ensure we always have stats, even if query returns nothing
        $stats = [
            'total' => 0,
            'pending' => 0,
            'confirmed' => 0,
            'completed' => 0,
            'cancelled' => 0
        ];
        
        if ($statsResult && count($statsResult) > 0) {
            $stats = [
                'total' => $statsResult[0]['total'] ?? 0,
                'pending' => $statsResult[0]['pending'] ?? 0,
                'confirmed' => $statsResult[0]['confirmed'] ?? 0,
                'completed' => $statsResult[0]['completed'] ?? 0,
                'cancelled' => $statsResult[0]['cancelled'] ?? 0
            ];
        }
        
        $this->view('admin/appointments', [
            'appointments' => $appointments,
            'stats' => $stats,
            'currentPage' => 'appointments',
            'filters' => [
                'status' => $status,
                'date' => $date,
                'search' => $search
            ]
        ]);
    }
    
    public function addAppointment() {
        $db = \Core\Database::getInstance();
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $data = [
                'patient_id' => $_POST['patient_id'] ?? 0,
                'doctor_id' => $_POST['doctor_id'] ?? 0,
                'date' => $_POST['date'] ?? '',
                'time' => $_POST['time'] ?? '',
                'reason' => trim($_POST['reason'] ?? ''),
                'status' => $_POST['status'] ?? 'pending'
            ];
            
            // Validate
            if (empty($data['patient_id']) || empty($data['doctor_id']) || empty($data['date']) || empty($data['time'])) {
                $_SESSION['error_message'] = 'Please fill all required fields.';
                $this->redirect('?page=admin-add-appointment');
                return;
            }
            
            $result = $db->execute(
                "INSERT INTO appointments (patient_id, doctor_id, date, time, reason, status) 
                 VALUES (?, ?, ?, ?, ?, ?)",
                [
                    $data['patient_id'], $data['doctor_id'], $data['date'], $data['time'],
                    $data['reason'], $data['status']
                ]
            );
            
            if ($result) {
                $_SESSION['success_message'] = 'Appointment added successfully!';
                $this->redirect('?page=admin-appointments');
            } else {
                $_SESSION['error_message'] = 'Failed to add appointment.';
                $this->redirect('?page=admin-add-appointment');
            }
        } else {
            // Get patients and doctors for dropdowns
            $patients = $db->query("SELECT id, name FROM users WHERE role = 'patient' AND status = 'active' ORDER BY name") ?? [];
            $doctors = $db->query("SELECT id, name, specialization FROM users WHERE role = 'doctor' AND status = 'active' ORDER BY name") ?? [];
            
            $this->view('admin/add-appointment', [
                'patients' => $patients,
                'doctors' => $doctors,
                'currentPage' => 'appointments'
            ]);
        }
    }
    
    public function editAppointment() {
        $db = \Core\Database::getInstance();
        $id = $_GET['id'] ?? 0;
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $id = $_POST['id'] ?? $id;
            
            $data = [
                'patient_id' => $_POST['patient_id'] ?? 0,
                'doctor_id' => $_POST['doctor_id'] ?? 0,
                'date' => $_POST['date'] ?? '',
                'time' => $_POST['time'] ?? '',
                'reason' => trim($_POST['reason'] ?? ''),
                'status' => $_POST['status'] ?? 'pending'
            ];
            
            $result = $db->execute(
                "UPDATE appointments SET 
                 patient_id = ?, doctor_id = ?, date = ?, time = ?, reason = ?, status = ? 
                 WHERE id = ?",
                [
                    $data['patient_id'], $data['doctor_id'], $data['date'], $data['time'],
                    $data['reason'], $data['status'], $id
                ]
            );
            
            if ($result) {
                $_SESSION['success_message'] = 'Appointment updated successfully!';
                $this->redirect('?page=admin-appointments');
            } else {
                $_SESSION['error_message'] = 'Failed to update appointment.';
                $this->redirect('?page=admin-edit-appointment&id=' . $id);
            }
        } else {
            $appointment = $db->query("SELECT * FROM appointments WHERE id = ?", [$id])[0] ?? null;
            
            if (!$appointment) {
                $_SESSION['error_message'] = 'Appointment not found.';
                $this->redirect('?page=admin-appointments');
                return;
            }
            
            $patients = $db->query("SELECT id, name FROM users WHERE role = 'patient' AND status = 'active' ORDER BY name") ?? [];
            $doctors = $db->query("SELECT id, name, specialization FROM users WHERE role = 'doctor' AND status = 'active' ORDER BY name") ?? [];
            
            $this->view('admin/edit-appointment', [
                'appointment' => $appointment,
                'patients' => $patients,
                'doctors' => $doctors,
                'currentPage' => 'appointments'
            ]);
        }
    }
    
    public function deleteAppointment() {
        $db = \Core\Database::getInstance();
        $id = $_GET['id'] ?? 0;
        
        $result = $db->execute("DELETE FROM appointments WHERE id = ?", [$id]);
        
        if ($result) {
            $_SESSION['success_message'] = 'Appointment deleted successfully!';
        } else {
            $_SESSION['error_message'] = 'Failed to delete appointment.';
        }
        
        $this->redirect('?page=admin-appointments');
    }
}
?>

================================================================================
FILE: controllers/HomeController.php
================================================================================

<?php
namespace Controllers;

use Core\Controller;

class HomeController extends Controller {
    
    public function index() {
        $this->view('home', [
            'currentPage' => 'home'
        ]);
    }
}
?>

================================================================================
FILE: controllers/PatientController.php
================================================================================

<?php
namespace Controllers;

use Core\Controller;
use Core\Auth;
use Models\Appointment;

class PatientController extends Controller {
    
    public function __construct() {
        $auth = Auth::getInstance();
        if (!$auth->check()) {
            $this->redirect('?page=login');
        }
        // Optional: Check if user is patient
        // if ($auth->user()->getRole() !== 'patient') {
        //     $this->redirect('?page=login');
        // }
    }
    
    // ‚úÖ ADD THIS MISSING DASHBOARD METHOD
    public function dashboard() {
        $auth = Auth::getInstance();
        $patient = $auth->user();
        
        $db = \Core\Database::getInstance();
        
        // Get upcoming appointments
        $appointments = $db->query("
            SELECT a.*, d.name as doctor_name, d.specialization
            FROM appointments a
            JOIN users d ON a.doctor_id = d.id
            WHERE a.patient_id = ? AND a.date >= CURDATE()
            ORDER BY a.date, a.time
            LIMIT 5
        ", [$patient->getId()]);
        
        // Get notifications
        $notifications = $db->query("
            SELECT * FROM notifications 
            WHERE user_id = ? 
            ORDER BY created_at DESC 
            LIMIT 5
        ", [$patient->getId()]);
        
        $this->view('patient/dashboard', [
            'appointments' => $appointments,
            'notifications' => $notifications,
            'currentPage' => 'dashboard'
        ]);
    }
    
    public function appointments() {
        $auth = Auth::getInstance();
        $patient = $auth->user();
        
        $db = \Core\Database::getInstance();
        $appointments = $db->query("
            SELECT a.*, d.name as doctor_name
            FROM appointments a
            JOIN users d ON a.doctor_id = d.id
            WHERE a.patient_id = ?
            ORDER BY a.date DESC, a.time DESC
        ", [$patient->getId()]);
        
        // Get success message if exists
        $successMessage = $_SESSION['success_message'] ?? '';
        unset($_SESSION['success_message']);
        
        $this->view('patient/appointments', [
            'appointments' => $appointments,
            'successMessage' => $successMessage,
            'currentPage' => 'appointments'
        ]);
    }
    
    public function book() {
        $db = \Core\Database::getInstance();
        
        // Get all departments (instead of just specializations)
        $departments = $db->query("
            SELECT * FROM departments 
            WHERE id IN (
                SELECT DISTINCT department_id 
                FROM users 
                WHERE role = 'doctor' 
                AND department_id IS NOT NULL
                AND status = 'active'
            )
            ORDER BY name
        ");
        
        $doctors = [];
        $selectedDepartment = '';
        $selectedSpecialization = '';
        
        // Handle form submission
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $auth = Auth::getInstance();
            $patient = $auth->user();
            
            // Check which step we're on
            if (isset($_POST['step']) && $_POST['step'] === 'select_department') {
                // Step 1: User selected department
                $selectedDepartment = $_POST['department_id'] ?? '';
                
                // Get doctors for this department
                $doctors = $db->query("
                    SELECT u.*, d.name as department_name
                    FROM users u
                    LEFT JOIN departments d ON u.department_id = d.id
                    WHERE u.role = 'doctor' 
                    AND u.department_id = ?
                    AND u.status = 'active'
                    ORDER BY u.name
                ", [$selectedDepartment]);
                
            } elseif (isset($_POST['step']) && $_POST['step'] === 'select_specialization') {
                // Step 2: User selected specialization within department
                $selectedDepartment = $_POST['department_id'] ?? '';
                $selectedSpecialization = $_POST['specialization'] ?? '';
                
                // Get doctors for this department and specialization
                $doctors = $db->query("
                    SELECT u.*, d.name as department_name
                    FROM users u
                    LEFT JOIN departments d ON u.department_id = d.id
                    WHERE u.role = 'doctor' 
                    AND u.department_id = ?
                    AND u.specialization = ?
                    AND u.status = 'active'
                    ORDER BY u.name
                ", [$selectedDepartment, $selectedSpecialization]);
                
            } elseif (isset($_POST['step']) && $_POST['step'] === 'book_appointment') {
                // Step 3: User is booking the appointment
                $selectedDepartment = $_POST['department_id'] ?? '';
                $doctorId = $_POST['doctor_id'] ?? '';
                
                // Validate doctor exists and is active
                $doctor = $db->query("
                    SELECT * FROM users 
                    WHERE id = ? 
                    AND role = 'doctor' 
                    AND status = 'active'
                ", [$doctorId]);
                
                if (empty($doctor)) {
                    $error = "Invalid doctor selection. Please try again.";
                    $this->view('patient/book', [
                        'departments' => $departments,
                        'selectedDepartment' => $selectedDepartment,
                        'selectedSpecialization' => $selectedSpecialization,
                        'doctors' => $doctors,
                        'error' => $error,
                        'currentPage' => 'book'
                    ]);
                    return;
                }
                
                // Create and save appointment
                $appointment = new \Models\Appointment([
                    'patient_id' => $patient->getId(),
                    'doctor_id' => $doctorId,
                    'date' => $_POST['date'],
                    'time' => $_POST['time'],
                    'reason' => $_POST['reason'],
                    'status' => 'pending'
                ]);
                
                $result = $appointment->save();
                
                if ($result) {
                    // Success - show success message then redirect
                    $_SESSION['success_message'] = 'Appointment booked successfully!';
                    $this->redirect('?page=patient-appointments');
                } else {
                    $error = "Failed to book appointment. Please try again.";
                    $this->view('patient/book', [
                        'departments' => $departments,
                        'selectedDepartment' => $selectedDepartment,
                        'selectedSpecialization' => $selectedSpecialization,
                        'doctors' => $doctors,
                        'error' => $error,
                        'currentPage' => 'book'
                    ]);
                }
                return;
            }
        }
        
        // Get specializations for selected department (if any)
        $specializations = [];
        if ($selectedDepartment) {
            $specializations = $db->query("
                SELECT DISTINCT specialization 
                FROM users 
                WHERE role = 'doctor' 
                AND department_id = ?
                AND specialization IS NOT NULL 
                AND specialization != ''
                AND status = 'active'
                ORDER BY specialization
            ", [$selectedDepartment]);
        }
        
        $this->view('patient/book', [
            'departments' => $departments,
            'specializations' => $specializations,
            'doctors' => $doctors,
            'selectedDepartment' => $selectedDepartment,
            'selectedSpecialization' => $selectedSpecialization,
            'currentPage' => 'book'
        ]);
    }
    
    public function profile() {
        $auth = Auth::getInstance();
        $patient = $auth->user();
        
        $this->view('patient/profile', [
            'currentPage' => 'profile',
            'patient' => $patient
        ]);
    }
}
?>

================================================================================
FILE: controllers/AppointmentController.php
================================================================================

<?php
namespace Controllers;

use Core\Controller;
use Core\Auth;
use Models\Appointment;

class AppointmentController extends Controller {
    
    public function __construct() {
        $auth = Auth::getInstance();
        if (!$auth->check()) {
            $this->redirect('?page=login');
        }
    }
    
    public function cancel() {
        // Check if it's a POST request and has ID
        if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_GET['id'])) {
            $id = (int)$_GET['id'];
            
            // Get current user
            $auth = Auth::getInstance();
            $user = $auth->user();
            
            // Find the appointment
            $appointment = Appointment::find($id);
            
            if ($appointment) {
                // Check if user has permission to cancel
                $canCancel = false;
                
                switch ($user->getRole()) {
                    case 'admin':
                        $canCancel = true; // Admin can cancel any appointment
                        break;
                    case 'doctor':
                        // Doctor can only cancel their own appointments
                        $canCancel = ($appointment->getDoctorId() == $user->getId());
                        break;
                    case 'patient':
                        // Patient can only cancel their own appointments
                        $canCancel = ($appointment->getPatientId() == $user->getId());
                        break;
                    case 'receptionist':
                        $canCancel = true; // Receptionist can cancel any appointment
                        break;
                }
                
                if ($canCancel) {
                    // Update status to cancelled
                    $result = $appointment->updateStatus('cancelled');
                    
                    if ($result) {
                        $_SESSION['success_message'] = 'Appointment cancelled successfully!';
                    } else {
                        $_SESSION['error_message'] = 'Failed to cancel appointment.';
                    }
                } else {
                    $_SESSION['error_message'] = 'You do not have permission to cancel this appointment.';
                }
            } else {
                $_SESSION['error_message'] = 'Appointment not found.';
            }
            
            // Redirect back based on user role
            $this->redirectToAppointmentsPage($user->getRole());
            
        } else {
            // Invalid request, redirect to home
            $this->redirect('?page=home');
        }
    }
    
    public function updateStatus() {
        if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_GET['id'])) {
            $id = (int)$_GET['id'];
            $status = $_POST['status'] ?? '';
            
            // Validate status
            $validStatuses = ['pending', 'confirmed', 'completed', 'cancelled'];
            if (!in_array($status, $validStatuses)) {
                $_SESSION['error_message'] = 'Invalid status.';
                $this->redirect('?page=home');
                return;
            }
            
            $auth = Auth::getInstance();
            $user = $auth->user();
            
            $appointment = Appointment::find($id);
            
            if ($appointment) {
                // Check permissions based on role
                $canUpdate = false;
                
                switch ($user->getRole()) {
                    case 'admin':
                    case 'receptionist':
                        $canUpdate = true;
                        break;
                    case 'doctor':
                        // Doctor can only update their own appointments
                        $canUpdate = ($appointment->getDoctorId() == $user->getId());
                        break;
                }
                
                if ($canUpdate) {
                    $result = $appointment->updateStatus($status);
                    
                    if ($result) {
                        $_SESSION['success_message'] = "Appointment status updated to {$status}.";
                    } else {
                        $_SESSION['error_message'] = 'Failed to update appointment status.';
                    }
                } else {
                    $_SESSION['error_message'] = 'You do not have permission to update this appointment.';
                }
            } else {
                $_SESSION['error_message'] = 'Appointment not found.';
            }
            
            $this->redirectToAppointmentsPage($user->getRole());
        }
    }
    
    private function redirectToAppointmentsPage($role) {
        switch ($role) {
            case 'admin':
                $this->redirect('?page=admin-appointments');
                break;
            case 'doctor':
                $this->redirect('?page=doctor-appointments');
                break;
            case 'receptionist':
                $this->redirect('?page=receptionist-appointments');
                break;
            case 'patient':
                $this->redirect('?page=patient-appointments');
                break;
            default:
                $this->redirect('?page=home');
        }
    }
}
?>

================================================================================
FILE: controllers/AuthController.php
================================================================================

<?php
// controllers/AuthController.php - WORKING VERSION
namespace Controllers;

use Core\Controller;
use Core\Auth;
use Models\UserFactory;

class AuthController extends Controller {
    
    public function login() {
        // If already logged in, redirect to dashboard
        $auth = Auth::getInstance();
        if ($auth->check()) {
            $user = $auth->user();
            $this->redirectToDashboard($user->getRole());
            return;
        }
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $email = trim($_POST['email'] ?? '');
            $password = $_POST['password'] ?? '';
            $selectedRole = $_POST['role'] ?? '';
            
            // Debug logging
            error_log("=== LOGIN ATTEMPT ===");
            error_log("Email: $email");
            error_log("Selected Role: $selectedRole");
            
            if (empty($email) || empty($password)) {
                $this->view('auth/login', ['error' => 'Email and password are required']);
                return;
            }
            
            // Attempt login
            $user = $auth->login($email, $password);
            
            if ($user) {
                $actualRole = $user->getRole();
                error_log("Login SUCCESS - User Role: $actualRole");
                
                // üî• REMOVED STRICT ROLE CHECKING üî•
                // Just redirect to the appropriate dashboard based on actual role
                $this->redirectToDashboard($actualRole);
                
            } else {
                error_log("Login FAILED for: $email");
                $this->view('auth/login', [
                    'error' => 'Invalid email or password. Please check your credentials.'
                ]);
            }
        } else {
            // GET request - show login form
            $this->view('auth/login');
        }
    }
    
    private function redirectToDashboard($role) {
        $dashboardPages = [
            'admin' => 'admin-dashboard',
            'doctor' => 'doctor-dashboard',
            'receptionist' => 'receptionist-dashboard',
            'patient' => 'patient-dashboard'
        ];
        
        $page = $dashboardPages[$role] ?? 'home';
        
        error_log("Redirecting $role to: $page");
        $this->redirect('?page=' . $page);
    }
    
    public function register() {
        $auth = Auth::getInstance();
        if ($auth->check()) {
            $user = $auth->user();
            $this->redirectToDashboard($user->getRole());
            return;
        }
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $name = trim($_POST['name'] ?? '');
            $email = trim($_POST['email'] ?? '');
            $password = $_POST['password'] ?? '';
            $confirmPassword = $_POST['confirm_password'] ?? '';
            $phone = trim($_POST['phone'] ?? '');
            
            // Validation
            $errors = [];
            if (empty($name)) $errors[] = "Name is required";
            if (empty($email)) $errors[] = "Email is required";
            if (!filter_var($email, FILTER_VALIDATE_EMAIL)) $errors[] = "Invalid email format";
            if (empty($password)) $errors[] = "Password is required";
            if (strlen($password) < 6) $errors[] = "Password must be at least 6 characters";
            if ($password !== $confirmPassword) $errors[] = "Passwords do not match";
            
            if (!empty($errors)) {
                $this->view('auth/register', ['error' => implode('<br>', $errors)]);
                return;
            }
            
            // Hash password
            $hashedPassword = password_hash($password, PASSWORD_DEFAULT);
            
            // Create user
            $userData = [
                'name' => $name,
                'email' => $email,
                'password' => $hashedPassword,
                'phone' => $phone,
                'role' => 'patient',
                'status' => 'active'
            ];
            
            try {
                $user = UserFactory::createUser('patient', $userData);
                $db = \Core\Database::getInstance();
                
                // Save to database
                $sql = "INSERT INTO users (name, email, password, phone, role, status) 
                        VALUES (?, ?, ?, ?, ?, ?)";
                $db->execute($sql, [
                    $name, $email, $hashedPassword, $phone, 'patient', 'active'
                ]);
                
                // Auto login
                $auth->login($email, $password);
                $this->redirect('?page=patient-dashboard');
                
            } catch (\Exception $e) {
                $this->view('auth/register', ['error' => 'Registration failed: ' . $e->getMessage()]);
            }
        } else {
            $this->view('auth/register');
        }
    }
    
    public function logout() {
        $auth = Auth::getInstance();
        $auth->logout();
        $this->redirect('?page=login');
    }
}
?>

================================================================================
FILE: controllers/DoctorController.php
================================================================================

<?php
// controllers/DoctorController.php - COMPLETE VERSION
namespace Controllers;

use Core\Controller;
use Core\Auth;
use Models\Appointment;
use Models\UserFactory;

class DoctorController extends Controller {
    
    public function __construct() {
        $auth = Auth::getInstance();
        if (!$auth->check()) {
            $this->redirect('?page=login');
        }
        
        $user = $auth->user();
        if ($user && $user->getRole() !== 'doctor') {
            $_SESSION['error_message'] = 'Access denied. Doctor privileges required.';
            $this->redirect('?page=login');
        }
    }
    
    public function dashboard() {
        $auth = Auth::getInstance();
        $doctor = $auth->user();
        
        $db = \Core\Database::getInstance();
        
        // Get statistics
        $stats = [
            'today_appointments' => $db->query("
                SELECT COUNT(*) as count 
                FROM appointments 
                WHERE doctor_id = ? AND date = CURDATE() AND status != 'cancelled'
            ", [$doctor->getId()])[0]['count'] ?? 0,
            
            'total_appointments' => $db->query("
                SELECT COUNT(*) as count 
                FROM appointments 
                WHERE doctor_id = ? AND status != 'cancelled'
            ", [$doctor->getId()])[0]['count'] ?? 0,
            
            'pending_appointments' => $db->query("
                SELECT COUNT(*) as count 
                FROM appointments 
                WHERE doctor_id = ? AND status = 'pending'
            ", [$doctor->getId()])[0]['count'] ?? 0,
            
            'completed_appointments' => $db->query("
                SELECT COUNT(*) as count 
                FROM appointments 
                WHERE doctor_id = ? AND status = 'completed'
            ", [$doctor->getId()])[0]['count'] ?? 0
        ];
        
        // Get today's appointments
        $todayAppointments = $db->query("
            SELECT a.*, 
                   p.name as patient_name, 
                   p.phone as patient_phone,
                   p.email as patient_email
            FROM appointments a
            JOIN users p ON a.patient_id = p.id
            WHERE a.doctor_id = ? 
            AND a.date = CURDATE()
            AND a.status != 'cancelled'
            ORDER BY a.time
        ", [$doctor->getId()]) ?? [];
        
        // Get upcoming appointments (next 7 days)
        $upcomingAppointments = $db->query("
            SELECT a.*, 
                   p.name as patient_name,
                   DATE_FORMAT(a.date, '%W, %M %d') as formatted_date
            FROM appointments a
            JOIN users p ON a.patient_id = p.id
            WHERE a.doctor_id = ? 
            AND a.date BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 7 DAY)
            AND a.status = 'confirmed'
            ORDER BY a.date, a.time
            LIMIT 10
        ", [$doctor->getId()]) ?? [];
        
        // Get doctor's profile info
        $doctorInfo = $db->query("
            SELECT u.*, d.name as department_name
            FROM users u
            LEFT JOIN departments d ON u.department_id = d.id
            WHERE u.id = ?
        ", [$doctor->getId()])[0] ?? [];
        
        $this->view('doctor/dashboard', [
            'stats' => $stats,
            'todayAppointments' => $todayAppointments,
            'upcomingAppointments' => $upcomingAppointments,
            'doctorInfo' => $doctorInfo,
            'currentPage' => 'dashboard'
        ]);
    }
    
    public function appointments() {
        $auth = Auth::getInstance();
        $doctor = $auth->user();
        
        $db = \Core\Database::getInstance();
        
        // Get filter parameters
        $status = $_GET['status'] ?? '';
        $date = $_GET['date'] ?? '';
        $search = $_GET['search'] ?? '';
        
        $query = "
            SELECT a.*, 
                   p.name as patient_name,
                   p.phone as patient_phone,
                   p.email as patient_email,
                   DATE_FORMAT(a.date, '%M %d, %Y') as formatted_date,
                   DATE_FORMAT(a.time, '%h:%i %p') as formatted_time
            FROM appointments a
            JOIN users p ON a.patient_id = p.id
            WHERE a.doctor_id = ?
        ";
        
        $params = [$doctor->getId()];
        
        if (!empty($status)) {
            $query .= " AND a.status = ?";
            $params[] = $status;
        }
        
        if (!empty($date)) {
            $query .= " AND a.date = ?";
            $params[] = $date;
        }
        
        if (!empty($search)) {
            $query .= " AND (p.name LIKE ? OR a.reason LIKE ?)";
            $searchTerm = "%$search%";
            $params[] = $searchTerm;
            $params[] = $searchTerm;
        }
        
        $query .= " ORDER BY a.date DESC, a.time DESC";
        
        $appointments = $db->query($query, $params) ?? [];
        
        // Appointment statistics
        $statsQuery = "
            SELECT 
                COUNT(*) as total,
                SUM(CASE WHEN status = 'pending' THEN 1 ELSE 0 END) as pending,
                SUM(CASE WHEN status = 'confirmed' THEN 1 ELSE 0 END) as confirmed,
                SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completed,
                SUM(CASE WHEN status = 'cancelled' THEN 1 ELSE 0 END) as cancelled
            FROM appointments 
            WHERE doctor_id = ?
        ";
        
        $statsResult = $db->query($statsQuery, [$doctor->getId()])[0] ?? [];
        
        $stats = [
            'total' => $statsResult['total'] ?? 0,
            'pending' => $statsResult['pending'] ?? 0,
            'confirmed' => $statsResult['confirmed'] ?? 0,
            'completed' => $statsResult['completed'] ?? 0,
            'cancelled' => $statsResult['cancelled'] ?? 0
        ];
        
        $this->view('doctor/appointments', [
            'appointments' => $appointments,
            'stats' => $stats,
            'currentPage' => 'appointments',
            'filters' => [
                'status' => $status,
                'date' => $date,
                'search' => $search
            ]
        ]);
    }
    
    public function updateAppointmentStatus() {
        $auth = Auth::getInstance();
        $doctor = $auth->user();
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $appointmentId = $_POST['appointment_id'] ?? 0;
            $newStatus = $_POST['status'] ?? '';
            $notes = $_POST['notes'] ?? '';
            
            $db = \Core\Database::getInstance();
            
            // Verify appointment belongs to this doctor
            $appointment = $db->query("
                SELECT * FROM appointments 
                WHERE id = ? AND doctor_id = ?
            ", [$appointmentId, $doctor->getId()])[0] ?? null;
            
            if (!$appointment) {
                $_SESSION['error_message'] = 'Appointment not found or access denied.';
                $this->redirect('?page=doctor-appointments');
                return;
            }
            
            // Update status
            $result = $db->execute("
                UPDATE appointments 
                SET status = ?, doctor_notes = ?, updated_at = NOW()
                WHERE id = ?
            ", [$newStatus, $notes, $appointmentId]);
            
            if ($result) {
                // Create notification for patient
                $db->execute("
                    INSERT INTO notifications (user_id, type, message) 
                    VALUES (?, 'appointment_update', ?)
                ", [
                    $appointment['patient_id'],
                    "Your appointment status has been updated to: " . ucfirst($newStatus)
                ]);
                
                $_SESSION['success_message'] = 'Appointment status updated successfully!';
            } else {
                $_SESSION['error_message'] = 'Failed to update appointment.';
            }
            
            $this->redirect('?page=doctor-appointments');
        }
    }
    
    public function schedule() {
        $auth = Auth::getInstance();
        $doctor = $auth->user();
        
        $db = \Core\Database::getInstance();
        
        // Get doctor's schedule
        $schedule = $db->query("
            SELECT * FROM doctor_schedules 
            WHERE doctor_id = ?
            ORDER BY day_of_week, start_time
        ", [$doctor->getId()]) ?? [];
        
        // Get available days
        $days = [
            'Monday', 'Tuesday', 'Wednesday', 'Thursday', 
            'Friday', 'Saturday', 'Sunday'
        ];
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            // Update schedule
            $dayOfWeek = $_POST['day_of_week'] ?? '';
            $startTime = $_POST['start_time'] ?? '';
            $endTime = $_POST['end_time'] ?? '';
            $maxPatients = $_POST['max_patients'] ?? 20;
            $isActive = isset($_POST['is_active']) ? 1 : 0;
            
            // Check if schedule exists for this day
            $existing = $db->query("
                SELECT id FROM doctor_schedules 
                WHERE doctor_id = ? AND day_of_week = ?
            ", [$doctor->getId(), $dayOfWeek])[0] ?? null;
            
            if ($existing) {
                // Update existing
                $result = $db->execute("
                    UPDATE doctor_schedules 
                    SET start_time = ?, end_time = ?, max_patients = ?, is_active = ?
                    WHERE id = ?
                ", [$startTime, $endTime, $maxPatients, $isActive, $existing['id']]);
            } else {
                // Create new
                $result = $db->execute("
                    INSERT INTO doctor_schedules (doctor_id, day_of_week, start_time, end_time, max_patients, is_active)
                    VALUES (?, ?, ?, ?, ?, ?)
                ", [$doctor->getId(), $dayOfWeek, $startTime, $endTime, $maxPatients, $isActive]);
            }
            
            if ($result) {
                $_SESSION['success_message'] = 'Schedule updated successfully!';
            } else {
                $_SESSION['error_message'] = 'Failed to update schedule.';
            }
            
            $this->redirect('?page=doctor-schedule');
        }
        
        $this->view('doctor/schedule', [
            'schedule' => $schedule,
            'days' => $days,
            'currentPage' => 'schedule'
        ]);
    }
    
    public function profile() {
        $auth = Auth::getInstance();
        $doctor = $auth->user();
        
        $db = \Core\Database::getInstance();
        
        // Get doctor details
        $doctorDetails = $db->query("
            SELECT u.*, d.name as department_name
            FROM users u
            LEFT JOIN departments d ON u.department_id = d.id
            WHERE u.id = ?
        ", [$doctor->getId()])[0] ?? [];
        
        // Get all departments for dropdown
        $departments = $db->query("SELECT * FROM departments ORDER BY name") ?? [];
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $name = trim($_POST['name'] ?? '');
            $phone = trim($_POST['phone'] ?? '');
            $specialization = trim($_POST['specialization'] ?? '');
            $departmentId = $_POST['department_id'] ?? null;
            $bio = trim($_POST['bio'] ?? '');
            
            // Update doctor info
            $result = $db->execute("
                UPDATE users 
                SET name = ?, phone = ?, specialization = ?, department_id = ?, bio = ?, updated_at = NOW()
                WHERE id = ?
            ", [$name, $phone, $specialization, $departmentId, $bio, $doctor->getId()]);
            
            if ($result) {
                $_SESSION['success_message'] = 'Profile updated successfully!';
                $_SESSION['user_name'] = $name; // Update session name
                $this->redirect('?page=doctor-profile');
            } else {
                $_SESSION['error_message'] = 'Failed to update profile.';
            }
        }
        
        $this->view('doctor/profile', [
            'doctor' => $doctorDetails,
            'departments' => $departments,
            'currentPage' => 'profile'
        ]);
    }
    
    public function patients() {
        $auth = Auth::getInstance();
        $doctor = $auth->user();
        
        $db = \Core\Database::getInstance();
        
        // Get patients who have appointments with this doctor
        $patients = $db->query("
            SELECT DISTINCT 
                   p.id,
                   p.name,
                   p.email,
                   p.phone,
                   p.status,
                   COUNT(a.id) as appointment_count,
                   MAX(a.date) as last_appointment
            FROM users p
            JOIN appointments a ON p.id = a.patient_id
            WHERE a.doctor_id = ?
            AND p.role = 'patient'
            GROUP BY p.id
            ORDER BY p.name
        ", [$doctor->getId()]) ?? [];
        
        $this->view('doctor/patients', [
            'patients' => $patients,
            'currentPage' => 'patients'
        ]);
    }
}
?>

================================================================================
FILE: controllers/ReceptionistController.php
================================================================================

<?php
// controllers/ReceptionistController.php - COMPLETE VERSION
namespace Controllers;

use Core\Controller;
use Core\Auth;
use Models\UserFactory;
use Models\Appointment;

class ReceptionistController extends Controller {
    
    public function __construct() {
        $auth = Auth::getInstance();
        if (!$auth->check()) {
            $this->redirect('?page=login');
        }
        
        $user = $auth->user();
        if ($user && $user->getRole() !== 'receptionist') {
            $_SESSION['error_message'] = 'Access denied. Receptionist privileges required.';
            $this->redirect('?page=login');
        }
    }
    
    public function dashboard() {
        $db = \Core\Database::getInstance();
        
        // Get statistics
        $stats = [
            'today_appointments' => $db->query("
                SELECT COUNT(*) as count 
                FROM appointments 
                WHERE date = CURDATE()
            ")[0]['count'] ?? 0,
            
            'total_patients' => $db->query("
                SELECT COUNT(*) as count 
                FROM users 
                WHERE role = 'patient' AND status = 'active'
            ")[0]['count'] ?? 0,
            
            'pending_appointments' => $db->query("
                SELECT COUNT(*) as count 
                FROM appointments 
                WHERE status = 'pending'
            ")[0]['count'] ?? 0,
            
            'available_doctors' => $db->query("
                SELECT COUNT(*) as count 
                FROM users 
                WHERE role = 'doctor' AND status = 'active'
            ")[0]['count'] ?? 0
        ];
        
        // Get today's appointments
        $todayAppointments = $db->query("
            SELECT a.*, 
                   p.name as patient_name,
                   p.phone as patient_phone,
                   d.name as doctor_name,
                   d.specialization as doctor_specialization,
                   TIME_FORMAT(a.time, '%h:%i %p') as formatted_time
            FROM appointments a
            JOIN users p ON a.patient_id = p.id
            JOIN users d ON a.doctor_id = d.id
            WHERE a.date = CURDATE()
            ORDER BY a.time
        ") ?? [];
        
        // Get recent patients
        $recentPatients = $db->query("
            SELECT * FROM users 
            WHERE role = 'patient' 
            ORDER BY created_at DESC 
            LIMIT 5
        ") ?? [];
        
        $this->view('receptionist/dashboard', [
            'stats' => $stats,
            'todayAppointments' => $todayAppointments,
            'recentPatients' => $recentPatients,
            'currentPage' => 'dashboard'
        ]);
    }
    
    public function patients() {
        $db = \Core\Database::getInstance();
        
        // Get filter parameters
        $search = $_GET['search'] ?? '';
        $status = $_GET['status'] ?? '';
        
        $query = "SELECT * FROM users WHERE role = 'patient'";
        $params = [];
        
        if (!empty($search)) {
            $query .= " AND (name LIKE ? OR email LIKE ? OR phone LIKE ?)";
            $searchTerm = "%$search%";
            $params[] = $searchTerm;
            $params[] = $searchTerm;
            $params[] = $searchTerm;
        }
        
        if (!empty($status)) {
            $query .= " AND status = ?";
            $params[] = $status;
        }
        
        $query .= " ORDER BY created_at DESC";
        
        $patients = $db->query($query, $params) ?? [];
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            // Add new patient
            $name = trim($_POST['name'] ?? '');
            $email = trim($_POST['email'] ?? '');
            $phone = trim($_POST['phone'] ?? '');
            $address = trim($_POST['address'] ?? '');
            $gender = $_POST['gender'] ?? '';
            $date_of_birth = $_POST['date_of_birth'] ?? '';
            
            // Check if email exists
            $existing = $db->query("SELECT id FROM users WHERE email = ?", [$email]);
            if ($existing) {
                $_SESSION['error_message'] = 'Email already exists.';
                $this->redirect('?page=receptionist-patients');
                return;
            }
            
            // Default password
            $password = 'patient123';
            $hashedPassword = password_hash($password, PASSWORD_DEFAULT);
            
            // Insert patient
            $result = $db->execute("
                INSERT INTO users (name, email, password, phone, role, status) 
                VALUES (?, ?, ?, ?, 'patient', 'active')
            ", [$name, $email, $hashedPassword, $phone]);
            
            if ($result) {
                $patientId = $db->getConnection()->lastInsertId();
                
                // Insert patient details
                $db->execute("
                    INSERT INTO patient_details (user_id, address, gender, date_of_birth) 
                    VALUES (?, ?, ?, ?)
                ", [$patientId, $address, $gender, $date_of_birth]);
                
                $_SESSION['success_message'] = 'Patient registered successfully!';
                $this->redirect('?page=receptionist-patients');
            } else {
                $_SESSION['error_message'] = 'Failed to register patient.';
            }
        }
        
        $this->view('receptionist/patients', [
            'patients' => $patients,
            'currentPage' => 'patients',
            'filters' => [
                'search' => $search,
                'status' => $status
            ]
        ]);
    }
    
    public function appointments() {
        $db = \Core\Database::getInstance();
        
        // Get filter parameters
        $status = $_GET['status'] ?? '';
        $date = $_GET['date'] ?? '';
        $doctor_id = $_GET['doctor_id'] ?? '';
        $patient_id = $_GET['patient_id'] ?? '';
        
        $query = "
            SELECT a.*, 
                   p.name as patient_name,
                   p.phone as patient_phone,
                   d.name as doctor_name,
                   d.specialization as doctor_specialization,
                   DATE_FORMAT(a.date, '%M %d, %Y') as formatted_date,
                   TIME_FORMAT(a.time, '%h:%i %p') as formatted_time
            FROM appointments a
            JOIN users p ON a.patient_id = p.id
            JOIN users d ON a.doctor_id = d.id
            WHERE 1=1
        ";
        
        $params = [];
        
        if (!empty($status)) {
            $query .= " AND a.status = ?";
            $params[] = $status;
        }
        
        if (!empty($date)) {
            $query .= " AND a.date = ?";
            $params[] = $date;
        }
        
        if (!empty($doctor_id)) {
            $query .= " AND a.doctor_id = ?";
            $params[] = $doctor_id;
        }
        
        if (!empty($patient_id)) {
            $query .= " AND a.patient_id = ?";
            $params[] = $patient_id;
        }
        
        $query .= " ORDER BY a.date DESC, a.time DESC";
        
        $appointments = $db->query($query, $params) ?? [];
        
        // Get doctors and patients for filters and forms
        $doctors = $db->query("
            SELECT id, name, specialization 
            FROM users 
            WHERE role = 'doctor' AND status = 'active'
            ORDER BY name
        ") ?? [];
        
        $patients = $db->query("
            SELECT id, name, phone 
            FROM users 
            WHERE role = 'patient' AND status = 'active'
            ORDER BY name
        ") ?? [];
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            if (isset($_POST['add_appointment'])) {
                // Book new appointment
                $patientId = $_POST['patient_id'] ?? 0;
                $doctorId = $_POST['doctor_id'] ?? 0;
                $date = $_POST['date'] ?? '';
                $time = $_POST['time'] ?? '';
                $reason = trim($_POST['reason'] ?? '');
                $status = $_POST['status'] ?? 'pending';
                
                // Validate
                if (empty($patientId) || empty($doctorId) || empty($date) || empty($time)) {
                    $_SESSION['error_message'] = 'Please fill all required fields.';
                    $this->redirect('?page=receptionist-appointments');
                    return;
                }
                
                // Check if appointment time is available
                $existing = $db->query("
                    SELECT id FROM appointments 
                    WHERE doctor_id = ? AND date = ? AND time = ?
                ", [$doctorId, $date, $time]);
                
                if ($existing) {
                    $_SESSION['error_message'] = 'This time slot is already booked.';
                    $this->redirect('?page=receptionist-appointments');
                    return;
                }
                
                $result = $db->execute("
                    INSERT INTO appointments (patient_id, doctor_id, date, time, reason, status, created_by) 
                    VALUES (?, ?, ?, ?, ?, ?, ?)
                ", [
                    $patientId, $doctorId, $date, $time, $reason, $status, $_SESSION['user_id']
                ]);
                
                if ($result) {
                    // Create notification for patient
                    $db->execute("
                        INSERT INTO notifications (user_id, type, message) 
                        VALUES (?, 'appointment_created', ?)
                    ", [
                        $patientId,
                        "New appointment booked for " . date('M d, Y', strtotime($date)) . " at " . date('h:i A', strtotime($time))
                    ]);
                    
                    $_SESSION['success_message'] = 'Appointment booked successfully!';
                } else {
                    $_SESSION['error_message'] = 'Failed to book appointment.';
                }
                
                $this->redirect('?page=receptionist-appointments');
                
            } elseif (isset($_POST['update_appointment'])) {
                // Update appointment status
                $appointmentId = $_POST['appointment_id'] ?? 0;
                $newStatus = $_POST['status'] ?? '';
                
                $result = $db->execute("
                    UPDATE appointments 
                    SET status = ?, updated_at = NOW()
                    WHERE id = ?
                ", [$newStatus, $appointmentId]);
                
                if ($result) {
                    // Get appointment details for notification
                    $appointment = $db->query("
                        SELECT patient_id, date, time 
                        FROM appointments 
                        WHERE id = ?
                    ", [$appointmentId])[0] ?? [];
                    
                    if ($appointment) {
                        $db->execute("
                            INSERT INTO notifications (user_id, type, message) 
                            VALUES (?, 'appointment_update', ?)
                        ", [
                            $appointment['patient_id'],
                            "Your appointment status has been updated to: " . ucfirst($newStatus)
                        ]);
                    }
                    
                    $_SESSION['success_message'] = 'Appointment status updated!';
                } else {
                    $_SESSION['error_message'] = 'Failed to update appointment.';
                }
                
                $this->redirect('?page=receptionist-appointments');
            }
        }
        
        $this->view('receptionist/appointments', [
            'appointments' => $appointments,
            'doctors' => $doctors,
            'patients' => $patients,
            'currentPage' => 'appointments',
            'filters' => [
                'status' => $status,
                'date' => $date,
                'doctor_id' => $doctor_id,
                'patient_id' => $patient_id
            ]
        ]);
    }
    
    public function doctors() {
        $db = \Core\Database::getInstance();
        
        $doctors = $db->query("
            SELECT u.*, d.name as department_name,
                   (SELECT COUNT(*) FROM appointments WHERE doctor_id = u.id AND date >= CURDATE()) as upcoming_appointments
            FROM users u
            LEFT JOIN departments d ON u.department_id = d.id
            WHERE u.role = 'doctor'
            ORDER BY u.name
        ") ?? [];
        
        // Get doctor schedules
        foreach ($doctors as &$doctor) {
            $doctor['schedule'] = $db->query("
                SELECT * FROM doctor_schedules 
                WHERE doctor_id = ? AND is_active = 1
                ORDER BY day_of_week
            ", [$doctor['id']]) ?? [];
        }
        
        $this->view('receptionist/doctors', [
            'doctors' => $doctors,
            'currentPage' => 'doctors'
        ]);
    }
    
    public function editAppointment() {
        $db = \Core\Database::getInstance();
        $id = $_GET['id'] ?? 0;
        
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $id = $_POST['id'] ?? $id;
            $patientId = $_POST['patient_id'] ?? 0;
            $doctorId = $_POST['doctor_id'] ?? 0;
            $date = $_POST['date'] ?? '';
            $time = $_POST['time'] ?? '';
            $reason = trim($_POST['reason'] ?? '');
            $status = $_POST['status'] ?? 'pending';
            
            // Check for time conflict (excluding current appointment)
            $existing = $db->query("
                SELECT id FROM appointments 
                WHERE doctor_id = ? AND date = ? AND time = ? AND id != ?
            ", [$doctorId, $date, $time, $id]);
            
            if ($existing) {
                $_SESSION['error_message'] = 'This time slot is already booked for the selected doctor.';
                $this->redirect('?page=receptionist-edit-appointment&id=' . $id);
                return;
            }
            
            $result = $db->execute("
                UPDATE appointments 
                SET patient_id = ?, doctor_id = ?, date = ?, time = ?, reason = ?, status = ?, updated_at = NOW()
                WHERE id = ?
            ", [$patientId, $doctorId, $date, $time, $reason, $status, $id]);
            
            if ($result) {
                $_SESSION['success_message'] = 'Appointment updated successfully!';
                $this->redirect('?page=receptionist-appointments');
            } else {
                $_SESSION['error_message'] = 'Failed to update appointment.';
                $this->redirect('?page=receptionist-edit-appointment&id=' . $id);
            }
        } else {
            $appointment = $db->query("
                SELECT a.*, 
                       p.name as patient_name,
                       d.name as doctor_name
                FROM appointments a
                JOIN users p ON a.patient_id = p.id
                JOIN users d ON a.doctor_id = d.id
                WHERE a.id = ?
            ", [$id])[0] ?? null;
            
            if (!$appointment) {
                $_SESSION['error_message'] = 'Appointment not found.';
                $this->redirect('?page=receptionist-appointments');
                return;
            }
            
            $doctors = $db->query("
                SELECT id, name, specialization 
                FROM users 
                WHERE role = 'doctor' AND status = 'active'
                ORDER BY name
            ") ?? [];
            
            $patients = $db->query("
                SELECT id, name, phone 
                FROM users 
                WHERE role = 'patient' AND status = 'active'
                ORDER BY name
            ") ?? [];
            
            $this->view('receptionist/edit-appointment', [
                'appointment' => $appointment,
                'doctors' => $doctors,
                'patients' => $patients,
                'currentPage' => 'appointments'
            ]);
        }
    }
    
    public function cancelAppointment() {
        $db = \Core\Database::getInstance();
        $id = $_GET['id'] ?? 0;
        
        $appointment = $db->query("SELECT * FROM appointments WHERE id = ?", [$id])[0] ?? null;
        
        if (!$appointment) {
            $_SESSION['error_message'] = 'Appointment not found.';
            $this->redirect('?page=receptionist-appointments');
            return;
        }
        
        $result = $db->execute("
            UPDATE appointments 
            SET status = 'cancelled', updated_at = NOW()
            WHERE id = ?
        ", [$id]);
        
        if ($result) {
            // Create notification for patient
            $db->execute("
                INSERT INTO notifications (user_id, type, message) 
                VALUES (?, 'appointment_cancelled', ?)
            ", [
                $appointment['patient_id'],
                "Your appointment has been cancelled."
            ]);
            
            $_SESSION['success_message'] = 'Appointment cancelled successfully!';
        } else {
            $_SESSION['error_message'] = 'Failed to cancel appointment.';
        }
        
        $this->redirect('?page=receptionist-appointments');
    }
}
?>

================================================================================
FILE: views/home.php
================================================================================

<?php
$pageTitle = 'Kasr Al Ainy Hospital - Home';
include __DIR__ . '/layouts/header.php';
?>

<!-- Main Content -->
<main>
    <!-- ========== HOME PAGE ========== -->
    <div id="home-page" class="page active">
        <!-- Hero Section -->
        <section class="home-hero">
            <div class="container">
                <div class="hero-content">
                    <h1>ŸÖÿ≥ÿ™ÿ¥ŸÅŸâ ÿ∑ÿ® ÿßŸÑŸÇÿµÿ± ÿßŸÑÿπŸäŸÜŸä</h1>
                    <p>
                        ŸäŸèÿπÿØ ŸÖÿ≥ÿ™ÿ¥ŸÅŸâ ÿ∑ÿ® ÿßŸÑŸÇÿµÿ± ÿßŸÑÿπŸäŸÜŸä ÿ£ÿ≠ÿØ ÿ£ÿπÿ±ŸÇ ÿßŸÑÿµÿ±Ÿàÿ≠ ÿßŸÑÿ∑ÿ®Ÿäÿ© ŸÅŸä ŸÖÿµÿ± ŸàÿßŸÑÿ¥ÿ±ŸÇ ÿßŸÑÿ£Ÿàÿ≥ÿ∑ÿå
                        ÿ≠Ÿäÿ´ Ÿäÿ¨ŸÖÿπ ÿ®ŸäŸÜ ÿßŸÑÿÆÿ®ÿ±ÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ© ÿßŸÑÿπÿ±ŸäŸÇÿ© Ÿàÿ£ÿ≠ÿØÿ´ ÿßŸÑÿ™ŸÇŸÜŸäÿßÿ™ ÿßŸÑÿ≠ÿØŸäÿ´ÿ© ŸÅŸä ÿ™ŸÇÿØŸäŸÖ
                        ÿßŸÑÿ±ÿπÿßŸäÿ© ÿßŸÑÿµÿ≠Ÿäÿ©. ŸäŸáÿØŸÅ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿ¥ŸÅŸâ ÿ•ŸÑŸâ ÿ™ŸÜÿ∏ŸäŸÖ ÿßŸÑÿÆÿØŸÖÿßÿ™ ÿßŸÑÿ∑ÿ®Ÿäÿ©
                        Ÿàÿ™ÿ≥ŸáŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ Ÿàÿ™ÿ≠ÿ≥ŸäŸÜ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿßŸÑŸÖÿ±ÿ∂Ÿâ ŸàÿßŸÑÿ£ÿ∑ÿ®ÿßÿ°.
                    </p>
                    <div class="hero-buttons">
                        <a href="<?php echo APP_URL; ?>/public/index.php?page=login" id="home-login-btn" class="btn btn-primary">
                            ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÜÿ∏ÿßŸÖ
                        </a>
                        <a href="<?php echo APP_URL; ?>/public/index.php?page=register" id="home-signup-btn" class="btn btn-outline">
                            ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="section">
            <div class="container">
                <div class="section-title">
                    <h2>ŸÜÿ∏ÿßŸÖ ŸÖÿ™ŸÉÿßŸÖŸÑ ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ±ÿπÿßŸäÿ© ÿßŸÑÿµÿ≠Ÿäÿ©</h2>
                    <p>
                        ŸäŸàŸÅÿ± ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ŸÖÿ≥ÿ™ÿ¥ŸÅŸâ ÿ∑ÿ® ÿßŸÑŸÇÿµÿ± ÿßŸÑÿπŸäŸÜŸä ÿ≠ŸÑŸàŸÑŸãÿß ÿ±ŸÇŸÖŸäÿ© ŸÖÿ™ÿ∑Ÿàÿ±ÿ©
                        ÿ™ÿ≥ÿßÿπÿØ ŸÅŸä ÿ±ŸÅÿπ ŸÉŸÅÿßÿ°ÿ© ÿßŸÑÿπŸÖŸÑ ÿßŸÑÿ∑ÿ®Ÿä ŸàÿßŸÑÿ•ÿØÿßÿ±Ÿä.
                    </p>
                </div>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <h3>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿ∑ÿ®ÿßÿ°</h3>
                        <p>
                            ÿ•ÿØÿßÿ±ÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ∑ÿ®ÿßÿ°ÿå ÿßŸÑÿ™ÿÆÿµÿµÿßÿ™ÿå ŸàÿßŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑÿ≤ŸÖŸÜŸäÿ©
                            ŸÖŸÜ ÿÆŸÑÿßŸÑ Ÿàÿßÿ¨Ÿáÿ© ÿ≥ŸáŸÑÿ© ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <h3>ÿ≠ÿ¨ÿ≤ ÿßŸÑŸÖŸàÿßÿπŸäÿØ</h3>
                        <p>
                            ÿ™ŸÖŸÉŸäŸÜ ÿßŸÑŸÖÿ±ÿ∂Ÿâ ŸÖŸÜ ÿ≠ÿ¨ÿ≤ ÿßŸÑŸÖŸàÿßÿπŸäÿØÿå ÿ™ÿπÿØŸäŸÑŸáÿß ÿ£Ÿà ÿ•ŸÑÿ∫ÿßÿ¶Ÿáÿß
                            ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäŸãÿß ÿ®ŸÉŸÑ ÿ≥ŸáŸàŸÑÿ©.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <h3>ÿ™ŸÜÿ∏ŸäŸÖ ÿßŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑÿ∑ÿ®Ÿäÿ©</h3>
                        <p>
                            ÿ™ŸÜÿ≥ŸäŸÇ ŸÖŸàÿßÿπŸäÿØ ÿßŸÑÿ£ÿ∑ÿ®ÿßÿ° Ÿàÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™ ÿßŸÑÿ∑ÿ®Ÿäÿ©
                            ŸÑÿ∂ŸÖÿßŸÜ ÿ£ŸÅÿ∂ŸÑ ÿßÿ≥ÿ™ÿ∫ŸÑÿßŸÑ ŸÑŸÑŸàŸÇÿ™.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- User Roles Section -->
        <section class="section roles-section">
            <div class="container">
                <div class="section-title">
                    <h2>ÿ£ÿØŸàÿßÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</h2>
                    <p>
                        ÿ™ŸÖ ÿ™ÿµŸÖŸäŸÖ ÿßŸÑŸÜÿ∏ÿßŸÖ ŸÑŸäÿÆÿØŸÖ ÿ¨ŸÖŸäÿπ ÿ£ÿ∑ÿ±ÿßŸÅ ÿßŸÑŸÖŸÜÿ∏ŸàŸÖÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ©
                        ŸàŸÅŸÇŸãÿß ŸÑÿØŸàÿ± ŸÉŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ.
                    </p>
                </div>
                <div class="roles-grid">
                    <div class="role-card">
                        <div class="role-icon admin">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <h3>ÿßŸÑÿ•ÿØÿßÿ±ÿ©</h3>
                        <p>ÿ™ÿ≠ŸÉŸÖ ÿ¥ÿßŸÖŸÑ ŸÅŸä ÿßŸÑŸÜÿ∏ÿßŸÖ Ÿàÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸÖŸÑŸäÿßÿ™</p>
                        <ul>
                            <li>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿ∑ÿ®ÿßÿ° ŸàÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ</li>
                            <li>ŸÖÿ™ÿßÿ®ÿπÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿßÿπŸäÿØ</li>
                            <li>ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑÿ∑ÿ®Ÿäÿ© ŸàÿßŸÑÿ•ÿØÿßÿ±Ÿäÿ©</li>
                            <li>ÿ∂ÿ®ÿ∑ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ</li>
                        </ul>
                    </div>
                    <div class="role-card">
                        <div class="role-icon doctor">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <h3>ÿßŸÑÿ∑ÿ®Ÿäÿ®</h3>
                        <p>ÿ®Ÿäÿ¶ÿ© ÿ±ŸÇŸÖŸäÿ© ŸÖŸÜÿ∏ŸÖÿ© ŸÑÿØÿπŸÖ ÿßŸÑÿ±ÿπÿßŸäÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ©</p>
                        <ul>
                            <li>ÿßŸÑÿßÿ∑ŸÑÿßÿπ ÿπŸÑŸâ ÿ¨ÿØŸàŸÑ ÿßŸÑŸÖŸàÿßÿπŸäÿØ</li>
                            <li>ÿ•ÿØÿßÿ±ÿ© ÿ£ŸàŸÇÿßÿ™ ÿßŸÑÿ™Ÿàÿßÿ¨ÿØ</li>
                            <li>ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ∑ÿ®Ÿäÿ©</li>
                            <li>ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑÿ≠ÿßŸÑÿßÿ™ ÿßŸÑŸÖÿ±ÿ∂Ÿäÿ©</li>
                        </ul>
                    </div>
                    <div class="role-card">
                        <div class="role-icon patient">
                            <i class="fas fa-user-injured"></i>
                        </div>
                        <h3>ÿßŸÑŸÖÿ±Ÿäÿ∂</h3>
                        <p>ÿÆÿØŸÖÿßÿ™ ÿµÿ≠Ÿäÿ© ÿ≥ŸáŸÑÿ© Ÿàÿ≥ÿ±Ÿäÿπÿ©</p>
                        <ul>
                            <li>ÿ≠ÿ¨ÿ≤ ÿßŸÑŸÖŸàÿßÿπŸäÿØ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäŸãÿß</li>
                            <li>ÿßÿ≥ÿ™ÿπÿ±ÿßÿ∂ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ∑ÿ®ÿßÿ°</li>
                            <li>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿßÿπŸäÿØ</li>
                            <li>ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ∑ÿ®Ÿäÿ©</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="section cta-section">
            <div class="container">
                <h2>ŸÜÿ≠Ÿà ŸÖÿ≥ÿ™ŸÇÿ®ŸÑ ÿ±ŸÇŸÖŸä ŸÑŸÑÿ±ÿπÿßŸäÿ© ÿßŸÑÿµÿ≠Ÿäÿ©</h2>
                <p>
                    ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸâ ŸÖŸÜÿ∏ŸàŸÖÿ© ÿ∑ÿ® ÿßŸÑŸÇÿµÿ± ÿßŸÑÿπŸäŸÜŸä ÿßŸÑÿ±ŸÇŸÖŸäÿ©ÿå ÿ≠Ÿäÿ´ ÿ™ŸÑÿ™ŸÇŸä
                    ÿßŸÑÿÆÿ®ÿ±ÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ© ÿ®ÿßŸÑÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ÿßŸÑÿ≠ÿØŸäÿ´ÿ© ŸÑÿ™ŸÇÿØŸäŸÖ ÿ£ŸÅÿ∂ŸÑ
                    ŸÖÿ≥ÿ™ŸàŸâ ŸÖŸÜ ÿßŸÑÿ±ÿπÿßŸäÿ© ÿßŸÑÿµÿ≠Ÿäÿ©.
                </p>
                <div class="hero-buttons">
                    <a href="<?php echo APP_URL; ?>/public/index.php?page=login" id="cta-login-btn" class="btn btn-primary">
                        ÿßÿ®ÿØÿ£ ÿßŸÑÿ¢ŸÜ
                    </a>
                    <a href="#" id="cta-learn-more" class="btn btn-outline" style="border-color: var(--white); color: var(--white);">
                        ÿ™ÿπÿ±ŸëŸÅ ÿ£ŸÉÿ´ÿ± ÿπŸÑŸâ ÿßŸÑŸÜÿ∏ÿßŸÖ
                    </a>
                </div>
            </div>
        </section>
    </div>
</main>

<?php include __DIR__ . '/layouts/footer.php'; ?>

================================================================================
FILE: views/receptionist/patients.php
================================================================================

<?php
$pageTitle = 'Manage Patients - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Patient Management</h2>
        <button type="button" class="btn btn-primary" onclick="showAddPatientModal()">
            <i class="fas fa-user-plus"></i> Add New Patient
        </button>
    </div>
    
    <!-- Success/Error Messages -->
    <?php if (isset($_SESSION['success_message'])): ?>
    <div class="alert alert-success">
        <i class="fas fa-check-circle"></i> <?php echo htmlspecialchars($_SESSION['success_message']); ?>
        <?php unset($_SESSION['success_message']); ?>
    </div>
    <?php endif; ?>
    
    <?php if (isset($_SESSION['error_message'])): ?>
    <div class="alert alert-danger">
        <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($_SESSION['error_message']); ?>
        <?php unset($_SESSION['error_message']); ?>
    </div>
    <?php endif; ?>
    
    <!-- Filter Form -->
    <div class="filter-container">
        <form method="GET" action="" class="form-row">
            <input type="hidden" name="page" value="receptionist-patients">
            
            <div class="form-group" style="flex: 2;">
                <label>Search Patients</label>
                <input type="text" class="form-control" name="search" placeholder="Search by name, email, or phone..." 
                       value="<?php echo htmlspecialchars($filters['search'] ?? ''); ?>">
            </div>
            
            <div class="form-group">
                <label>Status</label>
                <select class="form-control" name="status">
                    <option value="">All Status</option>
                    <option value="active" <?php echo ($filters['status'] ?? '') == 'active' ? 'selected' : ''; ?>>Active</option>
                    <option value="inactive" <?php echo ($filters['status'] ?? '') == 'inactive' ? 'selected' : ''; ?>>Inactive</option>
                </select>
            </div>
            
            <div class="form-group" style="margin-top: 24px;">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="?page=receptionist-patients" class="btn btn-outline">Reset</a>
            </div>
        </form>
    </div>
    
    <!-- Patients Table -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Gender</th>
                    <th>Status</th>
                    <th>Registered</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php if (empty($patients)): ?>
                <tr>
                    <td colspan="8" style="text-align: center; padding: 20px;">No patients found.</td>
                </tr>
                <?php else: ?>
                <?php foreach ($patients as $patient): 
                    // Get patient details
                    $db = \Core\Database::getInstance();
                    $patientDetails = $db->query("
                        SELECT gender, date_of_birth, address 
                        FROM patient_details 
                        WHERE user_id = ?
                    ", [$patient['id']])[0] ?? [];
                ?>
                <tr>
                    <td>#<?php echo $patient['id']; ?></td>
                    <td>
                        <strong><?php echo htmlspecialchars($patient['name']); ?></strong>
                    </td>
                    <td><?php echo htmlspecialchars($patient['email']); ?></td>
                    <td><?php echo htmlspecialchars($patient['phone'] ?? 'N/A'); ?></td>
                    <td><?php echo htmlspecialchars($patientDetails['gender'] ?? 'N/A'); ?></td>
                    <td>
                        <span class="status <?php echo $patient['status'] == 'active' ? 'confirmed' : 'cancelled'; ?>">
                            <?php echo ucfirst($patient['status']); ?>
                        </span>
                    </td>
                    <td><?php echo date('M d, Y', strtotime($patient['created_at'])); ?></td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <a href="?page=receptionist-book-for-patient&patient_id=<?php echo $patient['id']; ?>" 
                               class="btn btn-sm btn-primary" title="Book Appointment">
                                <i class="fas fa-calendar-plus"></i>
                            </a>
                            <button type="button" class="btn btn-sm btn-outline" 
                                    onclick="viewPatientDetails(<?php echo $patient['id']; ?>)"
                                    title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <a href="?page=receptionist-edit-patient&id=<?php echo $patient['id']; ?>" 
                               class="btn btn-sm btn-outline" title="Edit">
                                <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>
</div>

<!-- Add Patient Modal -->
<div id="addPatientModal" class="modal-overlay" style="display: none;">
    <div class="modal" style="max-width: 700px;">
        <div class="modal-header">
            <h3>Register New Patient</h3>
            <button type="button" class="close-modal" onclick="closeAddPatientModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form action="?page=receptionist-patients" method="POST">
                <h4>Personal Information</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Full Name *</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address *</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input type="tel" class="form-control" id="phone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="gender">Gender *</label>
                        <select class="form-control" id="gender" name="gender" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="date_of_birth">Date of Birth *</label>
                        <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" required 
                               max="<?php echo date('Y-m-d'); ?>">
                    </div>
                    <div class="form-group">
                        <label for="address">Address</label>
                        <textarea class="form-control" id="address" name="address" rows="2"></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="form-check">
                        <input type="checkbox" id="send_welcome" name="send_welcome" checked>
                        <label for="send_welcome">Send welcome email with login details</label>
                    </div>
                    <small class="text-muted">
                        Default password: patient123<br>
                        Patient can change password after first login
                    </small>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeAddPatientModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Register Patient</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Patient Details Modal -->
<div id="patientDetailsModal" class="modal-overlay" style="display: none;">
    <div class="modal" style="max-width: 800px;">
        <div class="modal-header">
            <h3>Patient Details</h3>
            <button type="button" class="close-modal" onclick="closePatientDetailsModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="patientDetailsContent">
                <!-- Content will be loaded via AJAX -->
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p>Loading patient details...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showAddPatientModal() {
    document.getElementById('addPatientModal').style.display = 'flex';
}

function closeAddPatientModal() {
    document.getElementById('addPatientModal').style.display = 'none';
}

function viewPatientDetails(patientId) {
    document.getElementById('patientDetailsModal').style.display = 'flex';
    
    // Load patient details via AJAX
    const xhr = new XMLHttpRequest();
    xhr.open('GET', `ajax/get_patient_details.php?patient_id=${patientId}`, true);
    xhr.onload = function() {
        if (xhr.status === 200) {
            document.getElementById('patientDetailsContent').innerHTML = xhr.responseText;
        } else {
            document.getElementById('patientDetailsContent').innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle"></i> Failed to load patient details.
                </div>
            `;
        }
    };
    xhr.send();
}

function closePatientDetailsModal() {
    document.getElementById('patientDetailsModal').style.display = 'none';
}

// Close modals when clicking outside
document.querySelectorAll('.modal-overlay').forEach(modal => {
    modal.addEventListener('click', function(e) {
        if (e.target === this) {
            if (this.id === 'addPatientModal') closeAddPatientModal();
            if (this.id === 'patientDetailsModal') closePatientDetailsModal();
        }
    });
});

// Initialize date of birth max to today
document.getElementById('date_of_birth').max = new Date().toISOString().split('T')[0];

// Add age calculator
document.getElementById('date_of_birth').addEventListener('change', function() {
    const dob = new Date(this.value);
    const today = new Date();
    let age = today.getFullYear() - dob.getFullYear();
    const monthDiff = today.getMonth() - dob.getMonth();
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
        age--;
    }
    document.getElementById('age_display').innerText = `Age: ${age} years`;
});
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/receptionist/dashboard.php
================================================================================

<?php
$pageTitle = 'Receptionist Dashboard - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Receptionist Dashboard</h2>
        <p>Welcome back, <?php echo $_SESSION['user_name']; ?>. Manage patients and appointments.</p>
    </div>
    
    <!-- Success/Error Messages -->
    <?php if (isset($_SESSION['success_message'])): ?>
    <div class="alert alert-success" style="padding: 15px; margin-bottom: 20px; background-color: #d4edda; color: #155724; border-radius: 5px;">
        <i class="fas fa-check-circle"></i> <?php echo htmlspecialchars($_SESSION['success_message']); ?>
        <?php unset($_SESSION['success_message']); ?>
    </div>
    <?php endif; ?>
    
    <?php if (isset($_SESSION['error_message'])): ?>
    <div class="alert alert-danger" style="padding: 15px; margin-bottom: 20px; background-color: #f8d7da; color: #721c24; border-radius: 5px;">
        <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($_SESSION['error_message']); ?>
        <?php unset($_SESSION['error_message']); ?>
    </div>
    <?php endif; ?>
    
    <!-- Statistics Cards -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--primary-color);">
                <i class="fas fa-calendar-day"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['today_appointments']; ?></h3>
                <p>Today's Appointments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--secondary-color);">
                <i class="fas fa-user-injured"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['total_patients']; ?></h3>
                <p>Total Patients</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--warning-color);">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['pending_appointments']; ?></h3>
                <p>Pending Appointments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--success-color);">
                <i class="fas fa-user-md"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['available_doctors']; ?></h3>
                <p>Available Doctors</p>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div style="background-color: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 30px;">
        <h3>Quick Actions</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
            <a href="?page=receptionist-appointments" class="btn btn-primary" style="text-align: center; padding: 15px;">
                <i class="fas fa-calendar-plus fa-2x"></i><br>
                <span>Book Appointment</span>
            </a>
            <a href="?page=receptionist-patients" class="btn btn-secondary" style="text-align: center; padding: 15px;">
                <i class="fas fa-user-plus fa-2x"></i><br>
                <span>Register Patient</span>
            </a>
            <a href="?page=receptionist-doctors" class="btn btn-success" style="text-align: center; padding: 15px;">
                <i class="fas fa-user-md fa-2x"></i><br>
                <span>View Doctors</span>
            </a>
            <a href="#" class="btn btn-warning" style="text-align: center; padding: 15px;" onclick="showQuickAppointmentModal()">
                <i class="fas fa-bolt fa-2x"></i><br>
                <span>Quick Book</span>
            </a>
        </div>
    </div>
    
    <!-- Today's Appointments -->
    <div class="page-header">
        <h3>Today's Appointments</h3>
        <a href="?page=receptionist-appointments" class="btn btn-outline">
            <i class="fas fa-eye"></i> View All
        </a>
    </div>
    
    <?php if (empty($todayAppointments)): ?>
    <div class="alert" style="background-color: var(--primary-light); padding: 20px; border-radius: var(--border-radius);">
        <p style="margin: 0;">No appointments scheduled for today.</p>
    </div>
    <?php else: ?>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Patient</th>
                    <th>Doctor</th>
                    <th>Specialization</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($todayAppointments as $appointment): ?>
                <tr>
                    <td><strong><?php echo $appointment['formatted_time']; ?></strong></td>
                    <td>
                        <strong><?php echo htmlspecialchars($appointment['patient_name']); ?></strong><br>
                        <small><?php echo htmlspecialchars($appointment['patient_phone'] ?? 'N/A'); ?></small>
                    </td>
                    <td>
                        <strong>Dr. <?php echo htmlspecialchars($appointment['doctor_name']); ?></strong><br>
                        <small><?php echo htmlspecialchars($appointment['doctor_specialization']); ?></small>
                    </td>
                    <td><?php echo htmlspecialchars($appointment['doctor_specialization']); ?></td>
                    <td>
                        <span class="status <?php echo strtolower($appointment['status']); ?>">
                            <?php echo ucfirst($appointment['status']); ?>
                        </span>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <form action="?page=update-appointment-status" method="POST" style="display: inline;">
                                <input type="hidden" name="appointment_id" value="<?php echo $appointment['id']; ?>">
                                <select name="status" class="form-control" style="width: auto; padding: 5px; font-size: 0.9rem;" 
                                        onchange="if(confirm('Change appointment status?')) this.form.submit()">
                                    <option value="pending" <?php echo $appointment['status'] == 'pending' ? 'selected' : ''; ?>>Pending</option>
                                    <option value="confirmed" <?php echo $appointment['status'] == 'confirmed' ? 'selected' : ''; ?>>Confirmed</option>
                                    <option value="completed" <?php echo $appointment['status'] == 'completed' ? 'selected' : ''; ?>>Completed</option>
                                    <option value="cancelled" <?php echo $appointment['status'] == 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                                </select>
                            </form>
                            <a href="?page=receptionist-edit-appointment&id=<?php echo $appointment['id']; ?>" class="btn btn-sm btn-outline" title="Edit">
                                <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
    <?php endif; ?>
    
    <!-- Recent Patients -->
    <?php if (!empty($recentPatients)): ?>
    <div class="page-header" style="margin-top: 40px;">
        <h3>Recent Patients</h3>
        <a href="?page=receptionist-patients" class="btn btn-outline">
            <i class="fas fa-users"></i> View All Patients
        </a>
    </div>
    
    <div class="cards-container">
        <?php foreach ($recentPatients as $patient): ?>
        <div class="card">
            <div class="card-body">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div style="width: 50px; height: 50px; border-radius: 50%; background-color: var(--secondary-light); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user-injured"></i>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 5px;"><?php echo htmlspecialchars($patient['name']); ?></h4>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 0;">
                            <?php echo htmlspecialchars($patient['email']); ?>
                        </p>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span class="status confirmed" style="font-size: 0.8rem;">
                        <?php echo ucfirst($patient['status']); ?>
                    </span>
                    <a href="?page=receptionist-book-for-patient&patient_id=<?php echo $patient['id']; ?>" 
                       class="btn btn-sm btn-primary" title="Book Appointment">
                        <i class="fas fa-calendar-plus"></i> Book
                    </a>
                </div>
            </div>
        </div>
        <?php endforeach; ?>
    </div>
    <?php endif; ?>
</div>

<!-- Quick Appointment Modal -->
<div id="quickAppointmentModal" class="modal-overlay" style="display: none;">
    <div class="modal" style="max-width: 600px;">
        <div class="modal-header">
            <h3>Quick Appointment Booking</h3>
            <button type="button" class="close-modal" onclick="closeQuickModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="quickAppointmentForm" action="?page=receptionist-appointments" method="POST">
                <input type="hidden" name="add_appointment" value="1">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="quick_patient">Select Patient *</label>
                        <select class="form-control" id="quick_patient" name="patient_id" required>
                            <option value="">Select Patient</option>
                            <?php 
                            $db = \Core\Database::getInstance();
                            $allPatients = $db->query("SELECT id, name FROM users WHERE role = 'patient' AND status = 'active' ORDER BY name");
                            foreach ($allPatients as $patient): ?>
                            <option value="<?php echo $patient['id']; ?>">
                                <?php echo htmlspecialchars($patient['name']); ?>
                            </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="quick_doctor">Select Doctor *</label>
                        <select class="form-control" id="quick_doctor" name="doctor_id" required>
                            <option value="">Select Doctor</option>
                            <?php 
                            $allDoctors = $db->query("SELECT id, name, specialization FROM users WHERE role = 'doctor' AND status = 'active' ORDER BY name");
                            foreach ($allDoctors as $doctor): ?>
                            <option value="<?php echo $doctor['id']; ?>">
                                Dr. <?php echo htmlspecialchars($doctor['name']); ?> - <?php echo htmlspecialchars($doctor['specialization']); ?>
                            </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="quick_date">Date *</label>
                        <input type="date" class="form-control" id="quick_date" name="date" required 
                               min="<?php echo date('Y-m-d'); ?>">
                    </div>
                    <div class="form-group">
                        <label for="quick_time">Time *</label>
                        <input type="time" class="form-control" id="quick_time" name="time" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="quick_reason">Reason</label>
                    <textarea class="form-control" id="quick_reason" name="reason" rows="2" 
                              placeholder="Brief reason for appointment"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="quick_status">Status</label>
                    <select class="form-control" id="quick_status" name="status">
                        <option value="pending">Pending</option>
                        <option value="confirmed" selected>Confirmed</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeQuickModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Book Appointment</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function showQuickAppointmentModal() {
    // Set default date to today
    document.getElementById('quick_date').valueAsDate = new Date();
    
    // Set default time to next hour
    const now = new Date();
    const nextHour = new Date(now.getTime() + 60 * 60 * 1000);
    document.getElementById('quick_time').value = nextHour.toTimeString().substring(0, 5);
    
    document.getElementById('quickAppointmentModal').style.display = 'flex';
}

function closeQuickModal() {
    document.getElementById('quickAppointmentModal').style.display = 'none';
    document.getElementById('quickAppointmentForm').reset();
}

// Close modal when clicking outside
document.getElementById('quickAppointmentModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeQuickModal();
    }
});

// Auto-refresh dashboard every 2 minutes
setTimeout(function() {
    location.reload();
}, 2 * 60 * 1000);
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/receptionist/appointments.php
================================================================================

<?php
$pageTitle = 'Manage Appointments - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Appointment Management</h2>
        <button type="button" class="btn btn-primary" onclick="showAddAppointmentModal()">
            <i class="fas fa-calendar-plus"></i> Book New Appointment
        </button>
    </div>
    
    <!-- Success/Error Messages -->
    <?php if (isset($_SESSION['success_message'])): ?>
    <div class="alert alert-success">
        <i class="fas fa-check-circle"></i> <?php echo htmlspecialchars($_SESSION['success_message']); ?>
        <?php unset($_SESSION['success_message']); ?>
    </div>
    <?php endif; ?>
    
    <?php if (isset($_SESSION['error_message'])): ?>
    <div class="alert alert-danger">
        <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($_SESSION['error_message']); ?>
        <?php unset($_SESSION['error_message']); ?>
    </div>
    <?php endif; ?>
    
    <!-- Appointment Statistics -->
    <?php 
    $db = \Core\Database::getInstance();
    $appointmentStats = $db->query("
        SELECT 
            COUNT(*) as total,
            SUM(CASE WHEN status = 'pending' THEN 1 ELSE 0 END) as pending,
            SUM(CASE WHEN status = 'confirmed' THEN 1 ELSE 0 END) as confirmed,
            SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completed,
            SUM(CASE WHEN status = 'cancelled' THEN 1 ELSE 0 END) as cancelled
        FROM appointments
    ")[0] ?? [];
    ?>
    
    <div class="stats-cards" style="margin-bottom: 30px;">
        <div class="stat-card">
            <div class="stat-info">
                <h3><?php echo $appointmentStats['total'] ?? 0; ?></h3>
                <p>Total Appointments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <h3><?php echo $appointmentStats['pending'] ?? 0; ?></h3>
                <p>Pending</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <h3><?php echo $appointmentStats['confirmed'] ?? 0; ?></h3>
                <p>Confirmed</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <h3><?php echo $appointmentStats['completed'] ?? 0; ?></h3>
                <p>Completed</p>
            </div>
        </div>
    </div>
    
    <!-- Filter Form -->
    <div class="filter-container">
        <form method="GET" action="" class="form-row">
            <input type="hidden" name="page" value="receptionist-appointments">
            
            <div class="form-group" style="flex: 1;">
                <label>Date</label>
                <input type="date" class="form-control" name="date" 
                       value="<?php echo htmlspecialchars($filters['date'] ?? ''); ?>">
            </div>
            
            <div class="form-group" style="flex: 1;">
                <label>Status</label>
                <select class="form-control" name="status">
                    <option value="">All Status</option>
                    <option value="pending" <?php echo ($filters['status'] ?? '') == 'pending' ? 'selected' : ''; ?>>Pending</option>
                    <option value="confirmed" <?php echo ($filters['status'] ?? '') == 'confirmed' ? 'selected' : ''; ?>>Confirmed</option>
                    <option value="completed" <?php echo ($filters['status'] ?? '') == 'completed' ? 'selected' : ''; ?>>Completed</option>
                    <option value="cancelled" <?php echo ($filters['status'] ?? '') == 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                </select>
            </div>
            
            <div class="form-group" style="flex: 1;">
                <label>Doctor</label>
                <select class="form-control" name="doctor_id">
                    <option value="">All Doctors</option>
                    <?php foreach ($doctors as $doctor): ?>
                    <option value="<?php echo $doctor['id']; ?>" 
                        <?php echo ($filters['doctor_id'] ?? '') == $doctor['id'] ? 'selected' : ''; ?>>
                        Dr. <?php echo htmlspecialchars($doctor['name']); ?>
                    </option>
                    <?php endforeach; ?>
                </select>
            </div>
            
            <div class="form-group" style="flex: 1;">
                <label>Patient</label>
                <select class="form-control" name="patient_id">
                    <option value="">All Patients</option>
                    <?php foreach ($patients as $patient): ?>
                    <option value="<?php echo $patient['id']; ?>" 
                        <?php echo ($filters['patient_id'] ?? '') == $patient['id'] ? 'selected' : ''; ?>>
                        <?php echo htmlspecialchars($patient['name']); ?>
                    </option>
                    <?php endforeach; ?>
                </select>
            </div>
            
            <div class="form-group" style="margin-top: 24px;">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="?page=receptionist-appointments" class="btn btn-outline">Reset</a>
            </div>
        </form>
    </div>
    
    <!-- Appointments Table -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Patient</th>
                    <th>Doctor</th>
                    <th>Date & Time</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php if (empty($appointments)): ?>
                <tr>
                    <td colspan="8" style="text-align: center; padding: 20px;">No appointments found.</td>
                </tr>
                <?php else: ?>
                <?php foreach ($appointments as $appointment): ?>
                <tr>
                    <td>#<?php echo $appointment['id']; ?></td>
                    <td>
                        <strong><?php echo htmlspecialchars($appointment['patient_name']); ?></strong><br>
                        <small><?php echo htmlspecialchars($appointment['patient_phone'] ?? 'N/A'); ?></small>
                    </td>
                    <td>
                        <strong>Dr. <?php echo htmlspecialchars($appointment['doctor_name']); ?></strong><br>
                        <small><?php echo htmlspecialchars($appointment['doctor_specialization']); ?></small>
                    </td>
                    <td>
                        <strong><?php echo $appointment['formatted_date']; ?></strong><br>
                        <small><?php echo $appointment['formatted_time']; ?></small>
                    </td>
                    <td><?php echo htmlspecialchars($appointment['reason']); ?></td>
                    <td>
                        <span class="status <?php echo strtolower($appointment['status']); ?>">
                            <?php echo ucfirst($appointment['status']); ?>
                        </span>
                    </td>
                    <td><?php echo date('M d, Y', strtotime($appointment['created_at'])); ?></td>
                    <td>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            <!-- Status Update Form -->
                            <form action="?page=receptionist-appointments" method="POST" style="display: inline;">
                                <input type="hidden" name="update_appointment" value="1">
                                <input type="hidden" name="appointment_id" value="<?php echo $appointment['id']; ?>">
                                <select name="status" class="form-control" style="width: auto; padding: 5px; font-size: 0.9rem;" 
                                        onchange="if(confirm('Change appointment status?')) this.form.submit()">
                                    <option value="pending" <?php echo $appointment['status'] == 'pending' ? 'selected' : ''; ?>>Pending</option>
                                    <option value="confirmed" <?php echo $appointment['status'] == 'confirmed' ? 'selected' : ''; ?>>Confirmed</option>
                                    <option value="completed" <?php echo $appointment['status'] == 'completed' ? 'selected' : ''; ?>>Completed</option>
                                    <option value="cancelled" <?php echo $appointment['status'] == 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                                </select>
                            </form>
                            
                            <a href="?page=receptionist-edit-appointment&id=<?php echo $appointment['id']; ?>" 
                               class="btn btn-sm btn-outline" title="Edit">
                                <i class="fas fa-edit"></i>
                            </a>
                            
                            <a href="?page=receptionist-cancel-appointment&id=<?php echo $appointment['id']; ?>" 
                               class="btn btn-sm btn-danger" 
                               onclick="return confirm('Are you sure you want to cancel this appointment?')"
                               title="Cancel">
                                <i class="fas fa-times"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>
</div>

<!-- Add Appointment Modal -->
<div id="addAppointmentModal" class="modal-overlay" style="display: none;">
    <div class="modal" style="max-width: 700px;">
        <div class="modal-header">
            <h3>Book New Appointment</h3>
            <button type="button" class="close-modal" onclick="closeAddAppointmentModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form action="?page=receptionist-appointments" method="POST">
                <input type="hidden" name="add_appointment" value="1">
                
                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label for="patient_id">Select Patient *</label>
                        <select class="form-control" id="patient_id" name="patient_id" required>
                            <option value="">Select Patient</option>
                            <?php foreach ($patients as $patient): ?>
                            <option value="<?php echo $patient['id']; ?>">
                                <?php echo htmlspecialchars($patient['name']); ?> - <?php echo htmlspecialchars($patient['phone'] ?? ''); ?>
                            </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="doctor_id">Select Doctor *</label>
                        <select class="form-control" id="doctor_id" name="doctor_id" required>
                            <option value="">Select Doctor</option>
                            <?php foreach ($doctors as $doctor): ?>
                            <option value="<?php echo $doctor['id']; ?>">
                                Dr. <?php echo htmlspecialchars($doctor['name']); ?> - <?php echo htmlspecialchars($doctor['specialization']); ?>
                            </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="date">Appointment Date *</label>
                        <input type="date" class="form-control" id="date" name="date" required 
                               min="<?php echo date('Y-m-d'); ?>">
                    </div>
                    <div class="form-group">
                        <label for="time">Appointment Time *</label>
                        <input type="time" class="form-control" id="time" name="time" required 
                               min="09:00" max="17:00" step="900"> <!-- 15 minute intervals -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="reason">Reason for Visit *</label>
                    <textarea class="form-control" id="reason" name="reason" rows="3" required 
                              placeholder="Please describe the reason for the appointment..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="status">Appointment Status</label>
                    <select class="form-control" id="status" name="status">
                        <option value="pending">Pending</option>
                        <option value="confirmed" selected>Confirmed</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <div class="form-check">
                        <input type="checkbox" id="send_notification" name="send_notification" checked>
                        <label for="send_notification">Send notification to patient</label>
                    </div>
                    <small class="text-muted">
                        Patient will receive an email/SMS notification about the appointment
                    </small>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeAddAppointmentModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Book Appointment</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function showAddAppointmentModal() {
    // Set default date to today
    document.getElementById('date').valueAsDate = new Date();
    
    // Set default time to next hour
    const now = new Date();
    const nextHour = new Date(now.getTime() + 60 * 60 * 1000);
    let hours = nextHour.getHours().toString().padStart(2, '0');
    let minutes = Math.ceil(nextHour.getMinutes() / 15) * 15;
    if (minutes === 60) {
        hours = (parseInt(hours) + 1).toString().padStart(2, '0');
        minutes = '00';
    } else {
        minutes = minutes.toString().padStart(2, '0');
    }
    document.getElementById('time').value = `${hours}:${minutes}`;
    
    document.getElementById('addAppointmentModal').style.display = 'flex';
}

function closeAddAppointmentModal() {
    document.getElementById('addAppointmentModal').style.display = 'none';
    document.getElementById('patient_id').selectedIndex = 0;
    document.getElementById('doctor_id').selectedIndex = 0;
}

// Close modal when clicking outside
document.getElementById('addAppointmentModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeAddAppointmentModal();
    }
});

// Check doctor availability when date/time changes
document.getElementById('date').addEventListener('change', checkAvailability);
document.getElementById('time').addEventListener('change', checkAvailability);
document.getElementById('doctor_id').addEventListener('change', checkAvailability);

async function checkAvailability() {
    const doctorId = document.getElementById('doctor_id').value;
    const date = document.getElementById('date').value;
    const time = document.getElementById('time').value;
    
    if (!doctorId || !date || !time) return;
    
    try {
        const response = await fetch(`ajax/check_availability.php?doctor_id=${doctorId}&date=${date}&time=${time}`);
        const data = await response.json();
        
        if (data.available === false) {
            alert('This time slot is already booked. Please choose a different time.');
            document.getElementById('time').focus();
        }
    } catch (error) {
        console.error('Error checking availability:', error);
    }
}

// Initialize date picker with today as minimum
document.querySelector('input[name="date"]').min = new Date().toISOString().split('T')[0];
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/auth/login.php
================================================================================

<?php
$pageTitle = 'Login - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';

// Get error from session if it exists
$error = $_SESSION['login_error'] ?? ($error ?? '');
unset($_SESSION['login_error']);
?>

<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h2>Welcome to Kasr Al Ainy</h2>
            <p>Please login to continue</p>
        </div>
        <div class="auth-body">
            <?php if (!empty($error)): ?>
            <div class="error-message active" id="error-message">
                <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($error); ?>
            </div>
            <?php endif; ?>
            
            <form action="<?php echo APP_URL; ?>/public/index.php?page=login" method="POST" id="login-form">
                <div class="form-group">
                    <label for="login-email">Email Address</label>
                    <input type="email" id="login-email" name="email" class="form-control" 
                           placeholder="Enter your email" required 
                           value="<?php echo isset($_POST['email']) ? htmlspecialchars($_POST['email']) : ''; ?>">
                </div>
                
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" name="password" 
                           class="form-control" placeholder="Enter your password" required>
                </div>
                
                <!-- <div class="form-group">
                    <label>Select Role</label>
                    <div class="role-selector">
                        <div class="role-option <?php echo (($_POST['role'] ?? 'admin') === 'admin') ? 'active' : ''; ?>" 
                             data-role="admin">Admin</div>
                        <div class="role-option <?php echo (($_POST['role'] ?? '') === 'doctor') ? 'active' : ''; ?>" 
                             data-role="doctor">Doctor</div>
                        <div class="role-option <?php echo (($_POST['role'] ?? '') === 'receptionist') ? 'active' : ''; ?>" 
                             data-role="receptionist">Receptionist</div>
                        <div class="role-option <?php echo (($_POST['role'] ?? 'patient') === 'patient') ? 'active' : ''; ?>" 
                             data-role="patient">Patient</div>
                    </div>
                    <input type="hidden" name="role" id="selected-role" 
                           value="<?php echo $_POST['role'] ?? 'admin'; ?>">
                </div> -->
                
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
            
            <div class="auth-switch">
                <p>Don't have an account? <a href="<?php echo APP_URL; ?>/public/index.php?page=register">Register as Patient</a></p>
                <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    <i class="fas fa-info-circle"></i> Demo credentials are provided above
                </p>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const roleOptions = document.querySelectorAll('.role-option');
    const roleInput = document.getElementById('selected-role');
    
    roleOptions.forEach(option => {
        option.addEventListener('click', function() {
            roleOptions.forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
            roleInput.value = this.getAttribute('data-role');
        });
    });
    
    // Auto-hide error after 5 seconds
    const errorMsg = document.getElementById('error-message');
    if (errorMsg) {
        setTimeout(() => {
            errorMsg.style.opacity = '0';
            setTimeout(() => errorMsg.remove(), 500);
        }, 5000);
    }
    
    // Form submission feedback
    const form = document.getElementById('login-form');
    form.addEventListener('submit', function(e) {
        const submitBtn = this.querySelector('button[type="submit"]');
        if (submitBtn) {
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
            submitBtn.disabled = true;
            
            // Re-enable after 5 seconds if page doesn't redirect
            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 5000);
        }
    });
});
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/auth/register.php
================================================================================

<?php
$pageTitle = 'Register - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h2>Create Patient Account</h2>
            <p>Register to access healthcare services</p>
        </div>
        <div class="auth-body">
            <?php if (isset($error) && $error): ?>
            <div class="error-message active">
                <?php echo $error; ?>
            </div>
            <?php endif; ?>
            
            <?php if (isset($success) && $success): ?>
            <div class="success-message active">
                <?php echo $success; ?>
            </div>
            <?php endif; ?>
            
            <form action="<?php echo APP_URL; ?>/public/index.php?page=register" method="POST" id="signup-form">
                <div class="form-group">
                    <label for="signup-name">Full Name *</label>
                    <input type="text" id="signup-name" name="name" class="form-control" 
                           placeholder="Enter your full name" required 
                           value="<?php echo htmlspecialchars($_POST['name'] ?? ''); ?>">
                </div>
                
                <div class="form-group">
                    <label for="signup-email">Email Address *</label>
                    <input type="email" id="signup-email" name="email" class="form-control" 
                           placeholder="Enter your email address" required 
                           value="<?php echo htmlspecialchars($_POST['email'] ?? ''); ?>">
                </div>
                
                <div class="form-group">
                    <label for="signup-phone">Phone Number *</label>
                    <input type="tel" id="signup-phone" name="phone" class="form-control" 
                           placeholder="Enter your phone number" required 
                           value="<?php echo htmlspecialchars($_POST['phone'] ?? ''); ?>">
                </div>
                
                <div class="form-group">
                    <label for="signup-password">Password *</label>
                    <input type="password" id="signup-password" name="password" class="form-control" 
                           placeholder="Create a password (min. 6 characters)" required>
                    <small style="color: var(--text-light); display: block; margin-top: 5px;">
                        Password must be at least 6 characters long
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="signup-confirm-password">Confirm Password *</label>
                    <input type="password" id="signup-confirm-password" name="confirm_password" 
                           class="form-control" placeholder="Confirm your password" required>
                </div>
                
                <div class="form-check">
                    <input type="checkbox" id="signup-terms" name="terms" required>
                    <label for="signup-terms">
                        I agree to the <a href="#" id="terms-link">Terms & Conditions</a> and 
                        <a href="#" id="privacy-link">Privacy Policy</a> *
                    </label>
                </div>
                
                <div style="background-color: var(--primary-light); padding: 15px; border-radius: var(--border-radius-sm); margin-bottom: 20px;">
                    <p style="font-size: 0.9rem; margin-bottom: 0; color: var(--primary-dark);">
                        <i class="fas fa-info-circle"></i> 
                        Note: Registration is for <strong>Patient accounts only</strong>. 
                        Doctor and Admin accounts are created by hospital administration.
                    </p>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
            </form>
            
            <div class="auth-switch">
                <p>Already have an account? <a href="<?php echo APP_URL; ?>/public/index.php?page=login">Log In</a></p>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('terms-link').addEventListener('click', function(e) {
    e.preventDefault();
    alert('Terms & Conditions: By creating an account, you agree to our hospital policies and data protection guidelines.');
});

document.getElementById('privacy-link').addEventListener('click', function(e) {
    e.preventDefault();
    alert('Privacy Policy: Your personal information is protected and will only be used for healthcare purposes.');
});

document.getElementById('signup-form').addEventListener('submit', function(e) {
    const password = document.getElementById('signup-password').value;
    const confirmPassword = document.getElementById('signup-confirm-password').value;
    
    if (password.length < 6) {
        e.preventDefault();
        alert('Password must be at least 6 characters long');
        return false;
    }
    
    if (password !== confirmPassword) {
        e.preventDefault();
        alert('Passwords do not match');
        return false;
    }
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
        submitBtn.disabled = true;
    }
});
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/auth/logout.php
================================================================================

<?php
session_start();
session_destroy();
header('Location: ' . APP_URL . '/public/index.php?page=login');
exit();
?>

================================================================================
FILE: views/doctor/dashboard.php
================================================================================

<?php
$pageTitle = 'Doctor Dashboard - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Doctor Dashboard</h2>
        <p>Welcome back, Dr. <?php echo $_SESSION['user_name']; ?>. Here's your schedule for today.</p>
    </div>
    
    <!-- Success/Error Messages -->
    <?php if (isset($_SESSION['success_message'])): ?>
    <div class="alert alert-success" style="padding: 15px; margin-bottom: 20px; background-color: #d4edda; color: #155724; border-radius: 5px;">
        <i class="fas fa-check-circle"></i> <?php echo htmlspecialchars($_SESSION['success_message']); ?>
        <?php unset($_SESSION['success_message']); ?>
    </div>
    <?php endif; ?>
    
    <?php if (isset($_SESSION['error_message'])): ?>
    <div class="alert alert-danger" style="padding: 15px; margin-bottom: 20px; background-color: #f8d7da; color: #721c24; border-radius: 5px;">
        <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($_SESSION['error_message']); ?>
        <?php unset($_SESSION['error_message']); ?>
    </div>
    <?php endif; ?>
    
    <!-- Statistics Cards -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--primary-color);">
                <i class="fas fa-calendar-day"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['today_appointments']; ?></h3>
                <p>Today's Appointments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--secondary-color);">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['total_appointments']; ?></h3>
                <p>Total Appointments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--warning-color);">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['pending_appointments']; ?></h3>
                <p>Pending</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--success-color);">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['completed_appointments']; ?></h3>
                <p>Completed</p>
            </div>
        </div>
    </div>
    
    <!-- Doctor Information -->
    <div style="background-color: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 30px;">
        <div style="display: flex; align-items: center; gap: 20px;">
            <div style="width: 80px; height: 80px; border-radius: 50%; background-color: var(--primary-light); display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                <i class="fas fa-user-md"></i>
            </div>
            <div>
                <h3 style="margin-bottom: 5px;">Dr. <?php echo htmlspecialchars($doctorInfo['name'] ?? $_SESSION['user_name']); ?></h3>
                <p style="color: var(--primary-color); margin-bottom: 5px;">
                    <i class="fas fa-stethoscope"></i> 
                    <?php echo htmlspecialchars($doctorInfo['specialization'] ?? 'General Practitioner'); ?>
                </p>
                <p style="color: var(--text-light); font-size: 0.9rem;">
                    <i class="fas fa-hospital"></i> 
                    <?php echo htmlspecialchars($doctorInfo['department_name'] ?? 'No department assigned'); ?>
                </p>
            </div>
        </div>
    </div>
    
    <!-- Today's Appointments -->
    <div class="page-header" style="margin-top: 40px;">
        <h3>Today's Appointments</h3>
        <a href="?page=doctor-appointments" class="btn btn-outline">
            <i class="fas fa-calendar-alt"></i> View All Appointments
        </a>
    </div>
    
    <?php if (empty($todayAppointments)): ?>
    <div class="alert" style="background-color: var(--primary-light); padding: 20px; border-radius: var(--border-radius);">
        <p style="margin: 0;">No appointments scheduled for today.</p>
    </div>
    <?php else: ?>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Patient Name</th>
                    <th>Contact</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($todayAppointments as $appointment): ?>
                <tr>
                    <td><?php echo date('h:i A', strtotime($appointment['time'])); ?></td>
                    <td>
                        <strong><?php echo htmlspecialchars($appointment['patient_name']); ?></strong>
                    </td>
                    <td>
                        <small><?php echo htmlspecialchars($appointment['patient_phone'] ?? 'N/A'); ?><br>
                        <?php echo htmlspecialchars($appointment['patient_email'] ?? ''); ?></small>
                    </td>
                    <td><?php echo htmlspecialchars($appointment['reason']); ?></td>
                    <td>
                        <span class="status <?php echo strtolower($appointment['status']); ?>">
                            <?php echo ucfirst($appointment['status']); ?>
                        </span>
                    </td>
                    <td>
                        <form action="?page=update-appointment-status" method="POST" style="display: inline-block;">
                            <input type="hidden" name="appointment_id" value="<?php echo $appointment['id']; ?>">
                            <select name="status" class="form-control" style="width: auto; display: inline-block; padding: 5px;" 
                                    onchange="if(confirm('Change appointment status?')) this.form.submit()">
                                <option value="pending" <?php echo $appointment['status'] == 'pending' ? 'selected' : ''; ?>>Pending</option>
                                <option value="confirmed" <?php echo $appointment['status'] == 'confirmed' ? 'selected' : ''; ?>>Confirmed</option>
                                <option value="completed" <?php echo $appointment['status'] == 'completed' ? 'selected' : ''; ?>>Completed</option>
                                <option value="cancelled" <?php echo $appointment['status'] == 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                            </select>
                        </form>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
    <?php endif; ?>
    
    <!-- Upcoming Appointments -->
    <?php if (!empty($upcomingAppointments)): ?>
    <div class="page-header" style="margin-top: 40px;">
        <h3>Upcoming Appointments (Next 7 Days)</h3>
    </div>
    
    <div class="cards-container">
        <?php foreach ($upcomingAppointments as $appointment): ?>
        <div class="card">
            <div class="card-header">
                <h4><?php echo $appointment['formatted_date']; ?></h4>
                <small><?php echo date('h:i A', strtotime($appointment['time'])); ?></small>
            </div>
            <div class="card-body">
                <h5><?php echo htmlspecialchars($appointment['patient_name']); ?></h5>
                <p style="font-size: 0.9rem; color: var(--text-light);">
                    <?php echo htmlspecialchars(substr($appointment['reason'] ?? 'No reason specified', 0, 50)); ?>...
                </p>
                <span class="status <?php echo strtolower($appointment['status']); ?>" style="margin-top: 10px;">
                    <?php echo ucfirst($appointment['status']); ?>
                </span>
            </div>
        </div>
        <?php endforeach; ?>
    </div>
    <?php endif; ?>
    
    <!-- Quick Actions -->
    <div style="margin-top: 40px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <a href="?page=doctor-appointments" class="btn btn-primary" style="text-align: center; padding: 15px;">
            <i class="fas fa-calendar-alt fa-2x"></i><br>
            <span>All Appointments</span>
        </a>
        <a href="?page=doctor-schedule" class="btn btn-secondary" style="text-align: center; padding: 15px;">
            <i class="fas fa-clock fa-2x"></i><br>
            <span>My Schedule</span>
        </a>
        <a href="?page=doctor-patients" class="btn btn-success" style="text-align: center; padding: 15px;">
            <i class="fas fa-user-injured fa-2x"></i><br>
            <span>My Patients</span>
        </a>
        <a href="?page=doctor-profile" class="btn btn-warning" style="text-align: center; padding: 15px;">
            <i class="fas fa-user-cog fa-2x"></i><br>
            <span>My Profile</span>
        </a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-refresh page every 5 minutes
    setTimeout(function() {
        location.reload();
    }, 5 * 60 * 1000);
});
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/doctor/notes.php
================================================================================


================================================================================
FILE: views/doctor/schedule.php
================================================================================

<?php
$pageTitle = 'Doctor Schedule - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>My Schedule</h2>
    </div>
    
    <div class="alert" style="background-color: var(--primary-light); padding: 20px; border-radius: var(--border-radius); margin-bottom: 30px;">
        <p style="margin: 0;">Schedule management will be implemented in the next version.</p>
    </div>
    
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Day</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Max Patients</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Monday</td>
                    <td>09:00 AM</td>
                    <td>05:00 PM</td>
                    <td>20</td>
                    <td><span class="status confirmed">Active</span></td>
                </tr>
                <tr>
                    <td>Tuesday</td>
                    <td>09:00 AM</td>
                    <td>05:00 PM</td>
                    <td>20</td>
                    <td><span class="status confirmed">Active</span></td>
                </tr>
                <tr>
                    <td>Wednesday</td>
                    <td>09:00 AM</td>
                    <td>05:00 PM</td>
                    <td>20</td>
                    <td><span class="status confirmed">Active</span></td>
                </tr>
                <tr>
                    <td>Thursday</td>
                    <td>09:00 AM</td>
                    <td>05:00 PM</td>
                    <td>20</td>
                    <td><span class="status confirmed">Active</span></td>
                </tr>
                <tr>
                    <td>Friday</td>
                    <td>09:00 AM</td>
                    <td>01:00 PM</td>
                    <td>15</td>
                    <td><span class="status confirmed">Active</span></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/doctor/appointments.php
================================================================================

<?php
$pageTitle = 'My Appointments - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>My Appointments</h2>
        <p>Manage all your appointments</p>
    </div>
    
    <!-- Success/Error Messages -->
    <?php if (isset($_SESSION['success_message'])): ?>
    <div class="alert alert-success">
        <i class="fas fa-check-circle"></i> <?php echo htmlspecialchars($_SESSION['success_message']); ?>
        <?php unset($_SESSION['success_message']); ?>
    </div>
    <?php endif; ?>
    
    <?php if (isset($_SESSION['error_message'])): ?>
    <div class="alert alert-danger">
        <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($_SESSION['error_message']); ?>
        <?php unset($_SESSION['error_message']); ?>
    </div>
    <?php endif; ?>
    
    <!-- Appointment Statistics -->
    <div class="stats-cards" style="margin-bottom: 30px;">
        <div class="stat-card">
            <div class="stat-info">
                <h3><?php echo $stats['total']; ?></h3>
                <p>Total Appointments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <h3><?php echo $stats['pending']; ?></h3>
                <p>Pending</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <h3><?php echo $stats['confirmed']; ?></h3>
                <p>Confirmed</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <h3><?php echo $stats['completed']; ?></h3>
                <p>Completed</p>
            </div>
        </div>
    </div>
    
    <!-- Filter Form -->
    <div class="filter-container">
        <form method="GET" action="" class="form-row">
            <input type="hidden" name="page" value="doctor-appointments">
            
            <div class="form-group" style="flex: 1;">
                <label>Search Patient</label>
                <input type="text" class="form-control" name="search" placeholder="Search by patient name or reason..." 
                       value="<?php echo htmlspecialchars($filters['search'] ?? ''); ?>">
            </div>
            
            <div class="form-group">
                <label>Status</label>
                <select class="form-control" name="status">
                    <option value="">All Status</option>
                    <option value="pending" <?php echo ($filters['status'] ?? '') == 'pending' ? 'selected' : ''; ?>>Pending</option>
                    <option value="confirmed" <?php echo ($filters['status'] ?? '') == 'confirmed' ? 'selected' : ''; ?>>Confirmed</option>
                    <option value="completed" <?php echo ($filters['status'] ?? '') == 'completed' ? 'selected' : ''; ?>>Completed</option>
                    <option value="cancelled" <?php echo ($filters['status'] ?? '') == 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-control" name="date" 
                       value="<?php echo htmlspecialchars($filters['date'] ?? ''); ?>">
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="?page=doctor-appointments" class="btn btn-outline">Reset</a>
            </div>
        </form>
    </div>
    
    <!-- Appointments Table -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Patient</th>
                    <th>Date & Time</th>
                    <th>Contact</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php if (empty($appointments)): ?>
                <tr>
                    <td colspan="7" style="text-align: center; padding: 20px;">No appointments found.</td>
                </tr>
                <?php else: ?>
                <?php foreach ($appointments as $appointment): ?>
                <tr>
                    <td>#<?php echo $appointment['id']; ?></td>
                    <td>
                        <strong><?php echo htmlspecialchars($appointment['patient_name']); ?></strong>
                    </td>
                    <td>
                        <strong><?php echo $appointment['formatted_date']; ?></strong><br>
                        <small><?php echo $appointment['formatted_time']; ?></small>
                    </td>
                    <td>
                        <small><?php echo htmlspecialchars($appointment['patient_phone'] ?? 'N/A'); ?><br>
                        <?php echo htmlspecialchars($appointment['patient_email']); ?></small>
                    </td>
                    <td><?php echo htmlspecialchars($appointment['reason']); ?></td>
                    <td>
                        <span class="status <?php echo strtolower($appointment['status']); ?>">
                            <?php echo ucfirst($appointment['status']); ?>
                        </span>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <!-- Update Status Form -->
                            <form action="?page=update-appointment-status" method="POST" style="display: inline;">
                                <input type="hidden" name="appointment_id" value="<?php echo $appointment['id']; ?>">
                                <select name="status" class="form-control" style="width: auto; padding: 5px; font-size: 0.9rem;" 
                                        onchange="if(confirm('Change appointment status?')) this.form.submit()">
                                    <option value="pending" <?php echo $appointment['status'] == 'pending' ? 'selected' : ''; ?>>Pending</option>
                                    <option value="confirmed" <?php echo $appointment['status'] == 'confirmed' ? 'selected' : ''; ?>>Confirmed</option>
                                    <option value="completed" <?php echo $appointment['status'] == 'completed' ? 'selected' : ''; ?>>Completed</option>
                                    <option value="cancelled" <?php echo $appointment['status'] == 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                                </select>
                            </form>
                            
                            <!-- Add Notes Button -->
                            <button type="button" class="btn btn-sm btn-outline" onclick="showNotesModal(<?php echo $appointment['id']; ?>, '<?php echo htmlspecialchars($appointment['patient_name']); ?>')" 
                                    title="Add Notes">
                                <i class="fas fa-notes-medical"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>
</div>

<!-- Notes Modal -->
<div id="notesModal" class="modal-overlay" style="display: none;">
    <div class="modal" style="max-width: 500px;">
        <div class="modal-header">
            <h3>Add Medical Notes</h3>
            <button type="button" class="close-modal" onclick="closeNotesModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="notesForm" action="?page=update-appointment-status" method="POST">
                <input type="hidden" name="appointment_id" id="modalAppointmentId">
                <input type="hidden" name="status" value="">
                
                <div class="form-group">
                    <label for="patientName">Patient</label>
                    <input type="text" class="form-control" id="patientName" readonly>
                </div>
                
                <div class="form-group">
                    <label for="notes">Medical Notes</label>
                    <textarea class="form-control" id="notes" name="notes" rows="5" placeholder="Enter medical notes, prescriptions, or recommendations..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeNotesModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Notes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function showNotesModal(appointmentId, patientName) {
    document.getElementById('modalAppointmentId').value = appointmentId;
    document.getElementById('patientName').value = patientName;
    document.getElementById('notesModal').style.display = 'flex';
}

function closeNotesModal() {
    document.getElementById('notesModal').style.display = 'none';
    document.getElementById('notesForm').reset();
}

// Close modal when clicking outside
document.getElementById('notesModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeNotesModal();
    }
});

// Initialize date picker with today as minimum
document.querySelector('input[name="date"]').min = new Date().toISOString().split('T')[0];
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/dashboard.php
================================================================================

<?php
$pageTitle = 'Admin Dashboard - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Admin Dashboard</h2>
        <p>Welcome back, <?php echo $_SESSION['user_name']; ?>. Here's what's happening today.</p>
    </div>
    
    <!-- Success/Error Messages -->
    <?php if (isset($_SESSION['success_message'])): ?>
    <div class="alert alert-success" style="padding: 15px; margin-bottom: 20px; background-color: #d4edda; color: #155724; border-radius: 5px;">
        <i class="fas fa-check-circle"></i> <?php echo htmlspecialchars($_SESSION['success_message']); ?>
        <?php unset($_SESSION['success_message']); ?>
    </div>
    <?php endif; ?>
    
    <?php if (isset($_SESSION['error_message'])): ?>
    <div class="alert alert-danger" style="padding: 15px; margin-bottom: 20px; background-color: #f8d7da; color: #721c24; border-radius: 5px;">
        <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($_SESSION['error_message']); ?>
        <?php unset($_SESSION['error_message']); ?>
    </div>
    <?php endif; ?>
    
    <!-- System Alerts -->
    <?php if (!empty($alerts)): ?>
    <div class="alerts-container" style="margin-bottom: 30px;">
        <h3>System Alerts</h3>
        <div class="cards-container">
            <?php foreach ($alerts as $alert): ?>
            <?php if ($alert['count'] > 0): ?>
            <div class="card" style="border-left: 4px solid var(--warning-color);">
                <div class="card-body">
                    <h4><?php echo htmlspecialchars($alert['title']); ?></h4>
                    <p style="font-size: 1.5rem; font-weight: bold; color: var(--warning-color);">
                        <?php echo $alert['count']; ?>
                    </p>
                </div>
            </div>
            <?php endif; ?>
            <?php endforeach; ?>
        </div>
    </div>
    <?php endif; ?>
    
    <!-- Statistics Cards -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon doctors">
                <i class="fas fa-user-md"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['doctors']; ?></h3>
                <p>Active Doctors</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon patients">
                <i class="fas fa-user-injured"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['patients']; ?></h3>
                <p>Active Patients</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon appointments">
                <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['appointments']; ?></h3>
                <p>Today's Appointments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon departments">
                <i class="fas fa-clinic-medical"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['departments']; ?></h3>
                <p>Departments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--secondary-color);">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['receptionists']; ?></h3>
                <p>Receptionists</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--warning-color);">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['pending_appointments']; ?></h3>
                <p>Pending Appointments</p>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div style="background-color: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 30px;">
        <h3>Quick Actions</h3>
        <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
            <a href="?page=admin-add-doctor" class="btn btn-primary">
                <i class="fas fa-user-md"></i> Add Doctor
            </a>
            <a href="?page=admin-add-user" class="btn btn-secondary">
                <i class="fas fa-user-plus"></i> Add User
            </a>
            <a href="?page=admin-add-department" class="btn btn-success">
                <i class="fas fa-clinic-medical"></i> Add Department
            </a>
            <a href="?page=admin-reports" class="btn btn-warning">
                <i class="fas fa-chart-bar"></i> View Reports
            </a>
            <a href="?page=admin-settings" class="btn btn-outline">
                <i class="fas fa-cog"></i> Settings
            </a>
        </div>
    </div>
    
    <!-- Recent Appointments -->
    <div class="page-header">
        <h3>Recent Appointments</h3>
        <a href="?page=admin-appointments" class="btn btn-outline">
            <i class="fas fa-eye"></i> View All
        </a>
    </div>
    
    <?php if (empty($appointments)): ?>
    <div class="alert" style="background-color: var(--primary-light); padding: 20px; border-radius: var(--border-radius);">
        <p style="margin: 0;">No recent appointments found.</p>
    </div>
    <?php else: ?>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Patient</th>
                    <th>Doctor</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($appointments as $appointment): ?>
                <tr>
                    <td><?php echo htmlspecialchars($appointment['patient_name']); ?></td>
                    <td>Dr. <?php echo htmlspecialchars($appointment['doctor_name']); ?></td>
                    <td><?php echo date('M d, Y', strtotime($appointment['date'])); ?></td>
                    <td><?php echo date('h:i A', strtotime($appointment['time'])); ?></td>
                    <td>
                        <span class="status <?php echo strtolower($appointment['status']); ?>">
                            <?php echo ucfirst($appointment['status']); ?>
                        </span>
                    </td>
                    <td>
                        <form action="?page=update-appointment-status&id=<?php echo $appointment['id']; ?>" method="POST" style="display: inline;">
                            <select name="status" onchange="this.form.submit()" class="form-control" style="width: auto; display: inline-block; padding: 5px;">
                                <option value="pending" <?php echo $appointment['status'] == 'pending' ? 'selected' : ''; ?>>Pending</option>
                                <option value="confirmed" <?php echo $appointment['status'] == 'confirmed' ? 'selected' : ''; ?>>Confirmed</option>
                                <option value="completed" <?php echo $appointment['status'] == 'completed' ? 'selected' : ''; ?>>Completed</option>
                                <option value="cancelled" <?php echo $appointment['status'] == 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                            </select>
                        </form>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
    <?php endif; ?>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/add_doctor_working.php
================================================================================

<?php
// add_doctor_working.php - Standalone working version
session_start();
error_reporting(E_ALL);
ini_set('display_errors', 1);

// Check if user is admin
if (!isset($_SESSION['user_role']) || $_SESSION['user_role'] !== 'admin') {
    header("Location: public/index.php?page=login");
    exit();
}

// Include database
require_once __DIR__ . '/core/Database.php';

// Process form submission
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $db = \Core\Database::getInstance()->getConnection();
    
    // Get form data
    $name = trim($_POST['name'] ?? '');
    $email = trim($_POST['email'] ?? '');
    $password = $_POST['password'] ?? 'doctor123';
    $phone = trim($_POST['phone'] ?? '');
    $specialization = trim($_POST['specialization'] ?? '');
    $department_id = $_POST['department_id'] ?? null;
    $status = $_POST['status'] ?? 'active';
    
    // Validate
    $errors = [];
    if (empty($name)) $errors[] = "Name is required";
    if (empty($email)) $errors[] = "Email is required";
    if (empty($password)) $errors[] = "Password is required";
    if (strlen($password) < 6) $errors[] = "Password must be at least 6 characters";
    
    // Check if email exists
    $stmt = $db->prepare("SELECT id FROM users WHERE email = ?");
    $stmt->execute([$email]);
    if ($stmt->fetch()) {
        $errors[] = "Email already exists";
    }
    
    if (empty($errors)) {
        // Hash password
        $hashedPassword = password_hash($password, PASSWORD_DEFAULT);
        
        // Insert doctor
        $stmt = $db->prepare("
            INSERT INTO users (name, email, password, phone, specialization, department_id, role, status) 
            VALUES (?, ?, ?, ?, ?, ?, 'doctor', ?)
        ");
        
        $success = $stmt->execute([
            $name, $email, $hashedPassword, $phone, $specialization, $department_id, $status
        ]);
        
        if ($success) {
            $_SESSION['success_message'] = 'Doctor added successfully!';
            header("Location: public/index.php?page=admin-doctors");
            exit();
        } else {
            $error = "Failed to add doctor to database";
        }
    } else {
        $error = implode('<br>', $errors);
    }
}

// Get departments for dropdown
$db = \Core\Database::getInstance()->getConnection();
$stmt = $db->query("SELECT * FROM departments ORDER BY name");
$departments = $stmt->fetchAll();

// Load CSS
$css = file_get_contents(__DIR__ . '/public/css/style.css');
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Doctor - Kasr Al Ainy Hospital</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        <?php echo $css; ?>
        
        body {
            background-color: #f5f7fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            flex: 1;
            margin-top: 30px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">üè•</div>
                    <div class="logo-text">
                        <h1>Kasr Al Ainy Hospital</h1>
                        <p>Admin Panel</p>
                    </div>
                </div>
                <nav>
                    <ul>
                        <li><a href="public/index.php?page=admin-dashboard">Dashboard</a></li>
                        <li><a href="public/index.php?page=admin-doctors" class="active">Doctors</a></li>
                        <li><a href="add_doctor_working.php">Add Doctor</a></li>
                        <li><a href="public/index.php?page=logout">Logout</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="page-header">
                <h2>Add New Doctor</h2>
                <a href="public/index.php?page=admin-doctors" class="btn btn-outline">
                    <i class="fas fa-arrow-left"></i> Back to Doctors
                </a>
            </div>
            
            <div class="form-container">
                <?php if (isset($error)): ?>
                <div class="error-message active">
                    <i class="fas fa-exclamation-circle"></i> <?php echo $error; ?>
                </div>
                <?php endif; ?>
                
                <?php if (isset($_SESSION['success_message'])): ?>
                <div class="success-message active">
                    <i class="fas fa-check-circle"></i> <?php echo $_SESSION['success_message']; ?>
                    <?php unset($_SESSION['success_message']); ?>
                </div>
                <?php endif; ?>
                
                <form action="add_doctor_working.php" method="POST">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name">Full Name *</label>
                            <input type="text" class="form-control" id="name" name="name" required 
                                   value="<?php echo isset($_POST['name']) ? htmlspecialchars($_POST['name']) : ''; ?>">
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" class="form-control" id="email" name="email" required
                                   value="<?php echo isset($_POST['email']) ? htmlspecialchars($_POST['email']) : ''; ?>">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone">Phone Number *</label>
                            <input type="tel" class="form-control" id="phone" name="phone" required
                                   value="<?php echo isset($_POST['phone']) ? htmlspecialchars($_POST['phone']) : ''; ?>">
                        </div>
                        <div class="form-group">
                            <label for="specialization">Specialization *</label>
                            <input type="text" class="form-control" id="specialization" name="specialization" required
                                   value="<?php echo isset($_POST['specialization']) ? htmlspecialchars($_POST['specialization']) : ''; ?>">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="department_id">Department *</label>
                            <select class="form-control" id="department_id" name="department_id" required>
                                <option value="">Select Department</option>
                                <?php foreach ($departments as $dept): ?>
                                <option value="<?php echo $dept['id']; ?>" 
                                    <?php echo (isset($_POST['department_id']) && $_POST['department_id'] == $dept['id']) ? 'selected' : ''; ?>>
                                    <?php echo htmlspecialchars($dept['name']); ?>
                                </option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status *</label>
                            <select class="form-control" id="status" name="status" required>
                                <option value="active" <?php echo (!isset($_POST['status']) || $_POST['status'] == 'active') ? 'selected' : ''; ?>>Active</option>
                                <option value="inactive" <?php echo (isset($_POST['status']) && $_POST['status'] == 'inactive') ? 'selected' : ''; ?>>Inactive</option>
                                <option value="on_leave" <?php echo (isset($_POST['status']) && $_POST['status'] == 'on_leave') ? 'selected' : ''; ?>>On Leave</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="password">Password *</label>
                            <input type="password" class="form-control" id="password" name="password" required>
                            <small class="text-muted">Minimum 6 characters</small>
                        </div>
                        <div class="form-group">
                            <label for="confirm_password">Confirm Password *</label>
                            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="reset" class="btn btn-outline">Reset</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Add Doctor
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Kasr Al Ainy Hospital</h3>
                    <p>Adding new doctor to the system.</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; <?php echo date('Y'); ?> Kasr Al Ainy Hospital Management System</p>
            </div>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Password validation
        const form = document.querySelector('form');
        form.addEventListener('submit', function(e) {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            
            if (password.length < 6) {
                e.preventDefault();
                alert('Password must be at least 6 characters long');
                return false;
            }
            
            if (password !== confirmPassword) {
                e.preventDefault();
                alert('Passwords do not match');
                return false;
            }
            
            // Show loading
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            submitBtn.disabled = true;
            
            return true;
        });
    });
    </script>
</body>
</html>

================================================================================
FILE: views/admin/edit-appointment.php
================================================================================

<?php
$pageTitle = 'Edit Appointment - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Edit Appointment #<?php echo $appointment['id']; ?></h2>
        <a href="?page=admin-appointments" class="btn btn-outline">Back to Appointments</a>
    </div>
    
    <div class="form-container">
        <?php if (isset($_SESSION['error_message'])): ?>
        <div class="alert alert-danger">
            <?php echo htmlspecialchars($_SESSION['error_message']); ?>
            <?php unset($_SESSION['error_message']); ?>
        </div>
        <?php endif; ?>
        
        <form action="?page=admin-edit-appointment&id=<?php echo $appointment['id']; ?>" method="POST">
            <input type="hidden" name="id" value="<?php echo $appointment['id']; ?>">
            
            <div class="form-row">
                <div class="form-group">
                    <label for="patient_id">Select Patient *</label>
                    <select class="form-control" id="patient_id" name="patient_id" required>
                        <option value="">Select a Patient</option>
                        <?php foreach ($patients as $patient): ?>
                        <option value="<?php echo $patient['id']; ?>" 
                            <?php echo $appointment['patient_id'] == $patient['id'] ? 'selected' : ''; ?>>
                            <?php echo htmlspecialchars($patient['name']); ?> (<?php echo htmlspecialchars($patient['id']); ?>)
                        </option>
                        <?php endforeach; ?>
                    </select>
                </div>
                <div class="form-group">
                    <label for="doctor_id">Select Doctor *</label>
                    <select class="form-control" id="doctor_id" name="doctor_id" required>
                        <option value="">Select a Doctor</option>
                        <?php foreach ($doctors as $doctor): ?>
                        <option value="<?php echo $doctor['id']; ?>" 
                            <?php echo $appointment['doctor_id'] == $doctor['id'] ? 'selected' : ''; ?>>
                            Dr. <?php echo htmlspecialchars($doctor['name']); ?> - <?php echo htmlspecialchars($doctor['specialization']); ?>
                        </option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="date">Appointment Date *</label>
                    <input type="date" class="form-control" id="date" name="date" 
                           value="<?php echo htmlspecialchars($appointment['date']); ?>" required>
                </div>
                <div class="form-group">
                    <label for="time">Appointment Time *</label>
                    <input type="time" class="form-control" id="time" name="time" 
                           value="<?php echo htmlspecialchars(substr($appointment['time'], 0, 5)); ?>" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="reason">Reason for Visit *</label>
                <textarea class="form-control" id="reason" name="reason" rows="3" required><?php echo htmlspecialchars($appointment['reason']); ?></textarea>
            </div>
            
            <div class="form-group">
                <label for="status">Appointment Status *</label>
                <select class="form-control" id="status" name="status" required>
                    <option value="pending" <?php echo $appointment['status'] == 'pending' ? 'selected' : ''; ?>>Pending</option>
                    <option value="confirmed" <?php echo $appointment['status'] == 'confirmed' ? 'selected' : ''; ?>>Confirmed</option>
                    <option value="completed" <?php echo $appointment['status'] == 'completed' ? 'selected' : ''; ?>>Completed</option>
                    <option value="cancelled" <?php echo $appointment['status'] == 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                </select>
            </div>
            
            <div class="appointment-info" style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                <h4>Appointment Details</h4>
                <div class="row" style="display: flex; gap: 20px; margin-top: 10px;">
                    <div>
                        <strong>Appointment ID:</strong> #<?php echo $appointment['id']; ?>
                    </div>
                    <div>
                        <strong>Created:</strong> <?php echo date('M d, Y', strtotime($appointment['created_at'])); ?>
                    </div>
                    <div>
                        <strong>Last Updated:</strong> <?php echo date('M d, Y', strtotime($appointment['updated_at'])); ?>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <a href="?page=admin-appointments" class="btn btn-outline">Cancel</a>
                <button type="submit" class="btn btn-primary">Update Appointment</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').min = today;
});
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/add-department.php
================================================================================

<?php
$pageTitle = 'Add Department - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Add New Department</h2>
        <a href="?page=admin-departments" class="btn btn-outline">Back to Departments</a>
    </div>
    
    <div class="form-container">
        <?php if (isset($_SESSION['error_message'])): ?>
        <div class="alert alert-danger">
            <?php echo htmlspecialchars($_SESSION['error_message']); ?>
            <?php unset($_SESSION['error_message']); ?>
        </div>
        <?php endif; ?>
        
        <form action="?page=admin-add-department" method="POST">
            <div class="form-group">
                <label for="name">Department Name *</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <textarea class="form-control" id="description" name="description" rows="4"></textarea>
            </div>
            
            <div class="form-actions">
                <button type="reset" class="btn btn-outline">Reset</button>
                <button type="submit" class="btn btn-primary">Add Department</button>
            </div>
        </form>
    </div>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/edit-doctor.php
================================================================================

<?php
$pageTitle = 'Edit Doctor - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Edit Doctor: Dr. <?php echo htmlspecialchars($doctor['name']); ?></h2>
        <a href="?page=admin-doctors" class="btn btn-outline">Back to Doctors</a>
    </div>
    
    <div class="form-container">
        <?php if (isset($_SESSION['error_message'])): ?>
        <div class="alert alert-danger">
            <?php echo htmlspecialchars($_SESSION['error_message']); ?>
            <?php unset($_SESSION['error_message']); ?>
        </div>
        <?php endif; ?>
        
        <form action="?page=admin-edit-doctor&id=<?php echo $doctor['id']; ?>" method="POST">
            <input type="hidden" name="id" value="<?php echo $doctor['id']; ?>">
            
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Full Name *</label>
                    <input type="text" class="form-control" id="name" name="name" 
                           value="<?php echo htmlspecialchars($doctor['name']); ?>" required>
                </div>
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" class="form-control" id="email" name="email" 
                           value="<?php echo htmlspecialchars($doctor['email']); ?>" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" class="form-control" id="phone" name="phone" 
                           value="<?php echo htmlspecialchars($doctor['phone'] ?? ''); ?>">
                </div>
                <div class="form-group">
                    <label for="specialization">Specialization</label>
                    <input type="text" class="form-control" id="specialization" name="specialization"
                           value="<?php echo htmlspecialchars($doctor['specialization'] ?? ''); ?>">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="department_id">Department</label>
                    <select class="form-control" id="department_id" name="department_id">
                        <option value="">Select Department</option>
                        <?php foreach ($departments as $dept): ?>
                        <option value="<?php echo $dept['id']; ?>" 
                            <?php echo ($doctor['department_id'] ?? 0) == $dept['id'] ? 'selected' : ''; ?>>
                            <?php echo htmlspecialchars($dept['name']); ?>
                        </option>
                        <?php endforeach; ?>
                    </select>
                </div>
                <div class="form-group">
                    <label for="status">Status *</label>
                    <select class="form-control" id="status" name="status" required>
                        <option value="active" <?php echo $doctor['status'] == 'active' ? 'selected' : ''; ?>>Active</option>
                        <option value="inactive" <?php echo $doctor['status'] == 'inactive' ? 'selected' : ''; ?>>Inactive</option>
                        <option value="on_leave" <?php echo $doctor['status'] == 'on_leave' ? 'selected' : ''; ?>>On Leave</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="password">New Password (Leave empty to keep current)</label>
                <input type="password" class="form-control" id="password" name="password">
                <small class="text-muted">Only enter if you want to change the password</small>
            </div>
            
            <div class="doctor-info" style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                <h4>Doctor Information</h4>
                <div class="row" style="display: flex; gap: 20px; margin-top: 10px;">
                    <div>
                        <strong>Doctor ID:</strong> #<?php echo $doctor['id']; ?>
                    </div>
                    <div>
                        <strong>Role:</strong> Doctor
                    </div>
                    <div>
                        <strong>Created:</strong> <?php echo date('M d, Y', strtotime($doctor['created_at'])); ?>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <a href="?page=admin-doctors" class="btn btn-outline">Cancel</a>
                <button type="submit" class="btn btn-primary">Update Doctor</button>
            </div>
        </form>
    </div>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/users.php
================================================================================

<?php
$pageTitle = 'Manage Users - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Manage Users</h2>
        <a href="?page=admin-add-user" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add User
        </a>
    </div>
    
    <!-- Success/Error Messages -->
    <?php if (isset($_SESSION['success_message'])): ?>
    <div class="alert alert-success" style="padding: 15px; margin-bottom: 20px; background-color: #d4edda; color: #155724; border-radius: 5px;">
        <i class="fas fa-check-circle"></i> <?php echo htmlspecialchars($_SESSION['success_message']); ?>
        <?php unset($_SESSION['success_message']); ?>
    </div>
    <?php endif; ?>
    
    <?php if (isset($_SESSION['error_message'])): ?>
    <div class="alert alert-danger" style="padding: 15px; margin-bottom: 20px; background-color: #f8d7da; color: #721c24; border-radius: 5px;">
        <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($_SESSION['error_message']); ?>
        <?php unset($_SESSION['error_message']); ?>
    </div>
    <?php endif; ?>
    
    <!-- User Statistics -->
    <div class="stats-cards" style="margin-bottom: 30px;">
        <?php foreach ($stats as $stat): ?>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: 
                <?php echo $stat['role'] == 'admin' ? 'var(--warning-color)' : 
                          ($stat['role'] == 'doctor' ? 'var(--primary-color)' : 
                          ($stat['role'] == 'patient' ? 'var(--secondary-color)' : 'var(--success-color)')); ?>">
                <i class="fas fa-user<?php echo $stat['role'] == 'doctor' ? '-md' : 
                                       ($stat['role'] == 'patient' ? '-injured' : ''); ?>"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stat['count']; ?></h3>
                <p><?php echo ucfirst($stat['role']); ?>s</p>
                <small>Active: <?php echo $stat['active'] ?? 0; ?> | Inactive: <?php echo $stat['inactive'] ?? 0; ?></small>
            </div>
        </div>
        <?php endforeach; ?>
    </div>
    
    <!-- Filter Form -->
    <div class="filter-container" style="background-color: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 20px;">
        <form method="GET" action="" class="form-row" style="display: flex; gap: 15px; align-items: flex-end;">
            <input type="hidden" name="page" value="admin-users">
            
            <div class="form-group" style="flex: 1;">
                <label>Search</label>
                <input type="text" class="form-control" name="search" placeholder="Search by name, email, phone..." 
                       value="<?php echo htmlspecialchars($filters['search'] ?? ''); ?>">
            </div>
            
            <div class="form-group">
                <label>Role</label>
                <select class="form-control" name="role">
                    <option value="">All Roles</option>
                    <option value="admin" <?php echo ($filters['role'] ?? '') == 'admin' ? 'selected' : ''; ?>>Admin</option>
                    <option value="doctor" <?php echo ($filters['role'] ?? '') == 'doctor' ? 'selected' : ''; ?>>Doctor</option>
                    <option value="patient" <?php echo ($filters['role'] ?? '') == 'patient' ? 'selected' : ''; ?>>Patient</option>
                    <option value="receptionist" <?php echo ($filters['role'] ?? '') == 'receptionist' ? 'selected' : ''; ?>>Receptionist</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Status</label>
                <select class="form-control" name="status">
                    <option value="">All Status</option>
                    <option value="active" <?php echo ($filters['status'] ?? '') == 'active' ? 'selected' : ''; ?>>Active</option>
                    <option value="inactive" <?php echo ($filters['status'] ?? '') == 'inactive' ? 'selected' : ''; ?>>Inactive</option>
                    <option value="on_leave" <?php echo ($filters['status'] ?? '') == 'on_leave' ? 'selected' : ''; ?>>On Leave</option>
                </select>
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="?page=admin-users" class="btn btn-outline">Reset</a>
            </div>
        </form>
    </div>
    
    <!-- Users Table -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php if (empty($users)): ?>
                <tr>
                    <td colspan="8" style="text-align: center; padding: 20px;">No users found.</td>
                </tr>
                <?php else: ?>
                <?php foreach ($users as $user): ?>
                <tr>
                    <td>#<?php echo $user['id']; ?></td>
                    <td><?php echo htmlspecialchars($user['name']); ?></td>
                    <td><?php echo htmlspecialchars($user['email']); ?></td>
                    <td>
                        <span class="badge" style="background-color: 
                            <?php echo $user['role'] == 'admin' ? 'var(--warning-color)' : 
                                      ($user['role'] == 'doctor' ? 'var(--primary-color)' : 
                                      ($user['role'] == 'patient' ? 'var(--secondary-color)' : 'var(--success-color)')); ?>; 
                            color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.85rem;">
                            <?php echo ucfirst($user['role']); ?>
                        </span>
                    </td>
                    <td><?php echo htmlspecialchars($user['phone'] ?? 'N/A'); ?></td>
                    <td>
                        <span class="status <?php echo $user['status'] == 'active' ? 'confirmed' : 
                                              ($user['status'] == 'on_leave' ? 'pending' : 'cancelled'); ?>">
                            <?php echo ucfirst(str_replace('_', ' ', $user['status'])); ?>
                        </span>
                    </td>
                    <td><?php echo date('M d, Y', strtotime($user['created_at'])); ?></td>
                    <td>
                        <a href="?page=admin-edit-user&id=<?php echo $user['id']; ?>" class="btn btn-sm btn-outline">
                            <i class="fas fa-edit"></i>
                        </a>
                        <?php if ($user['id'] != $_SESSION['user_id']): ?>
                        <a href="?page=admin-delete-user&id=<?php echo $user['id']; ?>" 
                        class="btn btn-sm btn-danger" 
                        onclick="return confirm('Are you sure you want to delete this user?')">
                            <i class="fas fa-trash"></i>
                        </a>
                        <?php endif; ?>
                    </td>
                </tr>
                <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/add-doctor.php
================================================================================

<?php
// views/admin/add-doctor-fixed.php
$pageTitle = 'Add Doctor - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Add New Doctor</h2>
        <a href="?page=admin-doctors" class="btn btn-outline">Back to Doctors</a>
    </div>
    
    <div class="form-container">
        <?php if (isset($_SESSION['error_message'])): ?>
        <div class="alert alert-danger">
            <?php echo htmlspecialchars($_SESSION['error_message']); ?>
            <?php unset($_SESSION['error_message']); ?>
        </div>
        <?php endif; ?>
        
        <?php if (isset($_SESSION['success_message'])): ?>
        <div class="alert alert-success">
            <?php echo htmlspecialchars($_SESSION['success_message']); ?>
            <?php unset($_SESSION['success_message']); ?>
        </div>
        <?php endif; ?>
        
        <form action="?page=admin-add-doctor" method="POST" onsubmit="return validateDoctorForm()">
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Full Name *</label>
                    <input type="text" class="form-control" id="name" name="name" required 
                        value="<?php echo isset($formData['name']) ? htmlspecialchars($formData['name']) : ''; ?>">
                </div>
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" class="form-control" id="email" name="email" required
                        value="<?php echo isset($formData['email']) ? htmlspecialchars($formData['email']) : ''; ?>">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" class="form-control" id="phone" name="phone" required
                        value="<?php echo isset($formData['phone']) ? htmlspecialchars($formData['phone']) : ''; ?>">
                </div>
                <div class="form-group">
                    <label for="specialization">Specialization *</label>
                    <input type="text" class="form-control" id="specialization" name="specialization" required
                        value="<?php echo isset($formData['specialization']) ? htmlspecialchars($formData['specialization']) : ''; ?>">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="department_id">Department *</label>
                    <select class="form-control" id="department_id" name="department_id" required>
                        <option value="">Select Department</option>
                        <?php foreach ($departments as $dept): ?>
                        <option value="<?php echo $dept['id']; ?>" 
                            <?php echo (isset($formData['department_id']) && $formData['department_id'] == $dept['id']) ? 'selected' : ''; ?>>
                            <?php echo htmlspecialchars($dept['name']); ?>
                        </option>
                        <?php endforeach; ?>
                    </select>
                </div>
                <div class="form-group">
                    <label for="status">Status *</label>
                    <select class="form-control" id="status" name="status" required>
                        <option value="active" <?php echo (!isset($formData['status']) || $formData['status'] == 'active') ? 'selected' : ''; ?>>Active</option>
                        <option value="inactive" <?php echo (isset($formData['status']) && $formData['status'] == 'inactive') ? 'selected' : ''; ?>>Inactive</option>
                        <option value="on_leave" <?php echo (isset($formData['status']) && $formData['status'] == 'on_leave') ? 'selected' : ''; ?>>On Leave</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="password">Password *</label>
                    <input type="password" class="form-control" id="password" name="password" required>
                    <small class="text-muted">Minimum 6 characters</small>
                </div>
                <div class="form-group">
                    <label for="confirm_password">Confirm Password *</label>
                    <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="reset" class="btn btn-outline">Reset</button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Add Doctor
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    
document.addEventListener('DOMContentLoaded', function() {
    // Password validation
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    
    function validateDoctorForm() {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm_password').value;
        
        if (password.length < 6) {
            alert('Password must be at least 6 characters long');
            return false;
        }
        
        if (password !== confirmPassword) {
            alert('Passwords do not match');
            return false;
        }
        
        return true;
    }
    
    // Form submission validation
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        if (!validatePasswords()) {
            e.preventDefault();
            return false;
        }
        
        // Show loading state
        const submitBtn = this.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        submitBtn.disabled = true;
        
        return true;
    });
});
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/doctors.php
================================================================================

<?php
$pageTitle = 'Manage Doctors - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Manage Doctors</h2>
        <a class="btn btn-primary" href="?page=admin-add-doctor">
            <i class="fas fa-plus"></i> Add Doctor
        </a>
    </div>
    
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Specialization</th>
                    <th>Department</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($doctors as $doctor): ?>
                <tr>
                    <td><?php echo htmlspecialchars($doctor['name']); ?></td>
                    <td><?php echo htmlspecialchars($doctor['email']); ?></td>
                    <td><?php echo htmlspecialchars($doctor['specialization'] ?? 'N/A'); ?></td>
                    <td><?php echo htmlspecialchars($doctor['department_name'] ?? 'N/A'); ?></td>
                    <td><?php echo htmlspecialchars($doctor['phone']); ?></td>
                    <td>
                        <span class="status <?php echo $doctor['status'] == 'active' ? 'confirmed' : 'pending'; ?>">
                            <?php echo ucfirst($doctor['status']); ?>
                        </span>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <a href="?page=admin-edit-doctor&id=<?php echo $doctor['id']; ?>" class="btn btn-sm btn-outline" title="Edit">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="?page=admin-delete-doctor&id=<?php echo $doctor['id']; ?>" 
                            class="btn btn-sm btn-danger" 
                            title="Delete"
                            onclick="return confirm('Are you sure you want to delete Dr. <?php echo htmlspecialchars($doctor['name']); ?>?')">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
</div>

<script>
function editDoctor(doctorId) {
    // In a real app, you would fetch doctor data via AJAX
    alert('Edit functionality would be implemented with AJAX');
}

function deleteDoctor(doctorId) {
    if (confirm('Are you sure you want to delete this doctor?')) {
        window.location.href = '/hospital-management-system/admin/deleteDoctor/' + doctorId;
    }
}

function closeDoctorModal() {
    document.getElementById('doctor-modal').style.display = 'none';
}

</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/edit-department.php
================================================================================

<?php
$pageTitle = 'Edit Department - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Edit Department: <?php echo htmlspecialchars($department['name']); ?></h2>
        <a href="?page=admin-departments" class="btn btn-outline">Back to Departments</a>
    </div>
    
    <div class="form-container">
        <?php if (isset($_SESSION['error_message'])): ?>
        <div class="alert alert-danger">
            <?php echo htmlspecialchars($_SESSION['error_message']); ?>
            <?php unset($_SESSION['error_message']); ?>
        </div>
        <?php endif; ?>
        
        <form action="?page=admin-edit-department&id=<?php echo $department['id']; ?>" method="POST">
            <input type="hidden" name="id" value="<?php echo $department['id']; ?>">
            
            <div class="form-group">
                <label for="name">Department Name *</label>
                <input type="text" class="form-control" id="name" name="name" 
                       value="<?php echo htmlspecialchars($department['name']); ?>" required>
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <textarea class="form-control" id="description" name="description" rows="4"><?php echo htmlspecialchars($department['description'] ?? ''); ?></textarea>
            </div>
            
            <!-- Department Stats -->
            <div class="department-stats" style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                <h4>Department Information</h4>
                <div class="row" style="display: flex; gap: 20px; margin-top: 10px;">
                    <div>
                        <strong>ID:</strong> #<?php echo $department['id']; ?>
                    </div>
                    <div>
                        <strong>Created:</strong> <?php echo date('M d, Y', strtotime($department['created_at'])); ?>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <a href="?page=admin-departments" class="btn btn-outline">Cancel</a>
                <button type="submit" class="btn btn-primary">Update Department</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Character counter for description
    const description = document.getElementById('description');
    const counter = document.createElement('div');
    counter.className = 'text-muted';
    counter.style.textAlign = 'right';
    counter.style.fontSize = '0.9rem';
    counter.style.marginTop = '5px';
    
    description.parentNode.appendChild(counter);
    
    function updateCounter() {
        const length = description.value.length;
        counter.textContent = `${length}/500 characters`;
        
        if (length > 500) {
            counter.style.color = 'var(--danger-color)';
        } else if (length > 400) {
            counter.style.color = 'var(--warning-color)';
        } else {
            counter.style.color = 'var(--text-light)';
        }
    }
    
    description.addEventListener('input', updateCounter);
    updateCounter(); // Initial call
});
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/edit-user.php
================================================================================

<?php
$pageTitle = 'Edit User - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';

$db = \Core\Database::getInstance();
$departments = $db->query("SELECT * FROM departments ORDER BY name") ?? [];
?>

<div class="container">
    <div class="page-header">
        <h2>Edit User: <?php echo htmlspecialchars($user['name']); ?></h2>
        <a href="?page=admin-users" class="btn btn-outline">Back to Users</a>
    </div>
    
    <div class="form-container">
        <?php if (isset($_SESSION['error_message'])): ?>
        <div class="alert alert-danger">
            <?php echo htmlspecialchars($_SESSION['error_message']); ?>
            <?php unset($_SESSION['error_message']); ?>
        </div>
        <?php endif; ?>
        
        <form action="?page=admin-edit-user&id=<?php echo $user['id']; ?>" method="POST">
            <input type="hidden" name="id" value="<?php echo $user['id']; ?>">
            
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Full Name *</label>
                    <input type="text" class="form-control" id="name" name="name" 
                           value="<?php echo htmlspecialchars($user['name']); ?>" required>
                </div>
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" class="form-control" id="email" name="email" 
                           value="<?php echo htmlspecialchars($user['email']); ?>" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" class="form-control" id="phone" name="phone" 
                           value="<?php echo htmlspecialchars($user['phone'] ?? ''); ?>">
                </div>
                <div class="form-group">
                    <label for="password">New Password (Leave empty to keep current)</label>
                    <input type="password" class="form-control" id="password" name="password">
                    <small class="text-muted">Only enter if you want to change the password</small>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="status">Status *</label>
                    <select class="form-control" id="status" name="status" required>
                        <option value="active" <?php echo $user['status'] == 'active' ? 'selected' : ''; ?>>Active</option>
                        <option value="inactive" <?php echo $user['status'] == 'inactive' ? 'selected' : ''; ?>>Inactive</option>
                        <option value="on_leave" <?php echo $user['status'] == 'on_leave' ? 'selected' : ''; ?>>On Leave</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Current Role</label>
                    <input type="text" class="form-control" value="<?php echo ucfirst($user['role']); ?>" readonly>
                    <small class="text-muted">Role cannot be changed after creation</small>
                </div>
            </div>
            
            <?php if ($user['role'] === 'doctor'): ?>
            <div id="doctor-fields">
                <div class="form-row">
                    <div class="form-group">
                        <label for="specialization">Specialization</label>
                        <input type="text" class="form-control" id="specialization" name="specialization"
                               value="<?php echo htmlspecialchars($user['specialization'] ?? ''); ?>">
                    </div>
                    <div class="form-group">
                        <label for="department_id">Department</label>
                        <select class="form-control" id="department_id" name="department_id">
                            <option value="">Select Department</option>
                            <?php foreach ($departments as $dept): ?>
                            <option value="<?php echo $dept['id']; ?>" 
                                <?php echo ($user['department_id'] ?? 0) == $dept['id'] ? 'selected' : ''; ?>>
                                <?php echo htmlspecialchars($dept['name']); ?>
                            </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                </div>
            </div>
            <?php endif; ?>
            
            <div class="form-actions">
                <a href="?page=admin-users" class="btn btn-outline">Cancel</a>
                <button type="submit" class="btn btn-primary">Update User</button>
            </div>
        </form>
    </div>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/add-user.php
================================================================================

<?php
$pageTitle = 'Add User - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';

$db = \Core\Database::getInstance();
$departments = $db->query("SELECT * FROM departments ORDER BY name") ?? [];
?>

<div class="container">
    <div class="page-header">
        <h2>Add New User</h2>
        <a href="?page=admin-users" class="btn btn-outline">Back to Users</a>
    </div>
    
    <div class="form-container">
        <?php if (isset($_SESSION['error_message'])): ?>
        <div class="alert alert-danger">
            <?php echo htmlspecialchars($_SESSION['error_message']); ?>
            <?php unset($_SESSION['error_message']); ?>
        </div>
        <?php endif; ?>
        
        <form action="?page=admin-add-user" method="POST">
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Full Name *</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" class="form-control" id="phone" name="phone">
                </div>
                <div class="form-group">
                    <label for="password">Password *</label>
                    <input type="password" class="form-control" id="password" name="password" required>
                    <small class="text-muted">Default: password123</small>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="role">Role *</label>
                    <select class="form-control" id="role" name="role" required onchange="toggleDoctorFields()">
                        <option value="">Select Role</option>
                        <option value="admin">Admin</option>
                        <option value="doctor">Doctor</option>
                        <option value="receptionist">Receptionist</option>
                        <option value="patient">Patient</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="status">Status *</label>
                    <select class="form-control" id="status" name="status" required>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="on_leave">On Leave</option>
                    </select>
                </div>
            </div>
            
            <!-- Doctor-specific fields (hidden by default) -->
            <div id="doctor-fields" style="display: none;">
                <div class="form-row">
                    <div class="form-group">
                        <label for="specialization">Specialization</label>
                        <input type="text" class="form-control" id="specialization" name="specialization">
                    </div>
                    <div class="form-group">
                        <label for="department_id">Department</label>
                        <select class="form-control" id="department_id" name="department_id">
                            <option value="">Select Department</option>
                            <?php foreach ($departments as $dept): ?>
                            <option value="<?php echo $dept['id']; ?>"><?php echo htmlspecialchars($dept['name']); ?></option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="reset" class="btn btn-outline">Reset</button>
                <button type="submit" class="btn btn-primary">Add User</button>
            </div>
        </form>
    </div>
</div>

<script>
function toggleDoctorFields() {
    const role = document.getElementById('role').value;
    const doctorFields = document.getElementById('doctor-fields');
    
    if (role === 'doctor') {
        doctorFields.style.display = 'block';
        document.getElementById('specialization').required = true;
        document.getElementById('department_id').required = true;
    } else {
        doctorFields.style.display = 'none';
        document.getElementById('specialization').required = false;
        document.getElementById('department_id').required = false;
    }
}
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/departments.php
================================================================================

<?php
$pageTitle = 'Manage Departments - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Manage Departments</h2>
        <a href="?page=admin-add-department" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Department
        </a>
    </div>
    
    <!-- Success/Error Messages -->
    <?php if (isset($_SESSION['success_message'])): ?>
    <div class="alert alert-success" style="padding: 15px; margin-bottom: 20px; background-color: #d4edda; color: #155724; border-radius: 5px;">
        <i class="fas fa-check-circle"></i> <?php echo htmlspecialchars($_SESSION['success_message']); ?>
        <?php unset($_SESSION['success_message']); ?>
    </div>
    <?php endif; ?>
    
    <?php if (isset($_SESSION['error_message'])): ?>
    <div class="alert alert-danger" style="padding: 15px; margin-bottom: 20px; background-color: #f8d7da; color: #721c24; border-radius: 5px;">
        <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($_SESSION['error_message']); ?>
        <?php unset($_SESSION['error_message']); ?>
    </div>
    <?php endif; ?>
    
    <!-- Departments Table -->
    <?php if (empty($departments)): ?>
    <div class="alert" style="background-color: var(--primary-light); padding: 20px; border-radius: var(--border-radius); text-align: center;">
        <p style="margin: 0 0 15px 0;">No departments found. Add your first department!</p>
        <a href="?page=admin-add-department" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Department
        </a>
    </div>
    <?php else: ?>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Department Name</th>
                    <th>Description</th>
                    <th>Doctors Count</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($departments as $dept): ?>
                <tr>
                    <td>#<?php echo $dept['id']; ?></td>
                    <td>
                        <strong><?php echo htmlspecialchars($dept['name']); ?></strong>
                    </td>
                    <td>
                        <?php if (!empty($dept['description'])): ?>
                            <?php echo htmlspecialchars(substr($dept['description'], 0, 100)); ?>
                            <?php if (strlen($dept['description']) > 100): ?>...<?php endif; ?>
                        <?php else: ?>
                            <span class="text-muted">No description</span>
                        <?php endif; ?>
                    </td>
                    <td>
                        <span class="badge" style="background-color: var(--primary-color); color: white; padding: 4px 8px; border-radius: 12px;">
                            <?php echo $dept['doctor_count'] ?? 0; ?> doctors
                        </span>
                    </td>
                    <td>
                        <?php echo date('M d, Y', strtotime($dept['created_at'])); ?>
                    </td>
                    <td>
                        <a href="?page=admin-edit-department&id=<?php echo $dept['id']; ?>" class="btn btn-sm btn-outline" title="Edit">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="?page=admin-delete-department&id=<?php echo $dept['id']; ?>" 
                           class="btn btn-sm btn-danger" 
                           title="Delete"
                           onclick="return confirm('Are you sure you want to delete the <?php echo htmlspecialchars($dept['name']); ?> department?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
    <?php endif; ?>
    
    <!-- Quick Stats -->
    <div class="stats-cards" style="margin-top: 30px;">
        <div class="stat-card">
            <div class="stat-icon departments">
                <i class="fas fa-clinic-medical"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo count($departments); ?></h3>
                <p>Total Departments</p>
            </div>
        </div>
        
        <?php
        // Calculate total doctors in all departments
        $totalDoctors = 0;
        foreach ($departments as $dept) {
            $totalDoctors += $dept['doctor_count'] ?? 0;
        }
        ?>
        
        <div class="stat-card">
            <div class="stat-icon doctors">
                <i class="fas fa-user-md"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $totalDoctors; ?></h3>
                <p>Total Doctors</p>
            </div>
        </div>
        
        <?php
        // Find department with most doctors
        $mostDoctors = 0;
        $busiestDept = '';
        foreach ($departments as $dept) {
            if (($dept['doctor_count'] ?? 0) > $mostDoctors) {
                $mostDoctors = $dept['doctor_count'];
                $busiestDept = $dept['name'];
            }
        }
        ?>
        
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--success-color);">
                <i class="fas fa-star"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $mostDoctors; ?></h3>
                <p>Busiest Department<br><small><?php echo htmlspecialchars($busiestDept); ?></small></p>
            </div>
        </div>
        
        <?php
        // Find empty departments
        $emptyDepartments = 0;
        foreach ($departments as $dept) {
            if (($dept['doctor_count'] ?? 0) == 0) {
                $emptyDepartments++;
            }
        }
        ?>
        
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--warning-color);">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $emptyDepartments; ?></h3>
                <p>Empty Departments</p>
            </div>
        </div>
    </div>
</div>

<script>
// Search functionality
document.addEventListener('DOMContentLoaded', function() {
    // Add search input if needed
    const searchInput = document.createElement('input');
    searchInput.type = 'text';
    searchInput.placeholder = 'Search departments...';
    searchInput.className = 'form-control';
    searchInput.style.marginBottom = '20px';
    
    // Insert search input before table
    const tableContainer = document.querySelector('.table-container');
    if (tableContainer) {
        tableContainer.parentNode.insertBefore(searchInput, tableContainer);
        
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = tableContainer.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    }
});
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/add-appointment.php
================================================================================

<?php
$pageTitle = 'Add Appointment - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Schedule New Appointment</h2>
        <a href="?page=admin-appointments" class="btn btn-outline">Back to Appointments</a>
    </div>
    
    <div class="form-container">
        <?php if (isset($_SESSION['error_message'])): ?>
        <div class="alert alert-danger">
            <?php echo htmlspecialchars($_SESSION['error_message']); ?>
            <?php unset($_SESSION['error_message']); ?>
        </div>
        <?php endif; ?>
        
        <form action="?page=admin-add-appointment" method="POST">
            <div class="form-row">
                <div class="form-group">
                    <label for="patient_id">Select Patient *</label>
                    <select class="form-control" id="patient_id" name="patient_id" required>
                        <option value="">Select a Patient</option>
                        <?php foreach ($patients as $patient): ?>
                        <option value="<?php echo $patient['id']; ?>">
                            <?php echo htmlspecialchars($patient['name']); ?> (<?php echo htmlspecialchars($patient['id']); ?>)
                        </option>
                        <?php endforeach; ?>
                    </select>
                </div>
                <div class="form-group">
                    <label for="doctor_id">Select Doctor *</label>
                    <select class="form-control" id="doctor_id" name="doctor_id" required>
                        <option value="">Select a Doctor</option>
                        <?php foreach ($doctors as $doctor): ?>
                        <option value="<?php echo $doctor['id']; ?>">
                            Dr. <?php echo htmlspecialchars($doctor['name']); ?> - <?php echo htmlspecialchars($doctor['specialization']); ?>
                        </option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="date">Appointment Date *</label>
                    <input type="date" class="form-control" id="date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="time">Appointment Time *</label>
                    <input type="time" class="form-control" id="time" name="time" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="reason">Reason for Visit *</label>
                <textarea class="form-control" id="reason" name="reason" rows="3" required 
                          placeholder="Enter the reason for the appointment..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="status">Appointment Status *</label>
                <select class="form-control" id="status" name="status" required>
                    <option value="pending" selected>Pending</option>
                    <option value="confirmed">Confirmed</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>
            
            <div class="form-actions">
                <button type="reset" class="btn btn-outline">Reset</button>
                <button type="submit" class="btn btn-primary">Schedule Appointment</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').min = today;
    document.getElementById('date').value = today;
    
    // Set default time to next hour
    const now = new Date();
    const nextHour = new Date(now.getTime() + 60 * 60 * 1000);
    const timeString = nextHour.getHours().toString().padStart(2, '0') + ':' + 
                      nextHour.getMinutes().toString().padStart(2, '0');
    document.getElementById('time').value = timeString;
    
    // Auto-fill common reasons based on doctor's specialization
    const doctorSelect = document.getElementById('doctor_id');
    const reasonTextarea = document.getElementById('reason');
    
    if (doctorSelect && reasonTextarea) {
        doctorSelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const doctorText = selectedOption.text;
            
            // Extract specialization from doctor text
            if (doctorText.includes('-')) {
                const specialization = doctorText.split('-')[1].trim();
                
                const reasonPresets = {
                    'Cardiology': 'Heart checkup and cardiovascular assessment.',
                    'Neurology': 'Neurological consultation and examination.',
                    'Orthopedics': 'Bone and joint examination.',
                    'Pediatrics': 'Child health checkup.',
                    'Dermatology': 'Skin condition consultation.',
                    'Gynecology': 'Women\'s health examination.',
                    'General': 'General medical consultation and checkup.'
                };
                
                for (const [key, value] of Object.entries(reasonPresets)) {
                    if (specialization.includes(key)) {
                        reasonTextarea.value = value;
                        break;
                    }
                }
            }
        });
    }
});
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/admin/appointments.php
================================================================================

<?php
$pageTitle = 'Manage Appointments - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Manage Appointments</h2>
    </div>
    
    <!-- Appointment Statistics -->
    <div class="stats-cards" style="margin-bottom: 30px;">
        <div class="stat-card">
            <div class="stat-icon appointments">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['total'] ?? 0; ?></h3>
                <p>Total Appointments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--warning-color);">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['pending'] ?? 0; ?></h3>
                <p>Pending</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--success-color);">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['confirmed'] ?? 0; ?></h3>
                <p>Confirmed</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon" style="background-color: var(--danger-color);">
                <i class="fas fa-times-circle"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo $stats['cancelled'] ?? 0; ?></h3>
                <p>Cancelled</p>
            </div>
        </div>
    </div>
    
    <!-- Filter Form -->
    <div class="filter-container" style="background-color: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 20px;">
        <form method="GET" action="" class="form-row" style="display: flex; gap: 15px; align-items: flex-end;">
            <input type="hidden" name="page" value="admin-appointments">
            
            <div class="form-group" style="flex: 1;">
                <label>Search</label>
                <input type="text" class="form-control" name="search" placeholder="Search by patient, doctor, or reason..." 
                       value="<?php echo htmlspecialchars($filters['search'] ?? ''); ?>">
            </div>
            
            <div class="form-group">
                <label>Status</label>
                <select class="form-control" name="status">
                    <option value="">All Status</option>
                    <option value="pending" <?php echo ($filters['status'] ?? '') == 'pending' ? 'selected' : ''; ?>>Pending</option>
                    <option value="confirmed" <?php echo ($filters['status'] ?? '') == 'confirmed' ? 'selected' : ''; ?>>Confirmed</option>
                    <option value="completed" <?php echo ($filters['status'] ?? '') == 'completed' ? 'selected' : ''; ?>>Completed</option>
                    <option value="cancelled" <?php echo ($filters['status'] ?? '') == 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-control" name="date" value="<?php echo htmlspecialchars($filters['date'] ?? ''); ?>">
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="?page=admin-appointments" class="btn btn-outline">Reset</a>
            </div>
        </form>
    </div>
    
    <!-- Appointments Table -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Patient</th>
                    <th>Doctor</th>
                    <th>Date & Time</th>
                    <th>Specialization</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php if (empty($appointments)): ?>
                <tr>
                    <td colspan="9" style="text-align: center; padding: 20px;">No appointments found.</td>
                </tr>
                <?php else: ?>
                <?php foreach ($appointments as $appointment): ?>
                <tr>
                    <td>#<?php echo $appointment['id']; ?></td>
                    <td>
                        <strong><?php echo htmlspecialchars($appointment['patient_name']); ?></strong><br>
                        <small><?php echo htmlspecialchars($appointment['patient_email']); ?></small><br>
                        <small><?php echo htmlspecialchars($appointment['patient_phone'] ?? 'N/A'); ?></small>
                    </td>
                    <td>
                        <strong>Dr. <?php echo htmlspecialchars($appointment['doctor_name']); ?></strong>
                    </td>
                    <td>
                        <?php echo date('M d, Y', strtotime($appointment['date'])); ?><br>
                        <small><?php echo date('h:i A', strtotime($appointment['time'])); ?></small>
                    </td>
                    <td><?php echo htmlspecialchars($appointment['doctor_specialization'] ?? 'General'); ?></td>
                    <td><?php echo htmlspecialchars(substr($appointment['reason'] ?? '', 0, 50)); ?><?php echo strlen($appointment['reason'] ?? '') > 50 ? '...' : ''; ?></td>
                    <td>
                        <span class="status <?php echo strtolower($appointment['status']); ?>">
                            <?php echo ucfirst($appointment['status']); ?>
                        </span>
                    </td>
                    <td><?php echo date('M d, Y', strtotime($appointment['created_at'])); ?></td>
                    <td>
                        <form action="?page=update-appointment-status&id=<?php echo $appointment['id']; ?>" method="POST" style="display: inline;">
                            <select name="status" onchange="this.form.submit()" class="form-control" style="width: auto; padding: 5px; font-size: 0.9rem;">
                                <option value="pending" <?php echo $appointment['status'] == 'pending' ? 'selected' : ''; ?>>Pending</option>
                                <option value="confirmed" <?php echo $appointment['status'] == 'confirmed' ? 'selected' : ''; ?>>Confirmed</option>
                                <option value="completed" <?php echo $appointment['status'] == 'completed' ? 'selected' : ''; ?>>Completed</option>
                                <option value="cancelled" <?php echo $appointment['status'] == 'cancelled' ? 'selected' : ''; ?>>Cancelled</option>
                            </select>
                        </form>
                    </td>
                </tr>
                <?php endforeach; ?>
                <?php endif; ?>
            </tbody>
        </table>
    </div>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/layouts/header.php
================================================================================

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><?php echo $pageTitle ?? 'Kasr Al Ainy Hospital'; ?></title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
  <!-- Link to your CSS file -->
   <link rel="stylesheet" href="<?php echo APP_URL; ?>/public/css/admin.css">
  <link rel="stylesheet" href="<?php echo APP_URL; ?>/public/css/style.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  
  <!-- Add this style for mobile navbar -->
  <style>
    /* Mobile Menu Button */
    .mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--primary-color);
        cursor: pointer;
        padding: 10px;
        z-index: 1001;
    }
    
    /* Mobile Sidebar */
    .mobile-sidebar {
        position: fixed;
        top: 0;
        right: -300px;
        width: 280px;
        height: 100vh;
        background: var(--white);
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        transition: right 0.3s ease;
        overflow-y: auto;
        padding-top: 20px;
    }
    
    .mobile-sidebar.active {
        right: 0;
    }
    
    .mobile-sidebar-header {
        padding: 20px;
        border-bottom: 1px solid var(--gray-medium);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .mobile-sidebar-content {
        padding: 20px;
    }
    
    .mobile-sidebar ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .mobile-sidebar li {
        margin-bottom: 10px;
    }
    
    .mobile-sidebar a {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 12px 15px;
        border-radius: 8px;
        transition: all 0.3s;
        color: var(--text-color);
        text-decoration: none;
        font-size: 1rem;
    }
    
    .mobile-sidebar a:hover {
        background: var(--primary-light);
        color: var(--primary-color);
    }
    
    .mobile-sidebar a.active {
        background: var(--primary-color);
        color: var(--white);
    }
    
    .mobile-sidebar a i {
        width: 20px;
        text-align: center;
    }
    
    /* User Info in Mobile Sidebar */
    .mobile-user-info {
        padding: 20px;
        border-bottom: 1px solid var(--gray-medium);
        margin-bottom: 20px;
        text-align: center;
    }
    
    .mobile-user-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--primary-light);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px;
        font-size: 1.2rem;
        color: var(--primary-color);
        font-weight: bold;
    }
    
    .mobile-user-name {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--primary-dark);
    }
    
    .mobile-user-role {
        display: inline-block;
        padding: 4px 12px;
        background: var(--primary-light);
        color: var(--primary-color);
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    /* Overlay */
    .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
    }
    
    .sidebar-overlay.active {
        display: block;
    }
    
    /* Close button */
    .close-sidebar {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--text-color);
        cursor: pointer;
        padding: 5px;
    }
    
    /* Logout button styling */
    .mobile-sidebar .logout a {
        color: var(--danger-color) !important;
    }
    
    .mobile-sidebar .logout a:hover {
        background: rgba(231, 76, 60, 0.1) !important;
    }
    
    /* Responsive styles for less than 620px */
    @media (max-width: 620px) {
        .mobile-menu-btn {
            display: block;
        }
        
        #main-nav {
            display: none;
        }
        
        .user-info {
            display: none;
        }
        
        .header-content {
            padding: 10px 0;
        }
        
        .logo {
            flex: 1;
        }
        
        .logo-text h1 {
            font-size: 1.2rem;
        }
        
        .logo-text p {
            font-size: 0.8rem;
        }
        
        .logo img {
            width: 40px !important;
        }
    }
    
    /* For screens larger than 620px - show desktop nav */
    @media (min-width: 621px) {
        .mobile-sidebar {
            display: none !important;
        }
        
        .sidebar-overlay {
            display: none !important;
        }
    }
  </style>
</head>

<body>
  <!-- Overlay for mobile sidebar -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
            <img src="../public/assets/images/logo.png" alt="logo" width="60px">
          <div class="logo-text">
            <h1>ŸÖÿ≥ÿ™ÿ¥ŸÅŸâ ÿ∑ÿ® ÿßŸÑŸÇÿµÿ± ÿßŸÑÿπŸäŸÜŸä</h1>
            <p>ÿßŸÑÿßŸàŸÑŸâ ŸÅŸä ŸÖÿµÿ± Ÿà ÿßŸÑÿ¥ÿ±ŸÇ ÿßŸÑÿßŸàÿ≥ÿ∑</p>
          </div>
        </div>
        
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
          <i class="fas fa-bars"></i>
        </button>
        
        <!-- Desktop Navigation (visible on > 620px) -->
        <nav id="main-nav">
          <?php if (isset($_SESSION['user_id'])): ?>
          <ul>
            <!-- Update the admin navigation section -->
            <!-- In the admin section of header.php -->
            <?php if ($_SESSION['user_role'] === 'admin'): ?>
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=admin-dashboard" class="<?php echo ($currentPage ?? '') === 'dashboard' ? 'active' : ''; ?>">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a></li>
                
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=admin-doctors" class="<?php echo ($currentPage ?? '') === 'doctors' ? 'active' : ''; ?>">
                    <i class="fas fa-user-md"></i> Doctors
                </a></li>
                
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=admin-users" class="<?php echo ($currentPage ?? '') === 'users' ? 'active' : ''; ?>">
                    <i class="fas fa-users"></i> Users
                </a></li>
                
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=admin-departments" class="<?php echo ($currentPage ?? '') === 'departments' ? 'active' : ''; ?>">
                    <i class="fas fa-clinic-medical"></i> Departments
                </a></li>
                
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=admin-appointments" class="<?php echo ($currentPage ?? '') === 'appointments' ? 'active' : ''; ?>">
                    <i class="fas fa-calendar-check"></i> Appointments
                </a></li>
            <?php elseif ($_SESSION['user_role'] === 'admin'): ?>
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=admin-dashboard" class="<?php echo ($currentPage ?? '') === 'dashboard' ? 'active' : ''; ?>">Dashboard</a></li>
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=admin-doctors" class="<?php echo ($currentPage ?? '') === 'doctors' ? 'active' : ''; ?>">Doctors</a></li>
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=admin-appointments" class="<?php echo ($currentPage ?? '') === 'appointments' ? 'active' : ''; ?>">Appointments</a></li>
            <?php elseif ($_SESSION['user_role'] === 'doctor'): ?>
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=doctor-dashboard" class="<?php echo ($currentPage ?? '') === 'dashboard' ? 'active' : ''; ?>">Dashboard</a></li>
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=doctor-appointments" class="<?php echo ($currentPage ?? '') === 'appointments' ? 'active' : ''; ?>">Appointments</a></li>
            <?php elseif ($_SESSION['user_role'] === 'receptionist'): ?>
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=receptionist-dashboard" class="<?php echo ($currentPage ?? '') === 'dashboard' ? 'active' : ''; ?>">Dashboard</a></li>
            <?php elseif ($_SESSION['user_role'] === 'patient'): ?>
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=patient-dashboard" class="<?php echo ($currentPage ?? '') === 'dashboard' ? 'active' : ''; ?>">Dashboard</a></li>
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=patient-appointments" class="<?php echo ($currentPage ?? '') === 'appointments' ? 'active' : ''; ?>">Appointments</a></li>
                <li><a href="<?php echo APP_URL; ?>/public/index.php?page=patient-book" class="<?php echo ($currentPage ?? '') === 'book' ? 'active' : ''; ?>">Book Appointment</a></li>
            <?php endif; ?>
            <li class="logout"><a href="<?php echo APP_URL; ?>/public/index.php?page=logout">Logout</a></li>
          </ul>
          <?php else: ?>
          <ul>
            <li><a href="<?php echo APP_URL; ?>/public/index.php?page=home" class="<?php echo ($currentPage ?? '') === 'home' ? 'active' : ''; ?>">Home</a></li>
            <li><a href="<?php echo APP_URL; ?>/public/index.php?page=login" class="<?php echo ($currentPage ?? '') === 'login' ? 'active' : ''; ?>">Login</a></li>
            <li><a href="<?php echo APP_URL; ?>/public/index.php?page=register" class="<?php echo ($currentPage ?? '') === 'register' ? 'active' : ''; ?>">Sign Up</a></li>
          </ul>
          <?php endif; ?>
        </nav>

        <?php if (isset($_SESSION['user_id'])): ?>
        <div class="user-info">
          <div class="user-avatar">
            <?php
                        $initials = '';
                        if (isset($_SESSION['user_name'])) {
                            $nameParts = explode(' ', $_SESSION['user_name']);
                            foreach ($nameParts as $part) {
                                $initials .= strtoupper(substr($part, 0, 1));
                            }
                        }
                        echo substr($initials, 0, 2);
                        ?>
          </div>
          <div>
            <p id="user-name"><?php echo $_SESSION['user_name'] ?? 'User'; ?></p>
            <span style="font-size: 0.8rem; color: var(--text-light);"><?php echo ucfirst($_SESSION['user_role'] ?? ''); ?></span>
          </div>
        </div>
        <?php endif; ?>
      </div>
    </div>
  </header>

  <!-- Mobile Sidebar (hidden by default, shows on < 620px) -->
  <div class="mobile-sidebar" id="mobileSidebar">
    <div class="mobile-sidebar-header">
      <div class="logo" style="gap: 10px;">
        <img src="../public/assets/images/logo.png" alt="logo" width="40px">
        <div class="logo-text">
          <h1 style="font-size: 1rem;">ŸÖÿ≥ÿ™ÿ¥ŸÅŸâ ÿ∑ÿ® ÿßŸÑŸÇÿµÿ± ÿßŸÑÿπŸäŸÜŸä</h1>
          <p style="font-size: 0.7rem;">ÿßŸÑÿßŸàŸÑŸâ ŸÅŸä ŸÖÿµÿ± Ÿà ÿßŸÑÿ¥ÿ±ŸÇ ÿßŸÑÿßŸàÿ≥ÿ∑</p>
        </div>
      </div>
      <button class="close-sidebar" id="closeSidebar">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <?php if (isset($_SESSION['user_id'])): ?>
    <div class="mobile-user-info">
      <div class="mobile-user-avatar">
        <?php
        $initials = '';
        if (isset($_SESSION['user_name'])) {
            $nameParts = explode(' ', $_SESSION['user_name']);
            foreach ($nameParts as $part) {
                $initials .= strtoupper(substr($part, 0, 1));
            }
        }
        echo substr($initials, 0, 2);
        ?>
      </div>
      <h3 class="mobile-user-name"><?php echo $_SESSION['user_name'] ?? 'User'; ?></h3>
      <span class="mobile-user-role"><?php echo ucfirst($_SESSION['user_role'] ?? ''); ?></span>
    </div>
    <?php endif; ?>
    
    <div class="mobile-sidebar-content">
      <?php if (isset($_SESSION['user_id'])): ?>
      <ul>
        <!-- Admin Navigation -->
        <?php if ($_SESSION['user_role'] === 'admin'): ?>
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=admin-dashboard" 
                   class="<?php echo ($currentPage ?? '') === 'dashboard' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=admin-doctors" 
                   class="<?php echo ($currentPage ?? '') === 'doctors' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-user-md"></i> Doctors
                </a>
            </li>
            
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=admin-users" 
                   class="<?php echo ($currentPage ?? '') === 'users' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-users"></i> Users
                </a>
            </li>
            
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=admin-departments" 
                   class="<?php echo ($currentPage ?? '') === 'departments' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-clinic-medical"></i> Departments
                </a>
            </li>
            
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=admin-appointments" 
                   class="<?php echo ($currentPage ?? '') === 'appointments' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-calendar-check"></i> Appointments
                </a>
            </li>
            
        <?php elseif ($_SESSION['user_role'] === 'doctor'): ?>
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=doctor-dashboard" 
                   class="<?php echo ($currentPage ?? '') === 'dashboard' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=doctor-appointments" 
                   class="<?php echo ($currentPage ?? '') === 'appointments' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-calendar-check"></i> Appointments
                </a>
            </li>
            
        <?php elseif ($_SESSION['user_role'] === 'receptionist'): ?>
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=receptionist-dashboard" 
                   class="<?php echo ($currentPage ?? '') === 'dashboard' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            
        <?php elseif ($_SESSION['user_role'] === 'patient'): ?>
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=patient-dashboard" 
                   class="<?php echo ($currentPage ?? '') === 'dashboard' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=patient-appointments" 
                   class="<?php echo ($currentPage ?? '') === 'appointments' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-calendar-check"></i> Appointments
                </a>
            </li>
            
            <li>
                <a href="<?php echo APP_URL; ?>/public/index.php?page=patient-book" 
                   class="<?php echo ($currentPage ?? '') === 'book' ? 'active' : ''; ?>"
                   onclick="closeMobileSidebar()">
                    <i class="fas fa-calendar-plus"></i> Book Appointment
                </a>
            </li>
        <?php endif; ?>
        
        <li class="logout">
            <a href="<?php echo APP_URL; ?>/public/index.php?page=logout" onclick="closeMobileSidebar()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </li>
      </ul>
      <?php else: ?>
      <ul>
        <li>
            <a href="<?php echo APP_URL; ?>/public/index.php?page=home" 
               class="<?php echo ($currentPage ?? '') === 'home' ? 'active' : ''; ?>"
               onclick="closeMobileSidebar()">
                <i class="fas fa-home"></i> Home
            </a>
        </li>
        
        <li>
            <a href="<?php echo APP_URL; ?>/public/index.php?page=login" 
               class="<?php echo ($currentPage ?? '') === 'login' ? 'active' : ''; ?>"
               onclick="closeMobileSidebar()">
                <i class="fas fa-sign-in-alt"></i> Login
            </a>
        </li>
        
        <li>
            <a href="<?php echo APP_URL; ?>/public/index.php?page=register" 
               class="<?php echo ($currentPage ?? '') === 'register' ? 'active' : ''; ?>"
               onclick="closeMobileSidebar()">
                <i class="fas fa-user-plus"></i> Sign Up
            </a>
        </li>
      </ul>
      <?php endif; ?>
    </div>
  </div>

  <main>
  
  <!-- JavaScript for mobile sidebar -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileSidebar = document.getElementById('mobileSidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const closeSidebar = document.getElementById('closeSidebar');
        const body = document.body;

        // Function to open mobile sidebar
        function openMobileSidebar() {
            mobileSidebar.classList.add('active');
            sidebarOverlay.classList.add('active');
            body.style.overflow = 'hidden';
        }

        // Function to close mobile sidebar
        function closeMobileSidebar() {
            mobileSidebar.classList.remove('active');
            sidebarOverlay.classList.remove('active');
            body.style.overflow = '';
        }

        // Toggle mobile sidebar
        mobileMenuBtn.addEventListener('click', openMobileSidebar);
        closeSidebar.addEventListener('click', closeMobileSidebar);
        sidebarOverlay.addEventListener('click', closeMobileSidebar);

        // Close sidebar when clicking on a link
        const mobileLinks = mobileSidebar.querySelectorAll('a');
        mobileLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                // Don't close immediately for external links or special cases
                if (!this.href.includes('logout')) {
                    setTimeout(closeMobileSidebar, 300);
                }
            });
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth > 620) {
                closeMobileSidebar();
            }
        });

        // Keyboard shortcut to close sidebar
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMobileSidebar();
            }
        });

        // Make function available globally
        window.closeMobileSidebar = closeMobileSidebar;
    });

    // Add swipe to close functionality
    let touchStartX = 0;
    let touchEndX = 0;

    document.addEventListener('touchstart', function(e) {
        if (e.target.closest('.mobile-sidebar')) {
            touchStartX = e.changedTouches[0].screenX;
        }
    });

    document.addEventListener('touchend', function(e) {
        if (e.target.closest('.mobile-sidebar')) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }
    });

    function handleSwipe() {
        const swipeThreshold = 50;
        const swipeDistance = touchEndX - touchStartX;
        
        // Swipe left to close (right to left swipe)
        if (swipeDistance < -swipeThreshold) {
            closeMobileSidebar();
        }
    }
  </script>

================================================================================
FILE: views/layouts/footer.php
================================================================================

    </main>
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Kasr Al Ainy Hospital</h3>
                    <p>Providing advanced healthcare services with compassion and excellence since 1827.</p>
                    <p>Committed to improving health and wellbeing through innovative medical solutions.</p>
                </div>
                <div class="footer-section">
                    <h3>Contact Information</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> Kasr Al Ainy Street, Cairo, Egypt</li>
                        <li><i class="fas fa-phone"></i> +20 2 2365 1234</li>
                        <li><i class="fas fa-envelope"></i> info@kasalainyhospital.com</li>
                        <li><i class="fas fa-globe"></i> www.kasalainyhospital.com</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Emergency Contacts</h3>
                    <ul>
                        <li><i class="fas fa-ambulance"></i> Emergency: 12345</li>
                        <li><i class="fas fa-heartbeat"></i> Cardiac Emergency: 12346</li>
                        <li><i class="fas fa-first-aid"></i> Trauma Center: 12347</li>
                        <li><i class="fas fa-calendar-check"></i> Appointments: 12348</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; <?php echo date('Y'); ?> Kasr Al Ainy Hospital Management System</p>
            </div>
        </div>
    </footer>

    <script src="<?php echo APP_URL; ?>/public/js/main.js"></script>
</body>
</html>

================================================================================
FILE: views/patient/book.php
================================================================================

<?php
$pageTitle = 'Book Appointment - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Book Appointment</h2>
        <a href="?page=patient-appointments" class="btn btn-outline">Back to Appointments</a>
    </div>
    
    <!-- Progress Steps -->
    <div class="progress-steps">
        <div class="progress-step <?php echo empty($selectedDepartment) ? 'active' : 'completed'; ?>">
            <div class="step-number">1</div>
            <div class="step-label">Select Department</div>
        </div>
        <div class="progress-step <?php echo !empty($selectedDepartment) && empty($selectedSpecialization) ? 'active' : 
                                  (!empty($selectedSpecialization) ? 'completed' : ''); ?>">
            <div class="step-number">2</div>
            <div class="step-label">Select Specialization</div>
        </div>
        <div class="progress-step <?php echo !empty($selectedSpecialization) && empty($doctors) ? 'active' : 
                                  (!empty($doctors) ? 'completed' : ''); ?>">
            <div class="step-number">3</div>
            <div class="step-label">Select Doctor</div>
        </div>
        <div class="progress-step <?php echo !empty($doctors) ? 'active' : ''; ?>">
            <div class="step-number">4</div>
            <div class="step-label">Book Appointment</div>
        </div>
    </div>
    
    <!-- Error Message -->
    <?php if (!empty($error)): ?>
    <div class="alert alert-danger" style="margin-bottom: 20px;">
        <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($error); ?>
    </div>
    <?php endif; ?>
    
    <!-- Step 1: Select Department -->
    <?php if (empty($selectedDepartment)): ?>
    <div class="form-container">
        <h3>Step 1: Select Medical Department</h3>
        <p>Choose the department for your medical needs.</p>
        
        <form action="?page=patient-book" method="POST">
            <input type="hidden" name="step" value="select_department">
            
            <div class="form-group">
                <label for="department_id">Select Department *</label>
                <select class="form-control" id="department_id" name="department_id" required>
                    <option value="">Choose a department</option>
                    <?php foreach ($departments as $dept): ?>
                    <option value="<?php echo $dept['id']; ?>" 
                        <?php echo $selectedDepartment == $dept['id'] ? 'selected' : ''; ?>>
                        <?php echo htmlspecialchars($dept['name']); ?>
                        <?php if (!empty($dept['description'])): ?>
                        <small style="color: #666;">- <?php echo htmlspecialchars($dept['description']); ?></small>
                        <?php endif; ?>
                    </option>
                    <?php endforeach; ?>
                </select>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Next: Select Specialization</button>
            </div>
        </form>
    </div>
    
    <!-- Step 2: Select Specialization -->
    <?php elseif (!empty($selectedDepartment) && empty($selectedSpecialization)): ?>
    <div class="form-container">
        <h3>Step 2: Select Specialization</h3>
        <p>Now choose the medical specialization within the selected department.</p>
        
        <form action="?page=patient-book" method="POST">
            <input type="hidden" name="step" value="select_specialization">
            <input type="hidden" name="department_id" value="<?php echo $selectedDepartment; ?>">
            
            <div class="form-group">
                <label for="specialization">Select Specialization *</label>
                <?php if (empty($specializations)): ?>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> No specializations available for this department.
                    <br>
                    <button type="button" class="btn btn-outline btn-sm" onclick="window.location.href='?page=patient-book'">
                        Back to Departments
                    </button>
                </div>
                <?php else: ?>
                <select class="form-control" id="specialization" name="specialization" required>
                    <option value="">Choose a specialization</option>
                    <?php foreach ($specializations as $spec): ?>
                    <option value="<?php echo htmlspecialchars($spec['specialization']); ?>" 
                        <?php echo $selectedSpecialization == $spec['specialization'] ? 'selected' : ''; ?>>
                        <?php echo htmlspecialchars($spec['specialization']); ?>
                    </option>
                    <?php endforeach; ?>
                </select>
                <?php endif; ?>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-outline" onclick="window.location.href='?page=patient-book'">
                    Back to Departments
                </button>
                <?php if (!empty($specializations)): ?>
                <button type="submit" class="btn btn-primary">Next: Select Doctor</button>
                <?php endif; ?>
            </div>
        </form>
    </div>
    
    <!-- Step 3: Select Doctor -->
    <?php elseif (!empty($selectedDepartment) && !empty($selectedSpecialization) && empty($doctors)): ?>
    <div class="form-container">
        <h3>Step 3: Select Doctor</h3>
        <p>Choose a doctor from the available specialists.</p>
        
        <?php if (empty($doctors)): ?>
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> No doctors available for this specialization.
            <br>
            <button type="button" class="btn btn-outline btn-sm" onclick="window.location.href='?page=patient-book'">
                Back to Specializations
            </button>
        </div>
        <?php else: ?>
        <!-- This section will show doctors after form submission -->
        <?php endif; ?>
    </div>
    
    <!-- Step 4: Book Appointment (Show Doctors and Booking Form) -->
    <?php elseif (!empty($doctors)): ?>
    <div class="form-container">
        <h3>Step 4: Book Appointment</h3>
        <p>Select a doctor and choose appointment details.</p>
        
        <!-- Doctors List -->
        <div class="doctors-list" style="margin-bottom: 30px;">
            <h4>Available Doctors</h4>
            <div class="cards-container">
                <?php foreach ($doctors as $doctor): ?>
                <div class="card">
                    <div class="card-body">
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; background-color: var(--primary-light); 
                                      border-radius: 50%; display: flex; align-items: center; 
                                      justify-content: center; margin: 0 auto 15px; font-size: 2rem; color: var(--primary-color);">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <h4><?php echo htmlspecialchars($doctor['name']); ?></h4>
                            <p style="color: var(--primary-color); font-weight: 500; margin-bottom: 5px;">
                                <?php echo htmlspecialchars($doctor['specialization']); ?>
                            </p>
                            <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">
                                <?php echo htmlspecialchars($doctor['department_name']); ?>
                            </p>
                            <?php if ($doctor['phone']): ?>
                            <p style="font-size: 0.9rem;">
                                <i class="fas fa-phone"></i> <?php echo htmlspecialchars($doctor['phone']); ?>
                            </p>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
                <?php endforeach; ?>
            </div>
        </div>
        
        <!-- Booking Form -->
        <h4>Appointment Details</h4>
        <form action="?page=patient-book" method="POST">
            <input type="hidden" name="step" value="book_appointment">
            <input type="hidden" name="department_id" value="<?php echo $selectedDepartment; ?>">
            <input type="hidden" name="specialization" value="<?php echo htmlspecialchars($selectedSpecialization); ?>">
            
            <div class="form-group">
                <label for="doctor_id">Select Doctor *</label>
                <select class="form-control" id="doctor_id" name="doctor_id" required>
                    <option value="">Choose a doctor</option>
                    <?php foreach ($doctors as $doctor): ?>
                    <option value="<?php echo $doctor['id']; ?>">
                        Dr. <?php echo htmlspecialchars($doctor['name']); ?> - 
                        <?php echo htmlspecialchars($doctor['specialization']); ?>
                    </option>
                    <?php endforeach; ?>
                </select>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="date">Appointment Date *</label>
                    <input type="date" class="form-control" id="date" name="date" required 
                           min="<?php echo date('Y-m-d'); ?>">
                </div>
                <div class="form-group">
                    <label for="time">Appointment Time *</label>
                    <select class="form-control" id="time" name="time" required>
                        <option value="">Select Time</option>
                        <?php for ($hour = 9; $hour <= 17; $hour++): ?>
                        <?php if ($hour != 13): ?> <!-- Skip lunch hour -->
                        <option value="<?php echo sprintf('%02d:00:00', $hour); ?>">
                            <?php echo sprintf('%02d:00', $hour); ?> AM
                        </option>
                        <option value="<?php echo sprintf('%02d:30:00', $hour); ?>">
                            <?php echo sprintf('%02d:30', $hour); ?> AM
                        </option>
                        <?php endif; ?>
                        <?php endfor; ?>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="reason">Reason for Visit *</label>
                <textarea class="form-control" id="reason" name="reason" rows="3" required 
                          placeholder="Please describe your symptoms or reason for the appointment"></textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-outline" 
                        onclick="window.location.href='?page=patient-book&department_id=<?php echo $selectedDepartment; ?>'">
                    Back to Doctors
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-calendar-plus"></i> Book Appointment
                </button>
            </div>
        </form>
    </div>
    <?php endif; ?>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set min date to today
    const today = new Date().toISOString().split('T')[0];
    const dateInput = document.getElementById('date');
    if (dateInput) {
        dateInput.min = today;
        if (!dateInput.value) {
            dateInput.value = today;
        }
    }
    
    // Form validation
    const bookingForm = document.querySelector('form[action*="patient-book"]');
    if (bookingForm) {
        bookingForm.addEventListener('submit', function(e) {
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                submitBtn.disabled = true;
            }
        });
    }
});
</script>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/patient/dashboard.php
================================================================================

<?php
$pageTitle = 'Patient Dashboard - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>Patient Dashboard</h2>
        <p>Welcome back, <?php echo $_SESSION['user_name']; ?>. Here's your healthcare overview.</p>
    </div>
    
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon appointments">
                <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo count($appointments); ?></h3>
                <p>Upcoming Appointments</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon patients">
                <i class="fas fa-bell"></i>
            </div>
            <div class="stat-info">
                <h3><?php echo count($notifications); ?></h3>
                <p>New Notifications</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon departments">
                <i class="fas fa-user-md"></i>
            </div>
            <div class="stat-info">
                <h3>Cardiology</h3>
                <p>Primary Department</p>
            </div>
        </div>
        <div class="stat-card">
            <a href="<?php echo APP_URL; ?>/public/index.php?page=patient-book" style="text-decoration: none;">
                <div class="stat-icon doctors" style="background-color: var(--success-color);">
                    <i class="fas fa-plus"></i>
                </div>
            </a>

                <div class="stat-info">
                    <h3>Book Now</h3>
                    <p>New Appointment</p>
                </div>        </div>
    </div>
    
    <div class="page-header">
        <h3>Upcoming Appointments</h3>
        <a href="<?php echo APP_URL; ?>/public/index.php?page=patient-appointments" class="btn btn-outline">
            <i class="fas fa-eye"></i> View All
        </a>
    </div>
    
    <?php if (empty($appointments)): ?>
    <div class="alert" style="background-color: var(--primary-light); padding: 20px; border-radius: var(--border-radius); text-align: center;">
        <p style="margin: 0 0 15px 0;">You don't have any upcoming appointments.</p>
        <a href="<?php echo APP_URL; ?>/public/index.php?page=patient-book" class="btn btn-primary">
            <i class="fas fa-calendar-plus"></i> Book Your First Appointment
        </a>
    </div>
    <?php else: ?>
    <div class="cards-container">
        <?php foreach ($appointments as $appointment): ?>
        <div class="card">
            <div class="card-header">
                <h3>Appointment with Dr. <?php echo htmlspecialchars($appointment['doctor_name']); ?></h3>
                <span class="status <?php echo strtolower($appointment['status']); ?>">
                    <?php echo ucfirst($appointment['status']); ?>
                </span>
            </div>
            <div class="card-body">
                <p><strong>Date:</strong> <?php echo date('F j, Y', strtotime($appointment['date'])); ?></p>
                <p><strong>Time:</strong> <?php echo date('h:i A', strtotime($appointment['time'])); ?></p>
                <p><strong>Doctor:</strong> Dr. <?php echo htmlspecialchars($appointment['doctor_name']); ?></p>
                <p><strong>Specialization:</strong> <?php echo htmlspecialchars($appointment['specialization'] ?? 'General'); ?></p>
                <p><strong>Reason:</strong> <?php echo htmlspecialchars($appointment['reason']); ?></p>
                <?php if ($appointment['status'] === 'pending'): ?>
                <div style="margin-top: 15px;">
                    <form action="<?php echo APP_URL; ?>/public/appointment/cancel/<?php echo $appointment['id']; ?>" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to cancel this appointment?')">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </form>
                </div>
                <?php endif; ?>
            </div>
        </div>
        <?php endforeach; ?>
    </div>
    <?php endif; ?>
    
    <?php if (!empty($notifications)): ?>
    <div class="page-header" style="margin-top: 40px;">
        <h3>Recent Notifications</h3>
    </div>
    
    <div class="cards-container">
        <?php foreach ($notifications as $notification): ?>
        <div class="card">
            <div class="card-body">
                <p style="margin-bottom: 10px;">
                    <i class="fas fa-bell" style="color: var(--warning-color); margin-right: 10px;"></i>
                    <?php echo htmlspecialchars($notification['message']); ?>
                </p>
                <small style="color: var(--text-light);">
                    <?php echo date('M j, Y h:i A', strtotime($notification['created_at'])); ?>
                </small>
            </div>
        </div>
        <?php endforeach; ?>
    </div>
    <?php endif; ?>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/patient/profile.php
================================================================================

<?php
$pageTitle = 'My Profile - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>My Profile</h2>
    </div>
    
    <div class="form-container">
        <form>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" class="form-control" value="<?php echo $_SESSION['user_name'] ?? 'Patient Name'; ?>" readonly>
            </div>
            
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" class="form-control" value="<?php echo $_SESSION['user_email'] ?? 'patient@email.com'; ?>" readonly>
            </div>
            
            <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" class="form-control" value="+20 123 456 7890">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Date of Birth</label>
                    <input type="date" class="form-control" value="1990-01-01">
                </div>
                <div class="form-group">
                    <label>Gender</label>
                    <select class="form-control">
                        <option>Male</option>
                        <option>Female</option>
                        <option>Other</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Address</label>
                <textarea class="form-control" rows="3">123 Main Street, Cairo, Egypt</textarea>
            </div>
            
            <div class="form-group">
                <label>Emergency Contact</label>
                <input type="text" class="form-control" value="+20 987 654 3210">
            </div>
            
            <div class="form-group">
                <label>Blood Group</label>
                <input type="text" class="form-control" value="O+">
            </div>
            
            <div class="form-group">
                <label>Allergies</label>
                <textarea class="form-control" rows="2">Penicillin, Pollen</textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-outline">Cancel</button>
                <button type="submit" class="btn btn-primary">Update Profile</button>
            </div>
        </form>
    </div>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
FILE: views/patient/appointments.php
================================================================================

<?php
$pageTitle = 'My Appointments - ' . APP_NAME;
include __DIR__ . '/../layouts/header.php';
?>

<div class="container">
    <div class="page-header">
        <h2>My Appointments</h2>
        <a href="?page=patient-book" class="btn btn-primary">
            <i class="fas fa-plus"></i> Book New Appointment
        </a>
    </div>
    
    <?php if (!empty($successMessage)): ?>
    <div class="alert alert-success" style="padding: 15px; margin-bottom: 20px; background-color: #d4edda; color: #155724; border-radius: 5px;">
        <i class="fas fa-check-circle"></i> <?php echo htmlspecialchars($successMessage); ?>
    </div>
    <?php endif; ?>
    
    <?php if (isset($_SESSION['error_message'])): ?>
    <div class="alert alert-danger" style="padding: 15px; margin-bottom: 20px; background-color: #f8d7da; color: #721c24; border-radius: 5px;">
        <i class="fas fa-exclamation-circle"></i> <?php echo htmlspecialchars($_SESSION['error_message']); ?>
        <?php unset($_SESSION['error_message']); ?>
    </div>
    <?php endif; ?>
    
    <?php if (empty($appointments)): ?>
    <div class="alert" style="background-color: #e8f4fc; padding: 20px; border-radius: 10px; text-align: center;">
        <p style="margin: 0 0 15px 0;">You don't have any appointments yet.</p>
        <a href="?page=patient-book" class="btn btn-primary">
            <i class="fas fa-calendar-plus"></i> Book Your First Appointment
        </a>
    </div>
    <?php else: ?>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Doctor</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($appointments as $appointment): ?>
                <tr>
                    <td><?php echo date('M d, Y', strtotime($appointment['date'])); ?></td>
                    <td><?php echo date('h:i A', strtotime($appointment['time'])); ?></td>
                    <td>Dr. <?php echo htmlspecialchars($appointment['doctor_name']); ?></td>
                    <td><?php echo htmlspecialchars($appointment['reason']); ?></td>
                    <td>
                        <span class="status <?php echo strtolower($appointment['status']); ?>">
                            <?php echo ucfirst($appointment['status']); ?>
                        </span>
                    </td>
                    <td>
                        <?php if ($appointment['status'] === 'pending' || $appointment['status'] === 'confirmed'): ?>
                        <form action="?page=cancel-appointment&id=<?php echo $appointment['id']; ?>" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to cancel this appointment?')">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </form>
                        <?php else: ?>
                        <span class="text-muted">No actions available</span>
                        <?php endif; ?>
                    </td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
    <?php endif; ?>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

================================================================================
SUMMARY
Total files processed: 75
Total characters: 419695
Output file: /Applications/XAMPP/xamppfiles/htdocs/OOP_PROJECT/hospital-management-system/code_contents.txt
